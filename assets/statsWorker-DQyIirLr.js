(function(){"use strict";const Zt=["selfBuffs","groupBuffs","squadBuffs"],yt=r=>r!=null&&r.classification?r.classification==="Boon":!0,en=r=>`b${r}`,Xn=(r,l)=>{const p=Array.isArray(r==null?void 0:r.activeTimes)?r.activeTimes:[],H=typeof p[0]=="number"?p[0]:0;return H>0?H:l},tn=(r,l,p,H,j,V,Ce)=>{const oe=r==="selfBuffs"?1:Math.max(r==="groupBuffs"?V-1:Ce-1,0);return!oe||!j?{generationMs:0,wastedMs:0}:l?{generationMs:p*j*oe,wastedMs:H*j*oe}:{generationMs:p/100*j*oe,wastedMs:H/100*j*oe}},Zn=r=>{const l=new Map,p=new Map;return r.forEach(V=>{const Ce=V.details;if(!Ce)return;const oe=Ce.durationMS||0,Ae=Ce.buffMap||{};Object.entries(Ae).forEach(([z,Y])=>{if(!l.has(z)){l.set(z,Y);return}const Se=l.get(z)||{},de={name:Se.name||Y.name,stacking:Se.stacking??Y.stacking,icon:Se.icon||Y.icon,classification:Se.classification||Y.classification};l.set(z,de)});const Xe=(Ce.players||[]).filter(z=>!z.notInSquad),Fe=Xe.length,Le=new Map;Xe.forEach(z=>{const Y=z.group??0;Le.set(Y,(Le.get(Y)||0)+1)}),Xe.forEach(z=>{const Y=z.account||z.name||z.character_name||"Unknown",Se=z.profession||"Unknown",de=z.group??0,pe=Le.get(de)||1,Te=Xn(z,oe);p.has(Y)||p.set(Y,{account:Y,profession:Se,professions:new Set,professionTimeMs:{},activeTimeMs:0,numFights:0,groupSupported:0,squadSupported:0,boons:{}});const Ne=p.get(Y);Ne.profession=Se,Se!=="Unknown"&&(Ne.professions.add(Se),Ne.professionTimeMs[Se]=(Ne.professionTimeMs[Se]||0)+Te),Ne.activeTimeMs+=Te,Ne.numFights+=1,Ne.groupSupported+=pe,Ne.squadSupported+=Fe,Zt.forEach(m=>{(z[m]||[]).forEach(ue=>{var qe,Oe,He,Re;if(typeof(ue==null?void 0:ue.id)!="number")return;const be=en(ue.id),ke=Ae[be];if(!yt(ke))return;const he=(ke==null?void 0:ke.stacking)??!1,We=((Oe=(qe=ue.buffData)==null?void 0:qe[0])==null?void 0:Oe.generation)??0,ge=((Re=(He=ue.buffData)==null?void 0:He[0])==null?void 0:Re.wasted)??0,{generationMs:we,wastedMs:ze}=tn(m,he,We,ge,oe,pe,Fe);!we&&!ze||(l.has(be)||l.set(be,ke||{}),Ne.boons[be]||(Ne.boons[be]={selfBuffs:{generationMs:0,wastedMs:0},groupBuffs:{generationMs:0,wastedMs:0},squadBuffs:{generationMs:0,wastedMs:0}}),Ne.boons[be][m].generationMs+=we,Ne.boons[be][m].wastedMs+=ze)})})})}),{boonTables:Array.from(l.keys()).filter(V=>yt(l.get(V))).map(V=>{const Ce=l.get(V)||{},oe=[];return p.forEach(Ae=>{var z;const Ke=Ae.boons[V];if(!Ke||!Zt.some(Y=>Ke[Y].generationMs>0||Ke[Y].wastedMs>0))return;const Fe=Array.from(Ae.professions||[]).filter(Y=>Y&&Y!=="Unknown");let Le=Ae.profession;if(Fe.length>0){Le=Fe[0];let Y=((z=Ae.professionTimeMs)==null?void 0:z[Le])||0;Fe.forEach(Se=>{var pe;const de=((pe=Ae.professionTimeMs)==null?void 0:pe[Se])||0;de>Y&&(Y=de,Le=Se)})}oe.push({account:Ae.account,profession:Le||"Unknown",professionList:Fe,activeTimeMs:Ae.activeTimeMs||1,numFights:Ae.numFights||1,groupSupported:Ae.groupSupported||1,squadSupported:Ae.squadSupported||1,categories:{selfBuffs:{...Ke.selfBuffs},groupBuffs:{...Ke.groupBuffs},squadBuffs:{...Ke.squadBuffs}}})}),{id:V,name:Ce.name||V,icon:Ce.icon,stacking:Ce.stacking??!1,rows:oe}}).filter(V=>V.rows.length>0)}},nn=(r,l,p,H,j,V,Ce={})=>{var z,Y,Se,de;const Ae=((r==null?void 0:r[l])||[]).find(pe=>pe.id===p);if(!Ae)return{generationMs:0,wastedMs:0};const Ke=Ce[en(p)],Xe=(Ke==null?void 0:Ke.stacking)??!1,Fe=((Y=(z=Ae.buffData)==null?void 0:z[0])==null?void 0:Y.generation)??0,Le=((de=(Se=Ae.buffData)==null?void 0:Se[0])==null?void 0:de.wasted)??0;return tn(l,Xe,Fe,Le,H,j,V)};var yn={methods:{tiered:{tiers:{shortMs:500,mediumMs:1500,weights:{short:.5,medium:1,long:2}}}}};const ei=yn,Rt="count",ti=r=>(r||0)/1e3,ni=(r,l)=>{var j;if(!r)return 0;const p=(j=ei.methods.tiered)==null?void 0:j.tiers;if(!p)return r;const H=l/Math.max(r,1);return H<=p.shortMs?r*p.weights.short:H<=p.mediumMs?r*p.weights.medium:r*p.weights.long},on=(r,l,p)=>p==="duration"?ti(l):p==="tiered"?ni(r,l):r;function ii(r,l=Rt){var V;const p=(V=r.statsAll)==null?void 0:V[0],H=Number((p==null?void 0:p.appliedCrowdControl)??0),j=Number((p==null?void 0:p.appliedCrowdControlDuration)??0);return on(H,j,l)}function oi(r,l){const p=(l==null?void 0:l.durationMS)||0,H=(l==null?void 0:l.buffMap)||{},j=r.filter(oe=>!oe.notInSquad),V=j.length,Ce=new Map;j.forEach(oe=>{const Ae=oe.group??0;Ce.set(Ae,(Ce.get(Ae)||0)+1)}),j.forEach(oe=>{const Ae=Ce.get(oe.group??0)||1,Ke=nn(oe,"selfBuffs",1122,p,Ae,V,H),Xe=nn(oe,"squadBuffs",1122,p,Ae,V,H);oe.stabGeneration=(Ke.generationMs+Xe.generationMs)/1e3})}function si(r){if(!r.statsTargets)return 0;let l=0;for(const p of r.statsTargets)p&&p.length>0&&(l+=p[0].downContribution||0);return l}function ai(r){if(!r.extBarrierStats||!r.extBarrierStats.outgoingBarrierAllies)return 0;let l=0;for(const p of r.extBarrierStats.outgoingBarrierAllies)if(p)for(const H of p)H&&(l+=H.barrier||0);return l}function ri(r){if(!r.extHealingStats||!r.extHealingStats.outgoingHealingAllies)return 0;let l=0;for(const p of r.extHealingStats.outgoingHealingAllies)if(p)for(const H of p)H&&(l+=H.healing||0);return l}const sn=r=>{var l,p,H,j;return(((p=(l=r.support)==null?void 0:l[0])==null?void 0:p.condiCleanse)||0)+(((j=(H=r.support)==null?void 0:H[0])==null?void 0:j.condiCleanseSelf)||0)},an=(r,l=Rt)=>{var V;const p=(V=r.support)==null?void 0:V[0],H=Number((p==null?void 0:p.boonStrips)??0),j=Number((p==null?void 0:p.boonStripsTime)??0);return on(H,j,l)},rn=r=>si(r),cn=r=>ri(r),ln=r=>ai(r),un=(r,l=Rt)=>ii(r,l),ci=(r,l)=>oi(r,l),li="count",ui={downContribution:1,healing:1,cleanses:1,strips:1,stability:1,cc:.7,revives:.7,distanceToTag:.7,participation:.7,dodging:.4,dps:.2,damage:.2},mi={showMvp:!0,topSkillDamageSource:"target",topSkillsMetric:"damage"},mn=new Map([["bleeding","Bleeding"],["burning","Burning"],["confusion","Confusion"],["poison","Poison"],["torment","Torment"],["vulnerability","Vulnerability"],["weakness","Weakness"],["weakened","Weakness"],["blind","Blind"],["blinded","Blind"],["blinding","Blind"],["cripple","Cripple"],["crippled","Cripple"],["chill","Chill"],["chilled","Chill"],["immob","Immobilize"],["immobile","Immobilize"],["immobilized","Immobilize"],["slow","Slow"],["slowed","Slow"],["fear","Fear"],["feared","Fear"],["taunt","Taunt"],["taunted","Taunt"]]),di={Blind:"https://render.guildwars2.com/file/09770136BB76FD0DBE1CC4267DEED54774CB20F6/102837.png",Chill:"https://render.guildwars2.com/file/28C4EC547A3516AF0242E826772DA43A5EAC3DF3/102839.png",Cripple:"https://render.guildwars2.com/file/070325E519C178D502A8160523766070D30C0C19/102838.png",Fear:"https://render.guildwars2.com/file/30307A6E766D74B6EB09EDA12A4A2DE50E4D76F4/102869.png",Immobilize:"https://render.guildwars2.com/file/397A613651BFCA2832B6469CE34735580A2C120E/102844.png",Slow:"https://render.guildwars2.com/file/F60D1EF5271D7B9319610855676D320CD25F01C6/961397.png",Taunt:"https://render.guildwars2.com/file/02EED459AD65FAF7DF32A260E479C625070841B9/1228472.png",Vulnerability:"https://render.guildwars2.com/file/3A394C1A0A3257EB27A44842DDEEF0DF000E1241/102850.png",Weakness:"https://render.guildwars2.com/file/6CB0E64AF9AA292E332A38C1770CE577E2CDE0E8/102853.png"},ht=r=>{if(!r)return null;const l=r.trim().toLowerCase(),p=mn.get(l);if(p)return p;const H=l.split(/[^a-z]+/).filter(Boolean);for(const j of H){const V=mn.get(j);if(V)return V}return null},fi=r=>ht(r),dn=r=>{const l=new Map;return r&&(Object.values(r).forEach(p=>{if(!(p!=null&&p.icon)||!(p!=null&&p.name))return;const H=ht(p.name);H&&(l.has(H)||l.set(H,p.icon))}),Object.entries(di).forEach(([p,H])=>{l.has(p)||l.set(p,H)})),l},vt=(r,l,p)=>{var H;if(l&&p){const j=(H=p[`b${l}`])==null?void 0:H.name,V=ht(j);if(V)return V}return r?ht(r):null},gi=r=>{const l=(r==null?void 0:r.account)||"Unknown";return l&&l!=="Unknown"?l:(r==null?void 0:r.name)||"Unknown"||null},pi=r=>{if(!r||r.length===0)return 0;let l=0,p=null;return r.forEach(H=>{const j=Number(H[1]??0);if(Number.isFinite(j)){if(p===null){p=j;return}j>p&&(l+=j-p),p=j}}),l},bi=r=>{if(!r||r.length===0)return 0;let l=0;return r.forEach(p=>{const H=Number(p[0]??0),j=Number(p[1]??0);Number.isFinite(j)&&H!==0&&j>0&&(l+=1)}),l},hi=r=>{const{players:l,targets:p,skillMap:H,buffMap:j}=r,V=r.getPlayerKey||gi,Ce=dn(j),oe={},Ae={};l.forEach(z=>{if(z!=null&&z.notInSquad)return;const Y=V(z);Y&&(oe[Y]||(oe[Y]={}),z!=null&&z.totalDamageDist&&z.totalDamageDist.forEach(Se=>{Se&&Se.forEach(de=>{if(!de.id)return;let pe=`Skill ${de.id}`,Te;H&&(H[`s${de.id}`]?(pe=H[`s${de.id}`].name||pe,Te=H[`s${de.id}`].icon||Te):H[`${de.id}`]&&(pe=H[`${de.id}`].name||pe,Te=H[`${de.id}`].icon||Te));const Ne=vt(pe,de.id,j);if(!Ne)return;const m=j==null?void 0:j[`b${de.id}`],Me=m==null?void 0:m.name,ue=Ce.get(Ne)||(m==null?void 0:m.icon),be=pe.startsWith("Skill ")?Me||Ne:pe,ke=Te||(m==null?void 0:m.icon),he=Number(de.connectedHits??0),We=Number(de.hits??0),ge=he>0?he:We,we=Number(de.totalDamage??0);if(!Number.isFinite(ge)&&!Number.isFinite(we))return;const ze=Ae[Ne]||{name:Ne,icon:ue,applications:0,damage:0};ze.applications+=Number.isFinite(ge)?ge:0,ze.damage+=Number.isFinite(we)?we:0,!ze.icon&&ue&&(ze.icon=ue),Ae[Ne]=ze;const qe=oe[Y][Ne]||{icon:ue,applications:0,damage:0,skills:{}};qe.applications+=Number.isFinite(ge)?ge:0,qe.damage+=Number.isFinite(we)?we:0;const Oe=qe.skills[be]||{name:be,hits:0,damage:0,icon:ke};Oe.hits+=Number.isFinite(ge)?ge:0,Oe.damage+=Number.isFinite(we)?we:0,!Oe.icon&&ke&&(Oe.icon=ke),qe.skills[be]=Oe,!qe.icon&&ue&&(qe.icon=ue),oe[Y][Ne]=qe})}))});const Ke=new Map;l.forEach(z=>{if(z!=null&&z.notInSquad)return;const Y=V(z);Y&&z!=null&&z.name&&Ke.set(z.name,Y)});let Xe=0,Fe=0,Le=0;return p.forEach(z=>{z!=null&&z.buffs&&z.buffs.forEach(Y=>{const Se=Number(Y==null?void 0:Y.id);if(!Number.isFinite(Se))return;const de=j==null?void 0:j[`b${Se}`],pe=ht(de==null?void 0:de.name);if(!pe||de!=null&&de.classification&&de.classification!=="Condition")return;const Te=pe;if(!Te)return;const Ne=Y.statesPerSource||{};Le+=1,Object.entries(Ne).forEach(([m,Me])=>{var ge;const ue=Ke.get(m);if(!ue)return;Fe+=1;const be=pi(Me),ke=bi(Me);Xe+=be;const he=((ge=oe[ue])==null?void 0:ge[Te])||{applications:0,damage:0,skills:{}};he.applicationsFromBuffs=(he.applicationsFromBuffs||0)+be,he.applicationsFromBuffsActive=(he.applicationsFromBuffsActive||0)+ke,oe[ue]=oe[ue]||{},oe[ue][Te]=he;const We=Ae[Te]||{name:Te,applications:0,damage:0};We.applicationsFromBuffs=(We.applicationsFromBuffs||0)+be,We.applicationsFromBuffsActive=(We.applicationsFromBuffsActive||0)+ke,Ae[Te]=We})})}),Object.values(oe).forEach(z=>{Object.values(z).forEach(Y=>{typeof Y.applicationsFromBuffs=="number"&&(Y.applications=Y.applicationsFromBuffs)})}),Object.values(Ae).forEach(z=>{typeof z.applicationsFromBuffs=="number"&&(z.applications=z.applicationsFromBuffs)}),{playerConditions:oe,summary:Ae,meta:{buffStateApplicationsTotal:Xe,targetBuffEntriesSeen:Le,buffStateSourcesSeen:Fe}}},Di=new Set(["Vulnerability","Weakness","Blind","Cripple","Chill","Immobilize","Slow","Fear","Taunt"]),ki=[{id:"damage",label:"Damage",field:"damage",source:"dpsAll"},{id:"directDmg",label:"Direct Damage",field:"directDmg",source:"statsTargets"},{id:"connectedDamageCount",label:"Connected Damage Count",field:"connectedDamageCount",source:"statsTargets"},{id:"connectedDirectDamageCount",label:"Connected Direct Damage Count",field:"connectedDirectDamageCount",source:"statsTargets"},{id:"battleStandardHits",label:"Battle Standard Tracking"},{id:"criticalRate",label:"Critical Rate",field:"criticalRate",isRate:!0,isPercent:!0,denomField:"critableDirectDamageCount",source:"statsTargets"},{id:"criticalDmg",label:"Critical Damage",field:"criticalDmg",source:"statsTargets"},{id:"flankingRate",label:"Flanking Rate",field:"flankingRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"glanceRate",label:"Glance Rate",field:"glanceRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"missed",label:"Missed",field:"missed",source:"statsTargets"},{id:"evaded",label:"Evaded (enemy)",field:"evaded",source:"statsTargets"},{id:"blocked",label:"Blocked (enemy)",field:"blocked",source:"statsTargets"},{id:"interrupts",label:"Interrupts",field:"interrupts",source:"statsTargets"},{id:"invulned",label:"Invulned",field:"invulned",source:"statsTargets"},{id:"killed",label:"Killed",field:"killed",source:"statsTargets"},{id:"downed",label:"Downed",field:"downed",source:"statsTargets"},{id:"downContribution",label:"Down Contribution",field:"downContribution",source:"statsTargets"},{id:"downContributionPercent",label:"Down Contribution %",isRate:!0,isPercent:!0},{id:"againstDownedDamage",label:"Against Downed Damage",field:"againstDownedDamage",source:"statsTargets"},{id:"appliedCrowdControl",label:"Applied CC",field:"appliedCrowdControl",source:"statsTargets"},{id:"appliedCrowdControlDuration",label:"Applied CC Duration",field:"appliedCrowdControlDuration",source:"statsTargets"},{id:"appliedCrowdControlDownContribution",label:"Applied CC Down Contribution",field:"appliedCrowdControlDownContribution",source:"statsTargets"},{id:"appliedCrowdControlDurationDownContribution",label:"Applied CC Duration Down Contribution",field:"appliedCrowdControlDurationDownContribution",source:"statsTargets"},{id:"boonStrips",label:"Boon Strips",field:"boonStrips",source:"support"}],Si=[{id:"damageTaken",label:"Damage Taken",field:"damageTaken"},{id:"minionDamageTaken",label:"Minion Damage Taken"},{id:"damageTakenCount",label:"Damage Taken Count",field:"damageTakenCount"},{id:"conditionDamageTaken",label:"Condition Damage Taken",field:"conditionDamageTaken"},{id:"conditionDamageTakenCount",label:"Condition Damage Taken Count",field:"conditionDamageTakenCount"},{id:"powerDamageTaken",label:"Power Damage Taken",field:"powerDamageTaken"},{id:"powerDamageTakenCount",label:"Power Damage Taken Count",field:"powerDamageTakenCount"},{id:"downedDamageTaken",label:"Downed Damage Taken",field:"downedDamageTaken"},{id:"downedDamageTakenCount",label:"Downed Damage Taken Count",field:"downedDamageTakenCount"},{id:"damageBarrier",label:"Damage Barrier",field:"damageBarrier"},{id:"damageBarrierCount",label:"Damage Barrier Count",field:"damageBarrierCount"},{id:"blockedCount",label:"Blocked Count",field:"blockedCount"},{id:"evadedCount",label:"Evaded Count",field:"evadedCount"},{id:"missedCount",label:"Missed Count",field:"missedCount"},{id:"dodgeCount",label:"Dodge Count",field:"dodgeCount"},{id:"invulnedCount",label:"Invulnerable Count",field:"invulnedCount"},{id:"interruptedCount",label:"Interrupted Count",field:"interruptedCount"},{id:"downCount",label:"Down Count",field:"downCount"},{id:"deadCount",label:"Death Count",field:"deadCount"},{id:"boonStrips",label:"Boon Strips (Incoming)",field:"boonStrips"},{id:"conditionCleanses",label:"Cleanses (Incoming)",field:"conditionCleanses"},{id:"receivedCrowdControl",label:"Crowd Control (Incoming)",field:"receivedCrowdControl"}],Ni=[{id:"condiCleanse",label:"Condition Cleanses",field:"condiCleanse"},{id:"condiCleanseTime",label:"Condition Cleanse Time",field:"condiCleanseTime",isTime:!0},{id:"condiCleanseSelf",label:"Condition Cleanse Self",field:"condiCleanseSelf"},{id:"condiCleanseTimeSelf",label:"Condition Cleanse Time Self",field:"condiCleanseTimeSelf",isTime:!0},{id:"boonStrips",label:"Boon Strips",field:"boonStrips"},{id:"boonStripsTime",label:"Boon Strips Time",field:"boonStripsTime",isTime:!0},{id:"boonStripDownContribution",label:"Boon Strip Down Contribution",field:"boonStripDownContribution"},{id:"boonStripDownContributionTime",label:"Boon Strip Down Contribution Time",field:"boonStripDownContributionTime",isTime:!0},{id:"stunBreak",label:"Stun Breaks",field:"stunBreak"},{id:"removedStunDuration",label:"Removed Stun Duration",field:"removedStunDuration",isTime:!0},{id:"resurrects",label:"Resurrects",field:"resurrects"},{id:"resurrectTime",label:"Resurrect Time",field:"resurrectTime",isTime:!0}],Ci=["battle standard","glyph of renewal","glyph of the stars","illusion of life","spirit of nature","nature spirit","search and rescue","signet of mercy"],Ai=new Set([10244]),Ti=(r,l)=>{var j;if(Ai.has(r))return!0;const p=(l==null?void 0:l[`s${r}`])||(l==null?void 0:l[`${r}`]),H=((j=p==null?void 0:p.name)==null?void 0:j.toLowerCase())||"";return Ci.some(V=>H.includes(V))},Ft=r=>{if(!r||!Number.isFinite(r))return"--:--";const l=Math.max(0,Math.round(r/1e3)),p=Math.floor(l/3600),H=Math.floor(l%3600/60),j=l%60;return p>0?`${p}:${String(H).padStart(2,"0")}:${String(j).padStart(2,"0")}`:`${H}:${String(j).padStart(2,"0")}`},Et={Guardian:"#72C1D9",Dragonhunter:"#72C1D9",Firebrand:"#72C1D9",Willbender:"#72C1D9",Revenant:"#D16E5A",Herald:"#D16E5A",Renegade:"#D16E5A",Vindicator:"#D16E5A",Warrior:"#FFD166",Berserker:"#FFD166",Spellbreaker:"#FFD166",Bladesworn:"#FFD166",Engineer:"#D09C59",Scrapper:"#D09C59",Holosmith:"#D09C59",Mechanist:"#D09C59",Ranger:"#8CDC82",Druid:"#8CDC82",Soulbeast:"#8CDC82",Untamed:"#8CDC82",Thief:"#C08F95",Daredevil:"#C08F95",Deadeye:"#C08F95",Specter:"#C08F95",Elementalist:"#F68A87",Tempest:"#F68A87",Weaver:"#F68A87",Catalyst:"#F68A87",Mesmer:"#B679D5",Chronomancer:"#B679D5",Mirage:"#B679D5",Virtuoso:"#B679D5",Necromancer:"#52A76F",Reaper:"#52A76F",Scourge:"#52A76F",Harbinger:"#52A76F",Ritualist:"#52A76F",Luminary:"#72C1D9",Conduit:"#D16E5A",Paragon:"#FFD166",Amalgam:"#D09C59",Galeshot:"#8CDC82",Antiquary:"#C08F95",Evoker:"#F68A87",Troubadour:"#B679D5",Unknown:"#64748B"};function fn(r){return Et[r]||Et.Unknown}const Mi=r=>{if(r==null||r==="")return 0;if(typeof r=="number")return!Number.isFinite(r)||r<=0?0:r>1e12?r:r*1e3;if(r instanceof Date){const Ce=r.getTime();return Number.isFinite(Ce)&&Ce>0?Ce:0}const l=String(r).trim();if(!l)return 0;const p=Number(l);if(Number.isFinite(p)&&p>0)return p>1e12?p:p*1e3;const H=Date.parse(l);if(Number.isFinite(H)&&H>0)return H;const j=l.replace(/([+-]\d{2})$/,"$1:00"),V=Date.parse(j);return Number.isFinite(V)&&V>0?V:0},Ye=(r,l)=>Mi((r==null?void 0:r.uploadTime)??(l==null?void 0:l.uploadTime)??(r==null?void 0:r.timeStartStd)??(r==null?void 0:r.timeStart)??(r==null?void 0:r.timeEndStd)??(r==null?void 0:r.timeEnd)??(r==null?void 0:r.timeStartText)??(r==null?void 0:r.timeEndText)),wi=({logs:r,precomputedStats:l,mvpWeights:p,statsViewSettings:H,disruptionMethod:j})=>{const V=r.filter(Le=>Le.details&&Le.details.players&&Le.details.players.length>0),Ce=H||mi,oe=p||ui,Ae=Fe=>{if(!Fe||typeof Fe!="object")return Fe;const Le=Array.isArray(Fe.fightBreakdown)?Fe.fightBreakdown:null;if(!Le||Le.length===0)return Fe;const z=m=>Array.isArray(m)&&m.some(Me=>Me&&Number(Me.count)>0),Y=new Map,Se=new Map;r.forEach(m=>{var be;const Me=(m==null?void 0:m.filePath)||(m==null?void 0:m.id);Me&&Y.set(String(Me),m);const ue=(m==null?void 0:m.permalink)||((be=m==null?void 0:m.details)==null?void 0:be.permalink);typeof ue=="string"&&ue.trim()&&Se.set(ue.trim(),m)});const de=Le.map(m=>{var We;if(!m||typeof m!="object")return m;const Me=m.id?String(m.id):"",ue=typeof m.permalink=="string"?m.permalink.trim():"",be=(Me?Y.get(Me):void 0)||(ue?Se.get(ue):void 0);if(!be)return m;let ke=m;if(Number(m.timestamp)<=0){const ge=Ye(be==null?void 0:be.details,be);ge&&(ke={...ke,timestamp:ge})}const he=(We=be==null?void 0:be.details)==null?void 0:We.teamBreakdown;return z(he)&&(ke={...ke,teamBreakdown:he}),ke}),pe=Array.isArray(Fe.fightDiffMode)?Fe.fightDiffMode:[],Ne=pe.some(m=>Array.isArray(m==null?void 0:m.targetFocus)&&m.targetFocus.some(Me=>Number((Me==null?void 0:Me.damage)||0)>0||Number((Me==null?void 0:Me.hits)||0)>0))?pe:de.map((m,Me)=>{const ue=m&&typeof m.enemyClassCounts=="object"&&m.enemyClassCounts?m.enemyClassCounts:{},be=Object.entries(ue).map(([Re,Ge])=>({label:String(Re||"Unknown"),count:Number(Ge||0)})).filter(Re=>Re.count>0).sort((Re,Ge)=>Ge.count-Re.count||Re.label.localeCompare(Ge.label)),ke=be.reduce((Re,Ge)=>Re+Ge.count,0),he=be.map(Re=>({label:Re.label,damage:Re.count,hits:0,share:ke>0?Re.count/ke:0})),We=Number((m==null?void 0:m.enemyDowns)||0),ge=Number((m==null?void 0:m.enemyDeaths)||0),we=Number((m==null?void 0:m.alliesDown)||0),ze=Number((m==null?void 0:m.alliesDead)||0),qe=Number((m==null?void 0:m.totalOutgoingDamage)||0),Oe=Number((m==null?void 0:m.totalIncomingDamage)||0),He=[{metricId:"winFlag",metricLabel:"Win (1) / Loss (0)",higherIsBetter:!0,value:m!=null&&m.isWin?1:0},{metricId:"squadCount",metricLabel:"Squad Size",higherIsBetter:!0,value:Number((m==null?void 0:m.squadCount)||0)},{metricId:"enemyCount",metricLabel:"Enemy Count",higherIsBetter:!1,value:Number((m==null?void 0:m.enemyCount)||0)},{metricId:"squadKdr",metricLabel:"Squad KDR",higherIsBetter:!0,value:ze>0?ge/ze:ge},{metricId:"enemyDeaths",metricLabel:"Enemy Deaths",higherIsBetter:!0,value:ge},{metricId:"enemyDowns",metricLabel:"Enemy Downs",higherIsBetter:!0,value:We},{metricId:"squadDeaths",metricLabel:"Squad Deaths",higherIsBetter:!1,value:ze},{metricId:"squadDowns",metricLabel:"Squad Downs",higherIsBetter:!1,value:we},{metricId:"damageDelta",metricLabel:"Damage Delta",higherIsBetter:!0,value:qe-Oe},{metricId:"outgoingDamage",metricLabel:"Outgoing Damage",higherIsBetter:!0,value:qe},{metricId:"incomingDamage",metricLabel:"Incoming Damage",higherIsBetter:!1,value:Oe},{metricId:"barrierIncomingAbsorb",metricLabel:"Barrier Absorption (Incoming)",higherIsBetter:!0,value:Number((m==null?void 0:m.incomingBarrierAbsorbed)||0)},{metricId:"enemyBarrierAbsorb",metricLabel:"Enemy Barrier Absorption",higherIsBetter:!1,value:Number((m==null?void 0:m.outgoingBarrierAbsorbed)||0)},{metricId:"alliesRevived",metricLabel:"Allies Revived (Players)",higherIsBetter:!0,value:Number((m==null?void 0:m.alliesRevived)||0)}];return{id:String((m==null?void 0:m.id)||`fight-${Me+1}`),shortLabel:`F${Me+1}`,fullLabel:`${String((m==null?void 0:m.mapName)||(m==null?void 0:m.label)||"Unknown Map")} • ${String((m==null?void 0:m.duration)||"--:--")}`,mapName:String((m==null?void 0:m.mapName)||""),timestamp:Number((m==null?void 0:m.timestamp)||0),duration:String((m==null?void 0:m.duration)||"--:--"),isWin:!!(m!=null&&m.isWin),targetFocus:he,squadMetrics:He}});return{...Fe,fightBreakdown:de,fightDiffMode:Ne}},Ke=(()=>{if(l)return Ae(l);const Fe=j||li,Le=Ce.topSkillDamageSource||"target",z=Ce.topSkillsMetric||"damage",Y=V.length;let Se=0,de=0,pe=0,Te=0,Ne=0,m=0,Me=0,ue=0;const be=e=>{const i=((e==null?void 0:e.players)||[]).filter(x=>!x.notInSquad);let b=0,a=0,T=0,g=0;return i.forEach(x=>{var se;const _=(se=x.defenses)==null?void 0:se[0];if(!_)return;const K=Number(_.downCount||0),ae=Number(_.deadCount||0);b+=K+ae,T+=ae}),i.forEach(x=>{!x.statsTargets||x.statsTargets.length===0||x.statsTargets.forEach(_=>{const K=_==null?void 0:_[0];if(!K)return;const ae=Number(K.downed||0),se=Number(K.killed||0);a+=ae+se,g+=se})}),{squadDownsDeaths:b,enemyDownsDeaths:a,squadDeaths:T,enemyDeaths:g}},ke=e=>{const{squadDownsDeaths:n,enemyDownsDeaths:i}=be(e);return n>0||i>0?i>n:typeof(e==null?void 0:e.success)=="boolean"?e.success:!1},he=new Map,We=new Set(["boonStripsTime","condiCleanseTime","condiCleanseTimeSelf"]),ge={},we={},ze=new Map,qe={},Oe={},He={},Re=new Map,Ge=new Map,Bt=new Set(Object.keys(Et)),It=Object.keys(Et).filter(e=>e&&e!=="Unknown").sort((e,n)=>n.length-e.length),Lt=["Guardian","Revenant","Warrior","Engineer","Ranger","Thief","Elementalist","Mesmer","Necromancer"],et=e=>{if(!e)return"Unknown";const n=String(e).replace(/\s*\([^)]*\)\s*$/,"").replace(/\s*\[[^\]]*\]\s*$/,"").replace(/\s\d+$/,"").trim();if(Bt.has(n))return n;const i=n.toLowerCase();for(const a of It)if(i.includes(a.toLowerCase()))return a;return Lt.find(a=>i.includes(a.toLowerCase()))||n||"Unknown"},Fi=e=>e!=null&&e.classification?e.classification==="Boon":!0,Pt=new Map,Ut=new Map,Dt=()=>({totalHits:0,blocked:0,evaded:0,glanced:0,missed:0,invulned:0,interrupted:0,totalMitigation:0,minMitigation:0}),fe=e=>{const n=Number(e);return Number.isFinite(n)?n:0},kn=e=>{const n=String(e).split("|"),i=n[0]||"Unknown",b=et(n[1]||"Unknown"),a=n[2]||i||"Unknown";return{name:i,profession:b,account:a}},Sn=(e,n,i)=>{let b=e.get(n);return b?i.profession&&!b.professionList.includes(i.profession)&&b.professionList.push(i.profession):(b={account:i.account,name:i.name,profession:i.profession,professionList:i.profession?[i.profession]:[],activeMs:0,mitigationTotals:Dt()},e.set(n,b)),b},Nn=(e,n,i)=>{let b=e.get(n);return b?i.profession&&!b.professionList.includes(i.profession)&&b.professionList.push(i.profession):(b={account:i.account,name:i.name,profession:i.profession,professionList:i.profession?[i.profession]:[],activeMs:0,mitigationTotals:Dt(),minion:i.minion},e.set(n,b)),b},Cn=(e,n)=>{e.totalHits+=fe((n==null?void 0:n.skill_hits)??(n==null?void 0:n.skillHits)),e.blocked+=fe(n==null?void 0:n.blocked),e.evaded+=fe(n==null?void 0:n.evaded),e.glanced+=fe(n==null?void 0:n.glanced),e.missed+=fe(n==null?void 0:n.missed),e.invulned+=fe(n==null?void 0:n.invulned),e.interrupted+=fe(n==null?void 0:n.interrupted),e.totalMitigation+=fe((n==null?void 0:n.avoided_damage)??(n==null?void 0:n.avoidedDamage)),e.minMitigation+=fe((n==null?void 0:n.min_avoided_damage)??(n==null?void 0:n.minAvoidedDamage))},Ei=e=>Object.values(e).some(n=>n>0),qt=(e,n,i)=>{var T,g,x,_;const b=`s${e}`;if((T=n==null?void 0:n[b])!=null&&T.name)return n[b].name;if((g=n==null?void 0:n[String(e)])!=null&&g.name)return n[String(e)].name;const a=`b${e}`;return(x=i==null?void 0:i[a])!=null&&x.name?i[a].name:(_=i==null?void 0:i[String(e)])!=null&&_.name?i[String(e)].name:`Unknown Skill ${e}`},kt=new Map,ut=e=>{const n=kt.get(e);if(!n)return{hasSkill:!1,avg:1,min:1,hits:0};const i=n.connectedHits||0,b=i>0?n.totalDamage/i:0,a=n.minCount>0?n.minTotal/n.minCount:0;return{hasSkill:!0,avg:b,min:a,hits:i}},Ht="Ashtonlightstone.9145",An="Illusionary Warden",jt=[],mt=[],zt=[],Kt=[],Tn=new Map,Mn=new Map,wn=(e,n,i)=>{const b=e.get(n)||Dt();return b.totalHits+=i.totalHits,b.blocked+=i.blocked,b.evaded+=i.evaded,b.glanced+=i.glanced,b.missed+=i.missed,b.invulned+=i.invulned,b.interrupted+=i.interrupted,e.set(n,b),b};V.forEach(e=>{const n=e.details;if(!n)return;(n.targets||[]).forEach(b=>{const a=(b==null?void 0:b.totalDamageDist)||[],T=Array.isArray(a)?a[0]:null;T==null||T.forEach(g=>{if(!(g!=null&&g.id))return;const x=Number(g.id),_=kt.get(x)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};_.totalDamage+=Number(g.totalDamage||0),_.connectedHits+=Number(g.connectedHits||0);const K=Number.isFinite(Number(g.min))?Number(g.min):0;_.minTotal+=K,_.minCount+=1,kt.set(x,_)})})}),V.forEach((e,n)=>{var me,$e;const i=e.details;if(!i)return;const b=i.players,a=i.targets||[],T=i.skillMap||{},g=i.buffMap||{},x=new Map,_=new Map;a.forEach(t=>{const s=(t==null?void 0:t.totalDamageDist)||[],h=Array.isArray(s)?s[0]:null;h==null||h.forEach(v=>{var ee;if(!(v!=null&&v.id))return;const D=Number(v.id),o=((ee=T==null?void 0:T[D])==null?void 0:ee.name)||v.name||v.skillName||String(D),S=x.get(D)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};S.totalDamage+=Number(v.totalDamage||0),S.connectedHits+=Number(v.connectedHits||0);const f=Number.isFinite(Number(v.min))?Number(v.min):0;S.minTotal+=f,S.minCount+=1,x.set(D,S);const U=_.get(o)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};U.totalDamage+=Number(v.totalDamage||0),U.connectedHits+=Number(v.connectedHits||0);const ne=Number.isFinite(Number(v.min))?Number(v.min):0;U.minTotal+=ne,U.minCount+=1,_.set(o,U)})});const K=t=>{const s=x.get(t);if(!s||s.connectedHits<=0)return{avg:1,min:1};const h=s.connectedHits>0?s.totalDamage/s.connectedHits:0,v=s.minCount>0?s.minTotal/s.minCount:h;return{avg:h||1,min:v||1}},ae=t=>{const s=_.get(t);if(!s||s.connectedHits<=0)return{avg:1,min:1};const h=s.connectedHits>0?s.totalDamage/s.connectedHits:0,v=s.minCount>0?s.minTotal/s.minCount:h;return{avg:h||1,min:v||1}},se=i.combatReplayMetaData||{},ve=(se==null?void 0:se.inchToPixel)>0?se.inchToPixel:1,E=(se==null?void 0:se.pollingRate)>0?se.pollingRate:1,B=5e3,R=t=>Array.isArray(t)?t.map(s=>Array.isArray(s)?[Number(s[0]),Number(s[1])]:null).filter(s=>!!s&&Number.isFinite(s[0])):[];let y=[],ce=i.durationMS||0,u=!1;const d=b.find(t=>(t==null?void 0:t.hasCommanderTag)&&!(t!=null&&t.notInSquad));(me=d==null?void 0:d.combatReplayData)!=null&&me.positions&&(y=d.combatReplayData.positions,R(d.combatReplayData.dead).forEach(([s])=>{s>0&&(u=!0,ce=Math.min(ce,s))}));const M=t=>{var U;const s=(U=t.statsAll)==null?void 0:U[0];if((s==null?void 0:s.distToCom)!==void 0&&(s==null?void 0:s.distToCom)!=="Infinity")return Math.round(Number(s.distToCom));if((s==null?void 0:s.stackDist)!==void 0)return Math.round(Number(s.stackDist))||0;if(t.hasCommanderTag)return 0;const h=t.combatReplayData;if(!(h!=null&&h.positions)||!y.length)return 0;const v=h.positions,D=R(h.dead),o=R(h.down),S=Math.floor((h.start||0)/E);let f=0;if(D.length&&o.length)for(const[ne]of D){if(ne<0)continue;const ee=Math.max(0,Math.floor(ne/E))-S;for(const[W,Z]of o){if(ne!==Z)continue;const ie=u&&W>ce?Math.max(1,Math.floor(ce/E)):ee,re=Math.max(0,Math.min(ie,v.length,y.length));if(re<=0)continue;let te=0;for(let Q=0;Q<re;Q++){const[C,$]=v[Q],[G,J]=y[Q];te+=Math.hypot(C-G,$-J)}f=Math.round(te/re/ve)}}return f},N=b.filter(t=>!t.notInSquad);pe+=N.length,Te+=a.filter(t=>!t.isFake).length,ci(b,{durationMS:i.durationMS,buffMap:i.buffMap});const{squadDeaths:P,enemyDeaths:c}=be(i);Ne+=P,m+=c,ue+=P,Me+=c,ke(i)?Se++:de++;const q=i.skillMap?Number(($e=Object.keys(i.skillMap).find(t=>{var s,h;return((h=(s=i.skillMap)==null?void 0:s[t])==null?void 0:h.name)==="Battle Standard"}))==null?void 0:$e.replace(/^s/,"")):null;b.forEach((t,s)=>{var dt,ft,xt,St,Nt,Hn,$n,xn,On,Rn,_n,Wn,jn;if(t.notInSquad)return;const h=t.account||"Unknown",v=h!=="Unknown"?h:t.name||"Unknown",D=t.name||"Unknown";he.has(v)||he.set(v,{name:D,account:v,characterNames:new Set,downContrib:0,cleanses:0,strips:0,stab:0,healing:0,barrier:0,cc:0,logsJoined:0,totalDist:0,distCount:0,dodges:0,downs:0,deaths:0,totalFightMs:0,offenseTotals:{},offenseRateWeights:{},defenseActiveMs:0,defenseTotals:{},defenseMinionDamageTaken:{},supportActiveMs:0,supportTotals:{},healingActiveMs:0,healingTotals:{},profession:t.profession||"Unknown",professions:new Set,professionTimeMs:{},squadActiveMs:0,firstSeenFightTs:0,lastSeenFightTs:0,lastSeenFightDurationMs:0,isCommander:!1,damage:0,dps:0,revives:0,outgoingConditions:{},incomingConditions:{}});const o=he.get(v);if(t.hasCommanderTag&&(o.isCommander=!0),D!=="Unknown"&&o.characterNames.add(String(D)),t.profession&&t.profession!=="Unknown"){o.profession=t.profession,o.professions.add(t.profession);const k=Array.isArray(t.activeTimes)&&typeof t.activeTimes[0]=="number"?t.activeTimes[0]:i.durationMS||0;o.professionTimeMs[t.profession]=(o.professionTimeMs[t.profession]||0)+k}o.logsJoined++,o.downContrib+=rn(t),o.cleanses+=sn(t),o.strips+=an(t,Fe),o.healing+=cn(t),o.barrier+=ln(t),o.cc+=un(t,Fe),o.stab+=t.stabGeneration||0;const S=M(t);S<=B&&(o.totalDist+=S,o.distCount++),(dt=t.defenses)!=null&&dt[0]&&(o.dodges+=t.defenses[0].dodgeCount||0,o.downs+=t.defenses[0].downCount||0,o.deaths+=t.defenses[0].deadCount||0),i.durationMS&&(o.totalFightMs+=i.durationMS);const f=Array.isArray(t.activeTimes)&&typeof t.activeTimes[0]=="number"?t.activeTimes[0]:i.durationMS||0;o.squadActiveMs+=f;const U=Ye(i,e),ne=Number((i==null?void 0:i.durationMS)||0);if(U>0&&((o.firstSeenFightTs<=0||U<o.firstSeenFightTs)&&(o.firstSeenFightTs=U),o.lastSeenFightTs<=0||U>o.lastSeenFightTs?(o.lastSeenFightTs=U,o.lastSeenFightDurationMs=ne):U===o.lastSeenFightTs&&ne>o.lastSeenFightDurationMs&&(o.lastSeenFightDurationMs=ne)),o.defenseActiveMs+=f,o.supportActiveMs+=f,o.healingActiveMs+=f,Array.isArray(t.buffUptimes)&&t.buffUptimes.length>0&&t.buffUptimes.forEach(k=>{var Kn,Vn,Gn,Jn,Yn,Qn;if(typeof(k==null?void 0:k.id)!="number")return;const I=`b${k.id}`,F=((Kn=i.buffMap)==null?void 0:Kn[I])||((Vn=i.buffMap)==null?void 0:Vn[String(k.id)]);if(!F||Fi(F))return;const L=Number(((Jn=(Gn=k.buffData)==null?void 0:Gn[0])==null?void 0:Jn.uptime)??0),X=Number(((Qn=(Yn=k.buffData)==null?void 0:Yn[0])==null?void 0:Qn.presence)??0);if((!Number.isFinite(L)||L<=0)&&(!Number.isFinite(X)||X<=0))return;const Be=(F==null?void 0:F.stacking)??!1,Je=(Be?Number.isFinite(L)?L:0:Number.isFinite(L)?L/100:0)*f,tt=Be?X:L,ye=Math.min(Math.max(Number.isFinite(tt)?tt:0,0),100)/100*f,lt=Number.isFinite(Je)&&Je>0,Ct=Number.isFinite(ye)&&ye>0;if(!lt&&!Ct)return;const nt=fi(F==null?void 0:F.name);if(nt&&Di.has(nt)&&(!(F!=null&&F.classification)||F.classification==="Condition")){const Ot=Je/1e3,it=F==null?void 0:F.icon,At=qe[nt]||{name:nt,icon:it,applications:0,damage:0};At.applicationsFromUptime=(At.applicationsFromUptime||0)+Ot,!At.icon&&it&&(At.icon=it),qe[nt]=At;const Tt=o.outgoingConditions[nt]||{applications:0,damage:0,skills:{},icon:it};Tt.applicationsFromUptime=(Tt.applicationsFromUptime||0)+Ot,!Tt.icon&&it&&(Tt.icon=it),o.outgoingConditions[nt]=Tt;const Mt=Oe[nt]||{name:nt,icon:it,applications:0,damage:0};Mt.applicationsFromUptime=(Mt.applicationsFromUptime||0)+Ot,!Mt.icon&&it&&(Mt.icon=it),Oe[nt]=Mt;const wt=o.incomingConditions[nt]||{applications:0,damage:0,skills:{},icon:it};wt.applicationsFromUptime=(wt.applicationsFromUptime||0)+Ot,!wt.icon&&it&&(wt.icon=it),o.incomingConditions[nt]=wt}Re.has(I)||Re.set(I,{name:F==null?void 0:F.name,stacking:Be,icon:F==null?void 0:F.icon}),Ge.has(I)||Ge.set(I,new Map);const zn=Ge.get(I),Xt=o.account||t.account||t.name||"Unknown";let rt=zn.get(Xt);rt||(rt={account:Xt,profession:o.profession||t.profession||"Unknown",professions:new Set,professionTimeMs:{},totalMs:0,uptimeMs:0,durationMs:0},zn.set(Xt,rt));const bt=t.profession||o.profession;bt&&bt!=="Unknown"&&(rt.professions.add(bt),rt.professionTimeMs[bt]=(rt.professionTimeMs[bt]||0)+f,rt.profession=bt),rt.totalMs+=lt?Je:0,rt.uptimeMs+=Ct?ye:0,rt.durationMs+=f}),(ft=t.defenses)!=null&&ft[0]){const k=L=>{let X=String(L||"Unknown").replace(/^Juvenile\s+/i,"")||"Unknown";return X.toUpperCase().includes("UNKNOWN")&&(X="Unknown"),X},F=(()=>{const L=Array.isArray(t==null?void 0:t.minions)?t.minions:[];if(L.length===0)return{total:0,byMinion:{}};let X=0;const Be={};return L.forEach(xe=>{const Je=Array.isArray(xe==null?void 0:xe.totalDamageTakenDist)?xe.totalDamageTakenDist:[],tt=Array.isArray(Je[0])?Je[0]:[],ct=k(xe==null?void 0:xe.name);tt.forEach(ye=>{const lt=Number((ye==null?void 0:ye.totalDamage)??(ye==null?void 0:ye.damageTaken)??0);Number.isFinite(lt)&&(X+=lt,Be[ct]=(Be[ct]||0)+lt)})}),{total:X,byMinion:Be}})();F.byMinion&&typeof F.byMinion=="object"&&Object.entries(F.byMinion).forEach(([L,X])=>{const Be=Number(X||0);!Number.isFinite(Be)||Be<=0||(o.defenseMinionDamageTaken[L]=(o.defenseMinionDamageTaken[L]||0)+Be)}),Si.forEach(L=>{const X=L.id==="minionDamageTaken"?F.total:Number(t.defenses[0][L.field]??0);Number.isFinite(X)&&(o.defenseTotals[L.id]=(o.defenseTotals[L.id]||0)+X)})}(xt=t.support)!=null&&xt[0]&&Ni.forEach(k=>{let I=Number(t.support[0][k.field]??0);Number.isFinite(I)&&(We.has(k.field)&&I>999999&&(I=0),o.supportTotals[k.id]=(o.supportTotals[k.id]||0)+I)});const ee=(k,I)=>{Number.isFinite(I)&&(o.healingTotals[k]=(o.healingTotals[k]||0)+I)},W=(k,I)=>Array.isArray(k)?k.reduce((F,L)=>F+Number((L==null?void 0:L[I])??0),0):0,Z=(k,I,F)=>{if(!Number.isFinite(F)||F<=0)return;const L=b[I],X=I===s,Be=L==null?void 0:L.notInSquad,xe=!Be,Je=xe&&(L==null?void 0:L.group)!=null&&L.group===t.group;ee(k,F),xe&&ee(`squad${k[0].toUpperCase()}${k.slice(1)}`,F),Je&&ee(`group${k[0].toUpperCase()}${k.slice(1)}`,F),X&&ee(`self${k[0].toUpperCase()}${k.slice(1)}`,F),Be&&ee(`offSquad${k[0].toUpperCase()}${k.slice(1)}`,F)};if(Array.isArray(t.rotation)){let k=0;t.rotation.forEach(I=>{var L;if(!(I!=null&&I.id)||!Ti(I.id,i.skillMap))return;const F=((L=I.skills)==null?void 0:L.length)||0;F>0&&(k+=F,ee(`resUtility_s${I.id}`,F))}),k>0&&ee("resUtility",k)}const ie=(St=t.extHealingStats)==null?void 0:St.outgoingHealingAllies;Array.isArray(ie)&&ie.forEach((k,I)=>{const F=W(k,"healing"),L=W(k,"downedHealing");Z("healing",I,F),Z("downedHealing",I,L)});const re=(Nt=t.extBarrierStats)==null?void 0:Nt.outgoingBarrierAllies;Array.isArray(re)&&re.forEach((k,I)=>{const F=W(k,"barrier");Z("barrier",I,F)});const te=(Hn=t.statsAll)==null?void 0:Hn[0],Q=($n=t.dpsAll)==null?void 0:$n[0],C=(xn=t.support)==null?void 0:xn[0];if(ki.forEach(k=>{if(k.id==="downContributionPercent"||!k.field)return;let I=0,F=0;k.source==="dpsAll"&&Q?I=Number(Q[k.field]??0):k.source==="statsAll"&&te?(I=Number(te[k.field]??0),F=Number(te[k.denomField||k.weightField||"connectedDamageCount"]??0)):k.source==="support"&&C?I=Number(C[k.field]??0):t.statsTargets&&t.statsTargets.forEach(L=>{L!=null&&L[0]&&(I+=Number(L[0][k.field]??0),F+=Number(L[0][k.denomField||k.weightField||"connectedDamageCount"]??0))}),Number.isFinite(I)&&(o.offenseTotals[k.id]=(o.offenseTotals[k.id]||0)+I,k.isRate&&F>0&&(o.offenseRateWeights[k.id]=(o.offenseRateWeights[k.id]||0)+F))}),t.targetDamageDist&&Number.isFinite(q)){const k=t.targetDamageDist.flatMap(I=>I||[]).flatMap(I=>I||[]).reduce((I,F)=>F!=null&&F.id&&F.id===q?I+((F==null?void 0:F.connectedHits)||0):I,0);o.offenseTotals.battleStandardHits=(o.offenseTotals.battleStandardHits||0)+k}o.revives+=((Rn=(On=t.support)==null?void 0:On[0])==null?void 0:Rn.resurrects)||0,Q&&(o.damage+=Q.damage||0,o.dps+=Q.dps||0);const $=k=>{var X,Be,xe,Je;let I=`Skill ${k.id}`;const F=((X=i.skillMap)==null?void 0:X[`s${k.id}`])||((Be=i.skillMap)==null?void 0:Be[`${k.id}`]);let L=F==null?void 0:F.icon;if(F!=null&&F.name&&(I=F.name),I.startsWith("Skill ")){const tt=vt(I,k.id,i.buffMap);tt&&(I=tt,L=((Je=(xe=i.buffMap)==null?void 0:xe[`b${k.id}`])==null?void 0:Je.icon)||L)}return{name:I,icon:L}},G=k=>{if(!(k!=null&&k.id))return;const{name:I,icon:F}=$(k);ge[k.id]||(ge[k.id]={name:I,icon:F,damage:0,hits:0,downContribution:0}),ge[k.id].name.startsWith("Skill ")&&!I.startsWith("Skill ")&&(ge[k.id].name=I),!ge[k.id].icon&&F&&(ge[k.id].icon=F),ge[k.id].damage+=k.totalDamage,ge[k.id].hits+=k.connectedHits,ge[k.id].downContribution+=Number(k.downContribution||0)},J=t.account||t.name||"Unknown",De=t.profession||"Unknown",Ie=`${J}|${De}`;let Ve=ze.get(Ie);Ve||(Ve={key:Ie,account:J,displayName:J,profession:De,professionList:[De],totalFightMs:0,skills:new Map},ze.set(Ie,Ve)),Ve.professionList.includes(De)||Ve.professionList.push(De),Ve.totalFightMs+=i.durationMS||0;const Qe=k=>{if(!(k!=null&&k.id))return;const{name:I,icon:F}=$(k),L=`s${k.id}`;let X=Ve.skills.get(L);X||(X={id:L,name:I,icon:F,damage:0,downContribution:0},Ve.skills.set(L,X)),X.name.startsWith("Skill ")&&!I.startsWith("Skill ")&&(X.name=I),!X.icon&&F&&(X.icon=F),X.damage+=Number(k.totalDamage||0),X.downContribution+=Number(k.downContribution||0)};if(Le==="total")(_n=t.totalDamageDist)==null||_n.forEach(k=>{k==null||k.forEach(I=>{G(I),Qe(I)})});else{const k=new Map;(Wn=t.targetDamageDist)==null||Wn.forEach(F=>{F==null||F.forEach(L=>{L==null||L.forEach(X=>{const Be=Number(X==null?void 0:X.id);if(Number.isFinite(Be)){const xe=k.get(Be)||{damage:0,hits:0,downContribution:0};xe.damage+=Number((X==null?void 0:X.totalDamage)||0),xe.hits+=Number((X==null?void 0:X.connectedHits)||0),xe.downContribution+=Number((X==null?void 0:X.downContribution)||0),k.set(Be,xe)}G(X),Qe(X)})})}),!(i!=null&&i.detailedWvW)&&((jn=t.totalDamageDist)==null||jn.forEach(F=>{F==null||F.forEach(L=>{const X=Number(L==null?void 0:L.id);if(!Number.isFinite(X))return;const Be=k.get(X);if(!Be){G(L),Qe(L);return}const xe=Number((L==null?void 0:L.totalDamage)||0),Je=Number((L==null?void 0:L.connectedHits)||0),tt=Number((L==null?void 0:L.downContribution)||0),ct=xe-Number(Be.damage||0),ye=Je-Number(Be.hits||0),lt=tt-Number(Be.downContribution||0);if(ct<=0&&ye<=0&&lt<=0)return;const Ct={...L,totalDamage:Math.max(0,ct),connectedHits:Math.max(0,ye),downContribution:Math.max(0,lt)};G(Ct),Qe(Ct)})}))}t.totalDamageTaken&&t.totalDamageTaken.forEach(k=>{k==null||k.forEach(I=>{var Be,xe,Je,tt;if(!(I!=null&&I.id))return;let F=`Skill ${I.id}`;const L=((Be=i.skillMap)==null?void 0:Be[`s${I.id}`])||((xe=i.skillMap)==null?void 0:xe[`${I.id}`]);let X=L==null?void 0:L.icon;if(L!=null&&L.name&&(F=L.name),F.startsWith("Skill ")){const ct=vt(F,I.id,i.buffMap);ct&&(F=ct,X=((tt=(Je=i.buffMap)==null?void 0:Je[`b${I.id}`])==null?void 0:tt.icon)||X)}we[I.id]||(we[I.id]={name:F,icon:X,damage:0,hits:0}),(!we[I.id].name.startsWith("Skill ")||F.startsWith("Skill "))&&(we[I.id].name=F),!we[I.id].icon&&X&&(we[I.id].icon=X),we[I.id].damage+=I.totalDamage,we[I.id].hits+=I.hits})})}),a.forEach(t=>{if(t!=null&&t.isFake)return;const s=et((t==null?void 0:t.profession)||(t==null?void 0:t.name)||(t==null?void 0:t.id));s&&(He[s]=(He[s]||0)+1)});const A=hi({players:b,targets:a,skillMap:i.skillMap,buffMap:i.buffMap,getPlayerKey:t=>t.account&&t.account!=="Unknown"?t.account:t.name||null}),O=dn(i.buffMap);Object.entries(A.playerConditions).forEach(([t,s])=>{const h=he.get(t);h&&Object.entries(s).forEach(([v,D])=>{const o=h.outgoingConditions[v]||{applications:0,damage:0,skills:{},icon:D.icon};o.applications+=Number(D.applications||0),o.damage+=Number(D.damage||0),D.applicationsFromBuffs&&(o.applicationsFromBuffs=(o.applicationsFromBuffs||0)+D.applicationsFromBuffs),D.applicationsFromBuffsActive&&(o.applicationsFromBuffsActive=(o.applicationsFromBuffsActive||0)+D.applicationsFromBuffsActive),Object.entries(D.skills||{}).forEach(([S,f])=>{const U=o.skills[S]||{name:f.name,hits:0,damage:0,icon:f.icon};U.hits+=Number(f.hits||0),U.damage+=Number(f.damage||0),!U.icon&&f.icon&&(U.icon=f.icon),o.skills[S]=U}),!o.icon&&D.icon&&(o.icon=D.icon),h.outgoingConditions[v]=o})}),Object.entries(A.summary).forEach(([t,s])=>{const h=qe[t]||{name:s.name||t,icon:s.icon,applications:0,damage:0};h.applications+=Number(s.applications||0),h.damage+=Number(s.damage||0),s.applicationsFromBuffs&&(h.applicationsFromBuffs=(h.applicationsFromBuffs||0)+s.applicationsFromBuffs),s.applicationsFromBuffsActive&&(h.applicationsFromBuffsActive=(h.applicationsFromBuffsActive||0)+s.applicationsFromBuffsActive),!h.icon&&s.icon&&(h.icon=s.icon),qe[t]=h}),N.forEach(t=>{const s=t.account&&t.account!=="Unknown"?t.account:t.name||"Unknown",h=he.get(s);!h||!t.totalDamageTaken||t.totalDamageTaken.forEach(v=>v==null?void 0:v.forEach(D=>{var Q,C,$,G,J,De;if(!(D!=null&&D.id))return;let o=`Skill ${D.id}`;const S=((Q=i.skillMap)==null?void 0:Q[`s${D.id}`])||((C=i.skillMap)==null?void 0:C[`${D.id}`]);S!=null&&S.name&&(o=S.name);const f=vt(o,D.id,i.buffMap);if(!f)return;const U=(G=($=i.buffMap)==null?void 0:$[`b${D.id}`])==null?void 0:G.name,ne=O.get(f)||((De=(J=i.buffMap)==null?void 0:J[`b${D.id}`])==null?void 0:De.icon),ee=(S==null?void 0:S.icon)||ne;o.startsWith("Skill ")&&(U||f)&&(o=U||f);const W=Number(D.hits??0),Z=Number(D.totalDamage??0),ie=Oe[f]||{name:f,icon:ne,applications:0,damage:0};ie.applications+=Number.isFinite(W)?W:0,ie.damage+=Number.isFinite(Z)?Z:0,!ie.icon&&ne&&(ie.icon=ne),Oe[f]=ie;const re=h.incomingConditions[f]||{applications:0,damage:0,skills:{},icon:ne};re.applications+=Number.isFinite(W)?W:0,re.damage+=Number.isFinite(Z)?Z:0;const te=re.skills[o]||{name:o,hits:0,damage:0,icon:ee};te.hits+=Number.isFinite(W)?W:0,te.damage+=Number.isFinite(Z)?Z:0,!te.icon&&ee&&(te.icon=ee),re.skills[o]=te,!re.icon&&ne&&(re.icon=ne),h.incomingConditions[f]=re}))});const le=i.player_damage_mitigation||i.playerDamageMitigation,Ue=le&&typeof le=="object"&&Object.keys(le).length>0;Ue&&Object.entries(le).forEach(([t,s])=>{if(!s||typeof s!="object")return;const h=kn(t),v=Sn(Pt,h.account,h);Object.values(s).forEach(D=>{fe((D==null?void 0:D.avoided_damage)??(D==null?void 0:D.avoidedDamage))<=0||Cn(v.mitigationTotals,D)})});const Ee=i.player_minion_damage_mitigation||i.playerMinionDamageMitigation,je=Ee&&typeof Ee=="object"&&Object.keys(Ee).length>0;je&&Object.entries(Ee).forEach(([t,s])=>{if(!s||typeof s!="object")return;const h=kn(t);Object.entries(s).forEach(([v,D])=>{if(!D||typeof D!="object")return;const o=`${h.account}::${v}`,S=Nn(Ut,o,{...h,minion:String(v||"Unknown")});Object.values(D).forEach(f=>{Cn(S.mitigationTotals,f)})})}),(!Ue||!je)&&(Ue||N.forEach(t=>{const s=(t==null?void 0:t.totalDamageTaken)||[];if(!Array.isArray(s)||s.length===0)return;const h=t.account||t.name||"Unknown",v={account:h,name:t.name||h,profession:et(t.profession||"Unknown")};Sn(Pt,h,v);const D=i.skillMap||{},o=i.buffMap||{},S=Array.isArray(s)?s[0]:null;if(S==null||S.forEach(f=>{if(!(f!=null&&f.id))return;const U=fe(f.blocked),ne=fe(f.evaded),ee=fe(f.glance??f.glanced),W=fe(f.missed),Z=fe(f.invulned),ie=fe(f.interrupted),re=fe(f.hits??f.connectedHits),te=Number(f.id),Q=qt(te,D,o);if(wn(Tn,`${h}::${te}`,{totalHits:re,blocked:U,evaded:ne,glanced:ee,missed:W,invulned:Z,interrupted:ie}),h===Ht){const C=kt.get(te),$=ut(te),G=$.hasSkill?$.hits>0?$.avg:0:1,J=$.hasSkill?$.min||0:1,De=$.hits>0?ee*G/2+(U+ne+W+Z+ie)*G:0,Ie=$.hits>0?ee*J/2+(U+ne+W+Z+ie)*J:0;zt.push({logId:e.filePath||e.id||n,skillId:f.id,skillName:Q,blocked:U,evaded:ne,glanced:ee,missed:W,invulned:Z,interrupted:ie,totalAvoids:U+ne+ee+W+Z+ie,avg:G,min:J,enemyHits:(C==null?void 0:C.connectedHits)??0,enemyTotalDmg:(C==null?void 0:C.totalDamage)??0,avoidDmg:De,avoidMinDmg:Ie})}}),h===Ht){const f=(U,ne)=>{let ee=0,W=0,Z=0;if(!Array.isArray(U))return{total:ee,minTotal:W,hits:Z};for(const ie of U){if(!(ie!=null&&ie.id))continue;const re=fe(ie.blocked),te=fe(ie.evaded),Q=fe(ie.glance??ie.glanced),C=fe(ie.missed),$=fe(ie.invulned),G=fe(ie.interrupted),J=qt(Number(ie.id),T,g),De=ne(Number(ie.id),J);(De.hits??0)>0&&(ee+=Q*De.avg/2+(re+te+C+$+G)*De.avg,W+=Q*De.min/2+(re+te+C+$+G)*De.min),Z+=fe(ie.hits??ie.connectedHits)}return{total:ee,minTotal:W,hits:Z}};Kt.push({logId:e.filePath||e.id||n,variant:"current_global_name_taken0",...f(S,(U,ne)=>{const ee=ut(U),W=ee.hasSkill?ee.hits>0?ee.avg:0:1,Z=ee.hasSkill?ee.min||0:1;return{avg:W,min:Z,hits:ee.hits}})})}}),je||N.forEach(t=>{const s=(t==null?void 0:t.minions)||[];if(!Array.isArray(s)||s.length===0)return;const h=t.account||t.name||"Unknown",v={account:h,name:t.name||h,profession:et(t.profession||"Unknown")},D=i.skillMap||{},o=i.buffMap||{};s.forEach(S=>{const f=(S==null?void 0:S.totalDamageTakenDist)||[];if(!Array.isArray(f)||f.length===0)return;let U=String((S==null?void 0:S.name)||"Unknown").replace(/^Juvenile\s+/i,"")||"Unknown";U.toUpperCase().includes("UNKNOWN")&&(U="Unknown");const ne=`${h}::${U}`;Nn(Ut,ne,{...v,minion:U});const ee=Array.isArray(f)?f[0]:null;if(ee==null||ee.forEach(W=>{if(!(W!=null&&W.id))return;const Z=fe(W.blocked),ie=fe(W.evaded),re=fe(W.glance??W.glanced),te=fe(W.missed),Q=fe(W.invulned),C=fe(W.interrupted),$=fe(W.hits??W.connectedHits),G=Number(W.id),J=qt(G,D,o);if(wn(Mn,`${ne}::${G}`,{totalHits:$,blocked:Z,evaded:ie,glanced:re,missed:te,invulned:Q,interrupted:C}),h===Ht&&U===An){const De=kt.get(G),Ie=ut(G),Ve=Ie.hasSkill?Ie.hits>0?Ie.avg:0:1,Qe=Ie.hasSkill?Ie.min||0:1,dt=Ie.hits>0?re*Ve/2+(Z+ie+te+Q+C)*Ve:0,ft=Ie.hits>0?re*Qe/2+(Z+ie+te+Q+C)*Qe:0;jt.push({logId:e.filePath||e.id||n,skillId:W.id,skillName:J,blocked:Z,evaded:ie,glanced:re,missed:te,invulned:Q,interrupted:C,totalAvoids:Z+ie+re+te+Q+C,avg:Ve,min:Qe,enemyHits:(De==null?void 0:De.connectedHits)??0,enemyTotalDmg:(De==null?void 0:De.totalDamage)??0,avoidDmg:dt,avoidMinDmg:ft})}}),h===Ht&&U===An){const W=(te,Q)=>{let C=0,$=0,G=0;if(!Array.isArray(te))return{total:C,minTotal:$,hits:G};for(const J of te){if(!(J!=null&&J.id))continue;const De=fe(J.blocked),Ie=fe(J.evaded),Ve=fe(J.glance??J.glanced),Qe=fe(J.missed),dt=fe(J.invulned),ft=fe(J.interrupted),xt=qt(Number(J.id),T,g),{avg:St,min:Nt}=Q(Number(J.id),xt);fe(J.hits??J.connectedHits)>0&&(C+=Ve*St/2+(De+Ie+Qe+dt+ft)*St,$+=Ve*Nt/2+(De+Ie+Qe+dt+ft)*Nt),G+=fe(J.hits??J.connectedHits)}return{total:C,minTotal:$,hits:G}},Z=Array.isArray(f)?f[0]||[]:[],ie=Array.isArray(f)?f.flat():[],re=Array.isArray(S==null?void 0:S.totalDamageTaken)?S.totalDamageTaken[0]||[]:[];mt.push({logId:e.filePath||e.id||n,variant:"current_global_name_dist0",...W(Z,(te,Q)=>{const C=ut(te),$=C.hasSkill?C.hits>0?C.avg:0:1,G=C.hasSkill&&C.min||0;return{avg:$,min:G}})}),mt.push({logId:e.filePath||e.id||n,variant:"local_name_dist0",...W(Z,(te,Q)=>ae(Q))}),mt.push({logId:e.filePath||e.id||n,variant:"local_id_dist0",...W(Z,te=>K(te))}),mt.push({logId:e.filePath||e.id||n,variant:"global_name_alllists",...W(ie,(te,Q)=>{const C=ut(te),$=C.hasSkill?C.hits>0?C.avg:0:1,G=C.hasSkill&&C.min||0;return{avg:$,min:G}})}),mt.push({logId:e.filePath||e.id||n,variant:"global_name_taken0",...W(re,(te,Q)=>{const C=ut(te),$=C.hasSkill?C.hits>0?C.avg:0:1,G=C.hasSkill&&C.min||0;return{avg:$,min:G}})})}})}))}),jt.length>0&&(console.groupCollapsed("[Mitigation Debug] Ashtonlightstone.9145 / Illusionary Warden"),console.table(jt),mt.length>0&&console.table(mt),console.groupEnd()),zt.length>0&&(console.groupCollapsed("[Mitigation Debug] Ashtonlightstone.9145 / Player"),console.table(zt),Kt.length>0&&console.table(Kt),console.groupEnd());const vn=(e,n)=>{const i=new Map,b=a=>{let T=i.get(a);return T||(T=Dt(),i.set(a,T)),T};n.forEach((a,T)=>{const g=T.lastIndexOf("::"),x=g>-1?T.slice(0,g):T,_=g>-1?Number(T.slice(g+2)):Number.NaN,K=Number.isFinite(_)?ut(_):{hasSkill:!1,avg:0,min:0,hits:0};if(!K.hasSkill||K.hits<=0)return;const ae=K.avg,se=K.min,ve=a.glanced*ae/2+(a.blocked+a.evaded+a.missed+a.invulned+a.interrupted)*ae,E=a.glanced*se/2+(a.blocked+a.evaded+a.missed+a.invulned+a.interrupted)*se;if(ve<=0)return;const B=b(x);B.totalHits+=a.totalHits,B.blocked+=a.blocked,B.evaded+=a.evaded,B.glanced+=a.glanced,B.missed+=a.missed,B.invulned+=a.invulned,B.interrupted+=a.interrupted,B.totalMitigation+=ve,B.minMitigation+=E}),e.forEach((a,T)=>{const g=i.get(T)||Dt();a.mitigationTotals.totalHits=g.totalHits,a.mitigationTotals.blocked=g.blocked,a.mitigationTotals.evaded=g.evaded,a.mitigationTotals.glanced=g.glanced,a.mitigationTotals.missed=g.missed,a.mitigationTotals.invulned=g.invulned,a.mitigationTotals.interrupted=g.interrupted,a.mitigationTotals.totalMitigation=g.totalMitigation,a.mitigationTotals.minMitigation=g.minMitigation})};vn(Pt,Tn),vn(Ut,Mn);const Bi=Y>0?Math.round(pe/Y):0,Ii=Y>0?Math.round(Te/Y):0,Li=Ne>0?(m/Ne).toFixed(2):m>0?"∞":"0.00",Pi=Me>0?(ue/Me).toFixed(2):ue>0?"∞":"0.00",Fn=(e,n)=>{const b=e.filter(g=>Number.isFinite(g.value)&&(n?g.value>0:g.value>=0)).sort((g,x)=>{const _=n?x.value-g.value:g.value-x.value;return _!==0?_:g.account.localeCompare(x.account)});let a=null,T=0;return b.map((g,x)=>((a===null||g.value!==a)&&(T=x+1,a=g.value),{rank:T,...g}))},Vt=Array.from(he.values()).map(e=>{const n=Array.from(e.professions).filter(i=>i!=="Unknown");if(e.professionList=n,n.length>0){let i=n[0],b=e.professionTimeMs[i]||0;n.forEach(a=>{const T=e.professionTimeMs[a]||0;T>b&&(b=T,i=a)}),e.profession=i}return{key:e.account,stat:e}}),En=e=>{const n=he.get(e.account);if(!n){const a=e.professionList.length>0?e.professionList:e.profession?[e.profession]:[];return{...e,professionList:a}}const i=n.professionList&&n.professionList.length>0?n.professionList:Array.from(n.professions||[]).filter(a=>a&&a!=="Unknown"),b=n.profession||e.profession;return{...e,profession:b,professionList:i.length>0?i:b?[b]:[],activeMs:n.defenseActiveMs||n.totalFightMs||e.activeMs}},Ui=Array.from(Pt.values()).map(En).filter(e=>Ei(e.mitigationTotals)).sort((e,n)=>e.account.localeCompare(n.account)),qi=Array.from(Ut.values()).map(En).filter(e=>e.mitigationTotals.totalMitigation>0).sort((e,n)=>{const i=e.account.localeCompare(n.account);return i!==0?i:String(e.minion||"").localeCompare(String(n.minion||""))}),$t=(e,n)=>{switch(n){case"downContrib":return e.downContrib;case"barrier":return e.barrier;case"healing":return e.healing;case"dodges":return e.dodges;case"strips":return e.strips;case"cleanses":return e.cleanses;case"cc":return e.cc;case"stability":return e.stab;case"revives":return e.revives;case"dps":return e.dps;case"damage":return e.damage;case"participation":return e.logsJoined;case"closestToTag":return!e.isCommander&&e.distCount>0?e.totalDist/e.distCount:Number.POSITIVE_INFINITY;default:return 0}},Ze=(e,n)=>Fn(Vt.map(({stat:i})=>({account:i.account,profession:i.profession,professionList:i.professionList,value:$t(i,e),count:i.logsJoined})),n),_e={downContrib:Ze("downContrib",!0),barrier:Ze("barrier",!0),healing:Ze("healing",!0),dodges:Ze("dodges",!0),strips:Ze("strips",!0),cleanses:Ze("cleanses",!0),cc:Ze("cc",!0),stability:Ze("stability",!0),revives:Ze("revives",!0),participation:Ze("participation",!0),dps:Ze("dps",!0),damage:Ze("damage",!0),closestToTag:Ze("closestToTag",!1).filter(e=>Number.isFinite(e.value))},Hi={downContrib:"downContrib",barrier:"barrier",healing:"healing",dodges:"dodges",strips:"strips",cleanses:"cleanses",cc:"cc",stability:"stability",closestToTag:"closestToTag"},Pe=e=>{const n=e==null?void 0:e[0];return{value:(n==null?void 0:n.value)??0,player:(n==null?void 0:n.account)??"-",count:(n==null?void 0:n.count)??0,profession:(n==null?void 0:n.profession)??"Unknown",professionList:(n==null?void 0:n.professionList)??[]}},at={maxDownContrib:Pe([]),maxBarrier:Pe([]),maxHealing:Pe([]),maxDodges:Pe([]),maxStrips:Pe([]),maxCleanses:Pe([]),maxCC:Pe([]),maxStab:Pe([]),closestToTag:Pe([])},st={},$i=(e,n)=>{if(n==="closestToTag")return $t(e,n);const i=Math.max(1,(e.totalFightMs||0)/1e3);return $t(e,n)/i};Object.values(Hi).forEach(e=>{const n=e!=="closestToTag";st[e]=Fn(Vt.map(({stat:i})=>({account:i.account,profession:i.profession,professionList:i.professionList,value:$i(i,e),count:i.logsJoined})),n)}),at.maxDownContrib=Pe(st.downContrib),at.maxBarrier=Pe(st.barrier),at.maxHealing=Pe(st.healing),at.maxDodges=Pe(st.dodges),at.maxStrips=Pe(st.strips),at.maxCleanses=Pe(st.cleanses),at.maxCC=Pe(st.cc),at.maxStab=Pe(st.stability),at.closestToTag=Pe(st.closestToTag);const xi={maxDownContrib:Pe(_e.downContrib),maxBarrier:Pe(_e.barrier),maxHealing:Pe(_e.healing),maxDodges:Pe(_e.dodges),maxStrips:Pe(_e.strips),maxCleanses:Pe(_e.cleanses),maxCC:Pe(_e.cc),maxStab:Pe(_e.stability),closestToTag:Pe(_e.closestToTag)};let Gt={player:"None",account:"None",score:-1,profession:"Unknown",professionList:[],color:"#64748b",topStats:[]},Bn,In,Ln=0;if(Ce!=null&&Ce.showMvp){const e={"Down Contribution":"downContribution",Healing:"healing",Cleanses:"cleanses",Strips:"strips",Stability:"stability",CC:"cc",Revives:"revives","Distance to Tag":"distanceToTag",Participation:"participation",Dodging:"dodging",DPS:"dps",Damage:"damage"},n=T=>{const g=e[T];return g?Number(oe[g]||0)>0:!1},i=[],b=T=>[...T||[]].filter(g=>n(g==null?void 0:g.name)).sort((g,x)=>x.ratio-g.ratio||g.rank-x.rank||g.name.localeCompare(x.name)).slice(0,3),a=T=>{var x;if(!T)return;const g=b(T.contribs);return{...T,player:T.name,reason:((x=g[0])==null?void 0:x.name)||"Top Performance",topStats:g}};Vt.forEach(({stat:T})=>{let g=0;const x=[],_=(K,ae,se,ve,E=!0)=>{var R,y;if(se<=0)return;const B=((R=ae[0])==null?void 0:R.value)||0;if(B&&Number.isFinite(K)&&(E?K>0:K<Number.POSITIVE_INFINITY)){const ce=E?K/B:B/K;g+=ce*se;const u=((y=ae.find(d=>d.account===T.account))==null?void 0:y.rank)||0;x.push({name:ve,ratio:ce,val:K.toLocaleString(),rank:u})}};_(T.downContrib,_e.downContrib,oe.downContribution,"Down Contribution"),_(T.healing,_e.healing,oe.healing,"Healing"),_(T.cleanses,_e.cleanses,oe.cleanses,"Cleanses"),_(T.strips,_e.strips,oe.strips,"Strips"),_(T.stab,_e.stability,oe.stability,"Stability"),_(T.cc,_e.cc,oe.cc,"CC"),_(T.revives,_e.revives,oe.revives,"Revives"),_($t(T,"closestToTag"),_e.closestToTag,oe.distanceToTag,"Distance to Tag",!1),_(T.logsJoined,_e.participation,oe.participation,"Participation"),_(T.dodges,_e.dodges,oe.dodging,"Dodging"),_(T.dps,_e.dps,oe.dps,"DPS"),_(T.damage,_e.damage,oe.damage,"Damage"),i.push({...T,score:g,contribs:x.filter(K=>n(K.name))})}),i.sort((T,g)=>g.score-T.score),i[0]&&i[0].score>0&&(Gt=a(i[0])||Gt),Bn=a(i[1]),In=a(i[2]),Ln=i.length>0?i.reduce((T,g)=>T+g.score,0)/i.length:0}const Pn=Object.values(ge).sort((e,n)=>n.damage-e.damage||n.hits-e.hits||String(e.name||"").localeCompare(String(n.name||""))).slice(0,25),Un=Object.values(ge).sort((e,n)=>n.downContribution-e.downContribution||n.hits-e.hits||String(e.name||"").localeCompare(String(n.name||""))).slice(0,25),Oi=z==="downContribution"?Un:Pn,Ri=Object.values(we).sort((e,n)=>n.damage-e.damage).slice(0,25),_i=e=>{const n=String(e).replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),i=n.match(/^(Red|Blue|Green)\s+(?:Alpine|Desert)?\s*Borderlands$/i);return i?`${i[1]} Borderlands`:n||"Unknown"},pt=(e,n)=>_i((e==null?void 0:e.zone)||(e==null?void 0:e.mapName)||(e==null?void 0:e.map)||(e==null?void 0:e.location)||(e==null?void 0:e.fightName)||(n==null?void 0:n.fightName)||(n==null?void 0:n.encounterName)||"Unknown"),Wi=(e,n)=>{const i=(n==null?void 0:n.permalink)||(e==null?void 0:e.permalink);if(typeof i=="string"&&i.trim().length>0)return i.trim();const b=e==null?void 0:e.uploadLinks;if(!Array.isArray(b))return"";for(const a of b){if(typeof a=="string"&&a.trim().length>0)return a.trim();if(a&&typeof a=="object"){const T=a.permalink||a.link||a.url||a.reportLink;if(typeof T=="string"&&T.trim().length>0)return T.trim()}}return""},Jt={};V.forEach(e=>{const n=pt(e==null?void 0:e.details,e);Jt[n]=(Jt[n]||0)+1});const ji=Object.entries(Jt).map(([e,n])=>{const i=String(e).trim(),b=/eternal battlegrounds|^ebg$/i.test(i);let a="#64748b";return b?a="#ffffff":/red/i.test(i)?a="#ef4444":/blue/i.test(i)?a="#3b82f6":/green/i.test(i)&&(a="#22c55e"),{name:e,value:n,color:a}}).sort((e,n)=>n.value-e.value),{boonTables:zi}=Zn(V),Ki=V.map((e,n)=>{var b,a;const i=((b=e.details)==null?void 0:b.players)||[];return{index:n+1,label:`Log ${n+1}`,timestamp:Ye(e.details,e),squadCount:i.filter(T=>!T.notInSquad).length,friendlyCount:i.length,enemies:((a=e.details)==null?void 0:a.targets).filter(T=>!T.isFake).length}}).sort((e,n)=>e.timestamp-n.timestamp),Yt={};Array.from(he.values()).forEach(e=>{e.profession&&e.profession!=="Unknown"&&(Yt[e.profession]=(Yt[e.profession]||0)+1)});const Vi=Object.entries(Yt).map(([e,n])=>({name:e,value:n,color:fn(e)})).sort((e,n)=>n.value-e.value),Qt={};Object.keys(He).length===0&&V.forEach(e=>{var n,i;(i=(n=e.details)==null?void 0:n.targets)==null||i.forEach(b=>{if(b.isFake)return;const a=b.profession&&b.profession!=="Unknown"?b.profession:b.name||b.id||"Unknown",T=et(a);Qt[T]=(Qt[T]||0)+1})});const Gi=Object.keys(He).length>0?He:Qt,Ji=Object.entries(Gi).map(([e,n])=>({name:e,value:n,color:fn(e)})).sort((e,n)=>n.value-e.value),qn=V.map((e,n)=>({log:e,originalIndex:n})).sort((e,n)=>Ye(e.log.details,e.log)-Ye(n.log.details,n.log)),Yi=qn.map(({log:e},n)=>{const i=e.details;if(!i)return null;const b=i.players||[],a=b.filter(c=>!c.notInSquad),T=b.filter(c=>c.notInSquad),x=(i.targets||[]).filter(c=>!c.isFake),_=a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.dpsAll)==null?void 0:q[0])==null?void 0:A.damage)||0)},0),K=a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.defenses)==null?void 0:q[0])==null?void 0:A.damageTaken)||0)},0),{enemyDeaths:ae,enemyDownsDeaths:se}=be(i),ve=ke(i),E=Ye(i,e),B=pt(i,e),R=c=>{if(!c||typeof c!="object")return;const w=c.teamID??c.teamId??c.team??c.teamColor??c.team_color;if(w!=null)return w;const q=Object.keys(c).find(A=>/^team/i.test(A));return q?c[q]:void 0},y=(c,w)=>{const q={};return c.forEach(A=>{const O=w(A),le=et(O);le&&(q[le]=(q[le]||0)+1)}),q},ce=y(a,c=>(c==null?void 0:c.profession)||(c==null?void 0:c.name)),u=y(T,c=>(c==null?void 0:c.profession)||(c==null?void 0:c.name)),d=y(x,c=>(c==null?void 0:c.profession)||(c==null?void 0:c.name)||(c==null?void 0:c.id)),M=new Set;a.forEach(c=>{const w=R(c);w!=null&&M.add(String(w))});const N=new Map;x.forEach(c=>{if((c==null?void 0:c.enemyPlayer)===!1)return;const w=R(c);if(w==null)return;const q=String(w);M.has(q)||N.set(q,(N.get(q)||0)+1)});const P=Array.from(N.entries()).sort((c,w)=>{const q=w[1]-c[1];return q!==0?q:c[0].localeCompare(w[0],void 0,{numeric:!0})}).slice(0,3).map(([c,w])=>({teamId:c,count:w}));return{id:e.filePath||`fight-${n}`,label:e.encounterName||`Fight ${n+1}`,permalink:Wi(i,e),timestamp:E,mapName:B,duration:Ft(i.durationMS),isWin:ve,squadCount:a.length,allyCount:T.length,enemyCount:x.length,teamBreakdown:P,alliesDown:a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.defenses)==null?void 0:q[0])==null?void 0:A.downCount)||0)},0),alliesDead:a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.defenses)==null?void 0:q[0])==null?void 0:A.deadCount)||0)},0),alliesRevived:a.reduce((c,w)=>{var q,A;return Number(((A=(q=w.statsAll)==null?void 0:q[0])==null?void 0:A.saved)||0)>0?c+1:c},0),rallies:0,enemyDeaths:ae,enemyDowns:Math.max(0,se-ae),totalOutgoingDamage:_,totalIncomingDamage:K,incomingBarrierAbsorbed:a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.defenses)==null?void 0:q[0])==null?void 0:A.damageBarrier)||0)},0),outgoingBarrierAbsorbed:a.reduce((c,w)=>{var O;const q=(O=w.extBarrierStats)==null?void 0:O.outgoingBarrier;if(!Array.isArray(q))return c;let A=0;return q.forEach(le=>{if(Array.isArray(le)){le.forEach(Ue=>{A+=Number((Ue==null?void 0:Ue.barrier)||0)});return}A+=Number((le==null?void 0:le.barrier)||0)}),c+A},0),squadClassCountsFight:ce,allyClassCountsFight:u,enemyClassCounts:d}}).filter(Boolean),Qi=qn.map(({log:e},n)=>{const i=e.details;if(!i)return null;const a=(Array.isArray(i.players)?i.players:[]).filter(t=>!t.notInSquad),T=Array.isArray(i.targets)?i.targets:[],g=Ye(i,e),x=pt(i,e),_=Number(i.durationMS||0),{squadDownsDeaths:K,enemyDownsDeaths:ae,squadDeaths:se,enemyDeaths:ve}=be(i),E=new Map,B=(t,s,h)=>{const v=E.get(t)||{label:t,damage:0,hits:0};v.damage+=s,v.hits+=h,E.set(t,v)};if(a.forEach(t=>{(Array.isArray(t==null?void 0:t.statsTargets)?t.statsTargets:[]).forEach((h,v)=>{const D=Array.isArray(h)?h[0]:h,o=Number((D==null?void 0:D.damage)??(D==null?void 0:D.totalDmg)??(D==null?void 0:D.connectedDmg)??0),S=Number((D==null?void 0:D.connectedHits)??(D==null?void 0:D.connectedDamageCount)??(D==null?void 0:D.hits)??0);if(o<=0&&S<=0)return;const f=T[v];if(f!=null&&f.isFake)return;const U=(f==null?void 0:f.profession)||(f==null?void 0:f.name)||(f==null?void 0:f.id)||`Target ${v+1}`,ne=et(U);B(ne||String(U),o,S)})}),E.size===0){const t=new Map,s=h=>{if(!Array.isArray(h)||h.length===0)return[];const v=h[0];if(Array.isArray(v)&&Array.isArray(v[0])){if(typeof v[0][0]=="number")return v;if(Array.isArray(v[0])&&typeof v[0][0]=="number")return h.map(D=>Array.isArray(D)?D[0]||[]:[])}return[]};a.forEach(h=>{s(h==null?void 0:h.targetDamage1S).forEach((D,o)=>{if(!Array.isArray(D)||D.length===0)return;const S=D.map(U=>Number(U)).filter(U=>Number.isFinite(U)&&U>=0);if(S.length===0)return;const f=Math.max(0,S[S.length-1]||0);f<=0||t.set(o,(t.get(o)||0)+f)})}),t.forEach((h,v)=>{if(h<=0)return;const D=T[v];if(D!=null&&D.isFake)return;const o=(D==null?void 0:D.profession)||(D==null?void 0:D.name)||(D==null?void 0:D.id)||`Target ${v+1}`,S=et(o);B(S||String(o),h,0)})}if(E.size===0&&T.forEach((t,s)=>{if(t!=null&&t.isFake)return;const h=Array.isArray(t==null?void 0:t.totalDamageTaken)?t.totalDamageTaken:Array.isArray(t==null?void 0:t.totalDamageDist)?t.totalDamageDist:[];let v=0,D=0;if(h.forEach(f=>{v+=Number((f==null?void 0:f.totalDamage)||(f==null?void 0:f.damage)||0),D+=Number((f==null?void 0:f.connectedHits)||(f==null?void 0:f.hits)||0)}),v<=0&&Number((t==null?void 0:t.damageTaken)||0)>0&&(v=Number(t.damageTaken||0)),v<=0&&D<=0)return;const o=(t==null?void 0:t.profession)||(t==null?void 0:t.name)||(t==null?void 0:t.id)||`Target ${s+1}`,S=et(o);B(S||String(o),v,D)}),E.size===0){const t=new Map;T.forEach((s,h)=>{if(s!=null&&s.isFake)return;const v=(s==null?void 0:s.profession)||(s==null?void 0:s.name)||(s==null?void 0:s.id)||`Target ${h+1}`,D=et(v)||String(v);t.set(D,(t.get(D)||0)+1)}),t.forEach((s,h)=>{s>0&&B(h,s,0)})}const R=Array.from(E.values()).sort((t,s)=>s.damage-t.damage||s.hits-t.hits||t.label.localeCompare(s.label)),y=R.reduce((t,s)=>t+s.damage,0),ce=R.map(t=>({label:t.label,damage:t.damage,hits:t.hits,share:y>0?t.damage/y:0})),u=T.filter(t=>!(t!=null&&t.isFake)).length,d=a.length,M=a.reduce((t,s)=>{var h,v;return t+Number(((v=(h=s==null?void 0:s.dpsAll)==null?void 0:h[0])==null?void 0:v.damage)||0)},0),N=a.reduce((t,s)=>{var h,v;return t+Number(((v=(h=s==null?void 0:s.defenses)==null?void 0:h[0])==null?void 0:v.damageTaken)||0)},0),P=a.reduce((t,s)=>{var h,v;return t+Number(((v=(h=s==null?void 0:s.defenses)==null?void 0:h[0])==null?void 0:v.damageBarrier)||0)},0),c=a.reduce((t,s)=>{var D;const h=(D=s==null?void 0:s.extBarrierStats)==null?void 0:D.outgoingBarrier;if(!Array.isArray(h))return t;let v=0;return h.forEach(o=>{Array.isArray(o)?o.forEach(S=>{v+=Number((S==null?void 0:S.barrier)||0)}):v+=Number((o==null?void 0:o.barrier)||0)}),t+v},0),w=a.reduce((t,s)=>{var h,v;return Number(((v=(h=s==null?void 0:s.statsAll)==null?void 0:h[0])==null?void 0:v.saved)||0)>0?t+1:t},0),q=a.reduce((t,s)=>t+Number(sn(s)||0),0),A=a.reduce((t,s)=>t+Number(an(s)||0),0),O=a.reduce((t,s)=>t+Number((s==null?void 0:s.stabGeneration)||0),0),le=a.reduce((t,s)=>t+Number(cn(s)||0),0),Ue=a.reduce((t,s)=>t+Number(ln(s)||0),0),Ee=a.reduce((t,s)=>t+Number(un(s)||0),0),je=a.reduce((t,s)=>t+Number(rn(s)||0),0),me=se>0?ve/se:ve,$e=[{metricId:"winFlag",metricLabel:"Win (1) / Loss (0)",higherIsBetter:!0,value:ke(i)?1:0},{metricId:"squadCount",metricLabel:"Squad Size",higherIsBetter:!0,value:d},{metricId:"enemyCount",metricLabel:"Enemy Count",higherIsBetter:!1,value:u},{metricId:"squadKdr",metricLabel:"Squad KDR",higherIsBetter:!0,value:me},{metricId:"enemyDeaths",metricLabel:"Enemy Deaths",higherIsBetter:!0,value:ve},{metricId:"enemyDowns",metricLabel:"Enemy Downs",higherIsBetter:!0,value:Math.max(0,ae-ve)},{metricId:"squadDeaths",metricLabel:"Squad Deaths",higherIsBetter:!1,value:se},{metricId:"squadDowns",metricLabel:"Squad Downs",higherIsBetter:!1,value:Math.max(0,K-se)},{metricId:"damageDelta",metricLabel:"Damage Delta",higherIsBetter:!0,value:M-N},{metricId:"outgoingDamage",metricLabel:"Outgoing Damage",higherIsBetter:!0,value:M},{metricId:"incomingDamage",metricLabel:"Incoming Damage",higherIsBetter:!1,value:N},{metricId:"cleanses",metricLabel:"Squad Cleanses",higherIsBetter:!0,value:q},{metricId:"strips",metricLabel:"Squad Strips",higherIsBetter:!0,value:A},{metricId:"stability",metricLabel:"Squad Stability",higherIsBetter:!0,value:O},{metricId:"healing",metricLabel:"Squad Healing",higherIsBetter:!0,value:le},{metricId:"barrierOut",metricLabel:"Squad Barrier Out",higherIsBetter:!0,value:Ue},{metricId:"barrierIncomingAbsorb",metricLabel:"Barrier Absorption (Incoming)",higherIsBetter:!0,value:P},{metricId:"enemyBarrierAbsorb",metricLabel:"Enemy Barrier Absorption",higherIsBetter:!1,value:c},{metricId:"cc",metricLabel:"Squad CC",higherIsBetter:!0,value:Ee},{metricId:"downContrib",metricLabel:"Squad Down Contribution",higherIsBetter:!0,value:je},{metricId:"alliesRevived",metricLabel:"Allies Revived (Players)",higherIsBetter:!0,value:w}];return{id:e.filePath||e.id||`fight-${n+1}`,shortLabel:`F${n+1}`,fullLabel:`${x||e.encounterName||"Unknown Map"} • ${Ft(_)}`,mapName:x,timestamp:g,duration:Ft(_),isWin:ke(i),targetFocus:ce,squadMetrics:$e}}).filter(Boolean),Xi=Array.from(he.values()).map(e=>{const n=Object.entries(e.professionTimeMs||{}).map(([i,b])=>({profession:i,timeMs:Number(b||0)})).filter(i=>i.profession&&i.profession!=="Unknown"&&i.timeMs>0).sort((i,b)=>{const a=b.timeMs-i.timeMs;return a!==0?a:i.profession.localeCompare(b.profession)});return{account:e.account||"Unknown",characterNames:Array.from(e.characterNames||[]).filter(Boolean).sort((i,b)=>i.localeCompare(b)),classTimes:n,combatTimeMs:Number(e.squadActiveMs||e.totalFightMs||0),squadTimeMs:(()=>{const i=Number(e.firstSeenFightTs||0),b=Number(e.lastSeenFightTs||0),a=Math.max(0,Number(e.lastSeenFightDurationMs||0));return i>0&&b>0?Math.max(0,b+a-i):Number(e.squadActiveMs||e.totalFightMs||0)})()}}).filter(e=>e.account&&e.account!=="Unknown").sort((e,n)=>{const i=n.squadTimeMs-e.squadTimeMs;return i!==0?i:String(e.account).localeCompare(String(n.account))}),Zi=V.map(e=>e).sort((e,n)=>Ye(e.details,e)-Ye(n.details,n)).map((e,n)=>{const i=e==null?void 0:e.details,b=Array.isArray(i==null?void 0:i.players)?i.players.filter(g=>!(g!=null&&g.notInSquad)):[],a=new Map;b.forEach(g=>{const x=Number(g==null?void 0:g.group),_=Number.isFinite(x)&&x>0?x:0;a.has(_)||a.set(_,{party:_,players:[],classCounts:{}});const K=et((g==null?void 0:g.profession)||(g==null?void 0:g.name)||"Unknown"),ae=String((g==null?void 0:g.account)||"Unknown"),se=String((g==null?void 0:g.name)||(g==null?void 0:g.character_name)||""),ve=!!(g!=null&&g.hasCommanderTag),E=a.get(_);E.players.push({account:ae,characterName:se,profession:K,isCommander:ve}),E.classCounts[K]=(E.classCounts[K]||0)+1});const T=Array.from(a.values()).map(g=>({...g,players:g.players.sort((x,_)=>{const K=+!!_.isCommander-+!!x.isCommander;if(K!==0)return K;const ae=String(x.profession).localeCompare(String(_.profession));return ae!==0?ae:String(x.account).localeCompare(String(_.account))})})).sort((g,x)=>g.party===0&&x.party!==0?1:x.party===0&&g.party!==0?-1:g.party-x.party);return{id:String((e==null?void 0:e.filePath)||(e==null?void 0:e.id)||`fight-${n+1}`),label:`F${n+1}`,timestamp:Ye(i,e),mapName:pt(i,e),duration:Ft(Number((i==null?void 0:i.durationMS)||0)),parties:T}}),yi=(e,n)=>{const i=(n==null?void 0:n.skillMap)||{},b=(n==null?void 0:n.buffMap)||{};let a=0,T="";const g=K=>{const ae=Number(K);if(!Number.isFinite(ae))return String(K||"Unknown Skill");const se=(i==null?void 0:i[`s${ae}`])||(i==null?void 0:i[`${ae}`]);if(se!=null&&se.name)return String(se.name);const ve=(b==null?void 0:b[`b${ae}`])||(b==null?void 0:b[`${ae}`]);return ve!=null&&ve.name?String(ve.name):`Skill ${ae}`},x=K=>{if(!K||typeof K!="object")return;const ae=[Number(K.max),Number(K.maxDamage),Number(K.maxHit)].filter(ve=>Number.isFinite(ve)),se=ae.length>0?Math.max(...ae):0;se>a&&(a=se,T=g(K.id))};let _=!1;return Array.isArray(e==null?void 0:e.targetDamageDist)&&e.targetDamageDist.forEach(K=>{Array.isArray(K)&&K.forEach(ae=>{Array.isArray(ae)&&ae.forEach(se=>{_=!0,x(se)})})}),(!_||a<=0)&&Array.isArray(e==null?void 0:e.totalDamageDist)&&e.totalDamageDist.forEach(K=>{Array.isArray(K)&&K.forEach(ae=>x(ae))}),{peak:a,skillName:T||"Unknown Skill"}},eo=(()=>{const e=E=>String(E||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),n=E=>e(E).toLowerCase().split(/[^a-z0-9]+/i).map(B=>B.trim()).filter(Boolean).map(B=>B.length>3&&B.endsWith("s")?B.slice(0,-1):B),i=(E,B)=>{const R=e(E),y=e(B);if(!y)return R;if(!R)return y;const ce=n(R),u=n(y),d=new Set(ce),M=new Set(u),N=u.length>0&&u.every(c=>d.has(c)),P=ce.length>0&&ce.every(c=>M.has(c));return N||P?R:`${R} - ${y}`},b=[],a=new Map,T=E=>{const B=N=>{if(!Array.isArray(N)||N.length===0)return[];const P=[];for(let c=0;c<N.length;c+=1){const w=Number(N[c]||0),q=c>0?Number(N[c-1]||0):0;P.push(Math.max(0,w-q))}return P},R=N=>{if(!Array.isArray(N))return[];const P=N.reduce((w,q)=>Math.max(w,Array.isArray(q)?q.length:0),0);if(P<=0)return[];const c=new Array(P).fill(0);return N.forEach(w=>{if(Array.isArray(w))for(let q=0;q<P;q+=1)c[q]+=Number(w[q]||0)}),c},y=N=>Array.isArray(N)?N.map(P=>Number(P||0)):null,u=(N=>{if(!Array.isArray(N)||N.length===0)return null;const P=N[0];if(!Array.isArray(P))return null;if(Array.isArray(P[0])&&Array.isArray(P[0][0]))return R(P);if(Array.isArray(P[0])&&!Array.isArray(P[0][0])){const c=N.map(w=>y(Array.isArray(w)?w[0]:null)).filter(w=>Array.isArray(w)&&w.length>0);if(c.length>0)return R(c)}return null})(E==null?void 0:E.targetDamage1S),d=Array.isArray(E==null?void 0:E.damage1S)&&Array.isArray(E.damage1S[0])?E.damage1S[0]:null,M=u||(Array.isArray(d)?d.map(N=>Number(N||0)):[]);return B(M)},g=(E,B)=>{if(!Array.isArray(E)||E.length===0||B<=0)return 0;let R=0,y=0;for(let ce=0;ce<E.length;ce+=1)R+=Number(E[ce]||0),ce>=B&&(R-=Number(E[ce-B]||0)),ce>=B-1&&R>y&&(y=R);return Math.max(0,y)},x=(E,B)=>{if(!Array.isArray(E)||E.length===0||B<=0)return[];const R=[];for(let y=0;y<E.length;y+=B){const ce=Math.min(y+B,E.length),u=E.slice(y,ce).reduce((d,M)=>d+Number(M||0),0);R.push(u)}return R},_=(E,B)=>{const R=Number(E);if(!Number.isFinite(R))return{name:String(E||"Unknown Skill"),icon:void 0};const y=(B==null?void 0:B.skillMap)||{},ce=(B==null?void 0:B.buffMap)||{},u=(y==null?void 0:y[`s${R}`])||(y==null?void 0:y[`${R}`]);if(u!=null&&u.name)return{name:String(u.name),icon:u==null?void 0:u.icon};const d=(ce==null?void 0:ce[`b${R}`])||(ce==null?void 0:ce[`${R}`]);return d!=null&&d.name?{name:String(d.name),icon:d==null?void 0:d.icon}:{name:`Skill ${R}`,icon:void 0}},K=E=>Array.isArray(E)?E.map(B=>Array.isArray(B)?[Number(B[0]),Number(B[1])]:B&&typeof B=="object"?[Number(B.time),Number(B.value)]:null).filter(B=>!!B&&Number.isFinite(B[0])&&B[0]>=0):[],ae=(E,B,R,y,ce)=>{if(!E.length||y<=0)return[];const u=Math.max(y*5e3,ce||0),d=O=>O.reduce((le,Ue)=>Ue>=0&&Ue<=u+2e3?le+1:le,0),M=E.map(O=>Number(O||0)).filter(O=>Number.isFinite(O)&&O>=0);if(!M.length)return[];const N=[M],P=M.reduce((O,le)=>Math.max(O,le),0),c=M.reduce((O,le)=>Math.min(O,le),Number.POSITIVE_INFINITY);P>u*20&&N.push(M.map(O=>O/1e3)),P<=u*2&&c>=0&&P>0&&P<Math.max(120,y*5+10)&&N.push(M.map(O=>O*1e3));let w=M,q=0,A=-1;return N.forEach(O=>{const le=O.reduce((Ee,je)=>Math.min(Ee,je),Number.POSITIVE_INFINITY),Ue=new Set([0,...B,...R]);if(Number.isFinite(le)&&u>0&&le>u){const Ee=Math.floor(le/u)*u;Ue.add(Ee),Ue.add(Math.max(0,Ee-u))}Ue.forEach(Ee=>{const je=O.map($e=>$e-Ee),me=d(je);me>A&&(A=me,q=Ee,w=O)})}),w.map(O=>O-q).filter(O=>Number.isFinite(O)&&O>=0)},se=(E,B,R,y,ce)=>{const u=ae(E,B,R,y,ce);return Array.from(new Set(u.map(d=>Math.floor(d/5e3)).filter(d=>Number.isFinite(d)&&d>=0&&d<y)))};V.map(E=>({log:E,ts:Ye(E==null?void 0:E.details,E)})).sort((E,B)=>E.ts-B.ts).forEach(({log:E},B)=>{const R=E==null?void 0:E.details;if(!R)return;const y=e(R.fightName||E.fightName||`Fight ${B+1}`),ce=pt(R,E),u=i(y,String(ce||"")),d={},M=Array.isArray(R.players)?R.players:[],N=M.flatMap(A=>{const O=A==null?void 0:A.combatReplayData;return Array.isArray(O)?O.map(le=>Number(le==null?void 0:le.start)):[Number(O==null?void 0:O.start)]}).filter(A=>Number.isFinite(A)&&A>=0);M.forEach(A=>{if(A!=null&&A.notInSquad)return;const O=String((A==null?void 0:A.account)||(A==null?void 0:A.name)||"Unknown"),le=String((A==null?void 0:A.character_name)||(A==null?void 0:A.display_name)||(A==null?void 0:A.name)||""),Ue=String((A==null?void 0:A.profession)||"Unknown"),Ee=`${O}|${Ue}`,je=yi(A,R),me=Number(je.peak||0),$e=T(A),t=Number(g($e,1)||0),s=Number(g($e,5)||0),h=Number(g($e,30)||0),v=Math.max(0,Math.ceil(Number((R==null?void 0:R.durationMS)||0)/5e3)),D=Math.max(0,Math.ceil($e.length/5)),o=Math.max(v,D),S=x($e,5),f=Array.from({length:o},(C,$)=>Number(S[$]||0)),U=new Map,ne=C=>{if(!C||typeof C!="object"||C.indirectDamage)return;const $=Number(C.totalDamage||0);if(!Number.isFinite($)||$<=0)return;const G=Number(C.connectedHits||C.hits||0),J=_(C.id,R),De=J.name,Ie=U.get(De)||{skillName:De,damage:0,hits:0,icon:J.icon};Ie.damage+=$,Ie.hits+=Number.isFinite(G)?G:0,!Ie.icon&&J.icon&&(Ie.icon=J.icon),U.set(De,Ie)},ee=new Map;Array.isArray(A==null?void 0:A.targetDamageDist)&&A.targetDamageDist.forEach(C=>{Array.isArray(C)&&C.forEach($=>{Array.isArray($)&&$.forEach(G=>{const J=Number(G==null?void 0:G.id),De=Number((G==null?void 0:G.totalDamage)||0);if(Number.isFinite(J)){const Ie=ee.get(J)||{damage:0,hits:0};Ie.damage+=Number.isFinite(De)?De:0,Ie.hits+=Number((G==null?void 0:G.connectedHits)||(G==null?void 0:G.hits)||0),ee.set(J,Ie)}ne(G)})})}),!(R!=null&&R.detailedWvW)&&Array.isArray(A==null?void 0:A.totalDamageDist)&&A.totalDamageDist.forEach(C=>{Array.isArray(C)&&C.forEach($=>{const G=Number($==null?void 0:$.id);if(!Number.isFinite(G)){ne($);return}const J=ee.get(G);if(!J){ne($);return}const De=Number(($==null?void 0:$.totalDamage)||0),Ie=Number(($==null?void 0:$.connectedHits)||($==null?void 0:$.hits)||0),Ve=De-Number(J.damage||0),Qe=Ie-Number(J.hits||0);Ve<=0&&Qe<=0||ne({...$,totalDamage:Math.max(0,Ve),connectedHits:Math.max(0,Qe),hits:Math.max(0,Qe)})})});const Z=(()=>{const C=A==null?void 0:A.combatReplayData;return Array.isArray(C)?C.filter($=>$&&typeof $=="object"):C&&typeof C=="object"?[C]:[]})(),ie=Z.map(C=>Number(C==null?void 0:C.start)).filter(C=>Number.isFinite(C)&&C>=0),re=Z.flatMap(C=>K(C==null?void 0:C.down).map(([$])=>Number($||0))),te=Z.flatMap(C=>K(C==null?void 0:C.dead).map(([$])=>Number($||0)));d[Ee]={hit:me,burst1s:t,burst5s:s,burst30s:h,skillName:je.skillName,buckets5s:f,downIndices5s:se(re,ie,N,o,Number((R==null?void 0:R.durationMS)||0)),deathIndices5s:se(te,ie,N,o,Number((R==null?void 0:R.durationMS)||0)),skillRows:Array.from(U.values()).sort((C,$)=>$.damage-C.damage).slice(0,50)};const Q=a.get(Ee)||{key:Ee,account:O,displayName:O,characterName:le,profession:Ue,professionList:[Ue],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakFightLabel:"",peakSkillName:""};Q.logs+=1,Q.professionList.includes(Ue)||Q.professionList.push(Ue),!Q.characterName&&le&&(Q.characterName=le),me>Q.peakHit&&(Q.peakHit=me,Q.peakFightLabel=u,Q.peakSkillName=je.skillName),t>Q.peak1s&&(Q.peak1s=t),s>Q.peak5s&&(Q.peak5s=s),h>Q.peak30s&&(Q.peak30s=h),a.set(Ee,Q)});const P=Object.values(d).reduce((A,O)=>Math.max(A,Number((O==null?void 0:O.hit)||0)),0),c=Object.values(d).reduce((A,O)=>Math.max(A,Number((O==null?void 0:O.burst1s)||0)),0),w=Object.values(d).reduce((A,O)=>Math.max(A,Number((O==null?void 0:O.burst5s)||0)),0),q=Object.values(d).reduce((A,O)=>Math.max(A,Number((O==null?void 0:O.burst30s)||0)),0);b.push({id:E.filePath||E.id||`fight-${B+1}`,shortLabel:`F${B+1}`,fullLabel:u,timestamp:Ye(R,E),values:d,maxHit:P,max1s:c,max5s:w,max30s:q})});const ve=Array.from(a.values()).sort((E,B)=>B.peakHit!==E.peakHit?B.peakHit-E.peakHit:E.displayName.localeCompare(B.displayName));return{fights:b,players:ve}})(),to=(()=>{const e=u=>String(u||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),n=u=>e(u).toLowerCase().split(/[^a-z0-9]+/i).map(d=>d.trim()).filter(Boolean).map(d=>d.length>3&&d.endsWith("s")?d.slice(0,-1):d),i=(u,d)=>{const M=e(u),N=e(d);if(!N)return M;if(!M)return N;const P=n(M),c=n(N),w=new Set(P),q=new Set(c),A=c.length>0&&c.every(le=>w.has(le)),O=P.length>0&&P.every(le=>q.has(le));return A||O?M:`${M} - ${N}`},b=[],a=new Map,T=(u,d)=>{const M=Number(u);if(!Number.isFinite(M))return{name:String(u||"Unknown Skill"),icon:void 0};const N=(d==null?void 0:d.skillMap)||{},P=(d==null?void 0:d.buffMap)||{},c=(N==null?void 0:N[`s${M}`])||(N==null?void 0:N[`${M}`]);if(c!=null&&c.name)return{name:String(c.name),icon:c==null?void 0:c.icon};const w=(P==null?void 0:P[`b${M}`])||(P==null?void 0:P[`${M}`]);return w!=null&&w.name?{name:String(w.name),icon:w==null?void 0:w.icon}:{name:`Skill ${M}`,icon:void 0}},g=(u,d)=>{let M=0,N="";const P=c=>{if(!c||typeof c!="object"||c.indirectDamage)return;const w=[Number(c.max),Number(c.maxDamage),Number(c.maxHit)].filter(A=>Number.isFinite(A)),q=w.length>0?Math.max(...w):0;q>M&&(M=q,N=T(c.id,d).name)};return Array.isArray(u==null?void 0:u.totalDamageDist)&&u.totalDamageDist.forEach(c=>{Array.isArray(c)&&c.forEach(w=>P(w))}),Array.isArray(u==null?void 0:u.targetDamageDist)&&u.targetDamageDist.forEach(c=>{Array.isArray(c)&&c.forEach(w=>{Array.isArray(w)&&w.forEach(q=>P(q))})}),{peak:M,skillName:N||"Unknown Skill"}},x=u=>{if(!Array.isArray(u)||u.length===0)return[];const d=[];for(let M=0;M<u.length;M+=1){const N=Number(u[M]||0),P=M>0?Number(u[M-1]||0):0;d.push(Math.max(0,N-P))}return d},_=u=>{if(!Array.isArray(u)||u.length===0)return[];const d=u.reduce((N,P)=>Math.max(N,Array.isArray(P)?P.length:0),0);if(d<=0)return[];const M=new Array(d).fill(0);return u.forEach(N=>{if(Array.isArray(N))for(let P=0;P<d;P+=1)M[P]+=Number(N[P]||0)}),M},K=u=>{if(!Array.isArray(u)||u.length===0)return[];const d=u[0];if(typeof d=="number")return u.map(M=>Number(M||0));if(Array.isArray(d)&&d.length>0){if(typeof d[0]=="number")return d.map(M=>Number(M||0));if(Array.isArray(d[0])){const M=d.map(N=>Array.isArray(N)?N.map(P=>Number(P||0)):null).filter(N=>Array.isArray(N)&&N.length>0);if(M.length>0)return _(M)}}return[]},ae=u=>{const d=K(u==null?void 0:u.powerDamage1S),M=K(u==null?void 0:u.damage1S),N=d.length>0?d:M;return x(N)},se=(u,d)=>{const M=u==null?void 0:u.targetPowerDamage1S;if(!Array.isArray(M)||!Array.isArray(M[d]))return[];const N=M[d];if(!Array.isArray(N)||N.length===0)return[];if(typeof N[0]=="number")return N.map(P=>Number(P||0));if(Array.isArray(N[0])&&!Array.isArray(N[0][0]))return N[0].map(P=>Number(P||0));if(Array.isArray(N[0])&&Array.isArray(N[0][0])){const c=N[0].map(w=>Array.isArray(w)?w.map(q=>Number(q||0)):null).filter(w=>Array.isArray(w)&&w.length>0);return _(c)}return[]},ve=(u,d)=>{if(!Array.isArray(u)||u.length===0||d<=0)return 0;let M=0,N=0;for(let P=0;P<u.length;P+=1)M+=Number(u[P]||0),P>=d&&(M-=Number(u[P-d]||0)),P>=d-1&&M>N&&(N=M);return Math.max(0,N)},E=(u,d)=>{if(!Array.isArray(u)||u.length===0||d<=0)return[];const M=[];for(let N=0;N<u.length;N+=d){const P=Math.min(N+d,u.length),c=u.slice(N,P).reduce((w,q)=>w+Number(q||0),0);M.push(c)}return M},B=u=>Array.isArray(u)?u.map(d=>Array.isArray(d)?[Number(d[0]),Number(d[1])]:d&&typeof d=="object"?[Number(d.time),Number(d.value)]:null).filter(d=>!!d&&Number.isFinite(d[0])&&d[0]>=0):[],R=(u,d,M,N,P)=>{if(!u.length||N<=0)return[];const c=Math.max(N*5e3,P||0),w=me=>me.reduce(($e,t)=>t>=0&&t<=c+2e3?$e+1:$e,0),q=u.map(me=>Number(me||0)).filter(me=>Number.isFinite(me)&&me>=0);if(!q.length)return[];const A=[q],O=q.reduce((me,$e)=>Math.max(me,$e),0),le=q.reduce((me,$e)=>Math.min(me,$e),Number.POSITIVE_INFINITY);O>c*20&&A.push(q.map(me=>me/1e3)),O<=c*2&&le>=0&&O>0&&O<Math.max(120,N*5+10)&&A.push(q.map(me=>me*1e3));let Ue=q,Ee=0,je=-1;return A.forEach(me=>{const $e=me.reduce((s,h)=>Math.min(s,h),Number.POSITIVE_INFINITY),t=new Set([0,...d,...M]);if(Number.isFinite($e)&&c>0&&$e>c){const s=Math.floor($e/c)*c;t.add(s),t.add(Math.max(0,s-c))}t.forEach(s=>{const h=me.map(D=>D-s),v=w(h);v>je&&(je=v,Ee=s,Ue=me)})}),Ue.map(me=>me-Ee).filter(me=>Number.isFinite(me)&&me>=0)},y=(u,d,M,N,P)=>{const c=R(u,d,M,N,P);return Array.from(new Set(c.map(w=>Math.floor(w/5e3)).filter(w=>Number.isFinite(w)&&w>=0&&w<N)))};V.map(u=>({log:u,ts:Ye(u==null?void 0:u.details,u)})).sort((u,d)=>u.ts-d.ts).forEach(({log:u},d)=>{const M=u==null?void 0:u.details;if(!M)return;const N=e(M.fightName||u.fightName||`Fight ${d+1}`),P=pt(M,u),c=i(N,String(P||"")),w={},A=(Array.isArray(M.players)?M.players:[]).filter(o=>!(o!=null&&o.notInSquad)),O=A.flatMap(o=>{const S=o==null?void 0:o.combatReplayData;return Array.isArray(S)?S.map(f=>Number(f==null?void 0:f.start)):[Number(S==null?void 0:S.start)]}).filter(o=>Number.isFinite(o)&&o>=0),le=A.flatMap(o=>{const S=o==null?void 0:o.combatReplayData;return(Array.isArray(S)?S:S?[S]:[]).flatMap(U=>B(U==null?void 0:U.down).map(([ne])=>Number(ne||0)))}),Ue=A.flatMap(o=>{const S=o==null?void 0:o.combatReplayData;return(Array.isArray(S)?S:S?[S]:[]).flatMap(U=>B(U==null?void 0:U.dead).map(([ne])=>Number(ne||0)))}),Ee=new Map,je=new Map,me=new Map;(Array.isArray(M.targets)?M.targets:[]).forEach((o,S)=>{if(!o||o.isFake||!o.enemyPlayer)return;const f=et((o==null?void 0:o.profession)||(o==null?void 0:o.name)||(o==null?void 0:o.id))||"Unknown";me.set(f,(me.get(f)||0)+1);const U=je.get(f)||new Map;Array.isArray(o==null?void 0:o.totalDamageDist)&&o.totalDamageDist.forEach(re=>{Array.isArray(re)&&re.forEach(te=>{if(!te||typeof te!="object"||te.indirectDamage)return;const Q=Number(te.totalDamage||0);if(!Number.isFinite(Q)||Q<=0)return;const C=Number(te.connectedHits||te.hits||0),$=T(te.id,M),G=$.name,J=U.get(G)||{skillName:G,damage:0,hits:0,icon:$.icon};J.damage+=Q,J.hits+=Number.isFinite(C)?C:0,!J.icon&&$.icon&&(J.icon=$.icon),U.set(G,J)})}),je.set(f,U);const ne=_(A.map(re=>se(re,S))),ee=ne.length>0?x(ne):ae(o),W=g(o,M);let Z=Ee.get(f);Z||(Z={perSecond:[],hit:0,skillName:""},Ee.set(f,Z)),ee.length>Z.perSecond.length&&(Z.perSecond.length=ee.length);for(let re=0;re<ee.length;re+=1)Z.perSecond[re]=Number(Z.perSecond[re]||0)+Number(ee[re]||0);const ie=Number(W.peak||0);ie>Z.hit&&(Z.hit=ie,Z.skillName=W.skillName||"Unknown Skill")});const t=Array.from(Ee.values()).some(o=>Array.isArray(o.perSecond)&&o.perSecond.some(S=>Number(S||0)>0));if(Ee.size===0||!t){const o=_(A.map(f=>{const U=K(f==null?void 0:f.powerDamageTaken1S);return x(U)})),S=Array.from(me.values()).reduce((f,U)=>f+Number(U||0),0);o.length>0&&S>0&&me.forEach((f,U)=>{const ne=Number(f||0)/S,ee=o.map(Z=>Number(Z||0)*ne),W=Ee.get(U);Ee.set(U,{perSecond:ee,hit:Number((W==null?void 0:W.hit)||0),skillName:String((W==null?void 0:W.skillName)||"")})})}Ee.forEach((o,S)=>{var $;const f=S,U=Number(o.hit||0),ne=Number(ve(o.perSecond,1)||0),ee=Number(ve(o.perSecond,5)||0),W=Number(ve(o.perSecond,30)||0),Z=Math.max(0,Math.ceil(Number((M==null?void 0:M.durationMS)||0)/5e3)),ie=Math.max(0,Math.ceil(o.perSecond.length/5)),re=Math.max(Z,ie),te=E(o.perSecond,5),Q=Array.from({length:re},(G,J)=>Number(te[J]||0));w[f]={hit:U,burst1s:ne,burst5s:ee,burst30s:W,skillName:o.skillName||"Unknown Skill",buckets5s:Q,downIndices5s:y(le,[],O,re,Number((M==null?void 0:M.durationMS)||0)),deathIndices5s:y(Ue,[],O,re,Number((M==null?void 0:M.durationMS)||0)),skillRows:Array.from((($=je.get(S))==null?void 0:$.values())||[]).sort((G,J)=>J.damage-G.damage).slice(0,50)};const C=a.get(f)||{key:f,account:S,displayName:S,characterName:"",profession:S,professionList:[S],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakFightLabel:"",peakSkillName:""};C.logs+=1,U>C.peakHit&&(C.peakHit=U,C.peakFightLabel=c,C.peakSkillName=o.skillName||"Unknown Skill"),ne>C.peak1s&&(C.peak1s=ne),ee>C.peak5s&&(C.peak5s=ee),W>C.peak30s&&(C.peak30s=W),a.set(f,C)});const s=Object.values(w).reduce((o,S)=>Math.max(o,Number((S==null?void 0:S.hit)||0)),0),h=Object.values(w).reduce((o,S)=>Math.max(o,Number((S==null?void 0:S.burst1s)||0)),0),v=Object.values(w).reduce((o,S)=>Math.max(o,Number((S==null?void 0:S.burst5s)||0)),0),D=Object.values(w).reduce((o,S)=>Math.max(o,Number((S==null?void 0:S.burst30s)||0)),0);b.push({id:u.filePath||u.id||`fight-${d+1}`,shortLabel:`F${d+1}`,fullLabel:c,timestamp:Ye(M,u),values:w,maxHit:s,max1s:h,max5s:v,max30s:D})});const ce=Array.from(a.values()).sort((u,d)=>d.peakHit!==u.peakHit?d.peakHit-u.peakHit:u.displayName.localeCompare(d.displayName));return{fights:b,players:ce}})(),no=Array.from(Ge.entries()).map(([e,n])=>{const i=Re.get(e)||{},b=Array.from(n.values()).map(a=>{var ve,E;const T=Array.from(a.professions||[]).filter(B=>B&&B!=="Unknown");let g=a.profession||"Unknown";if(T.length>0){g=T[0];let B=((ve=a.professionTimeMs)==null?void 0:ve[g])||0;T.forEach(R=>{var ce;const y=((ce=a.professionTimeMs)==null?void 0:ce[R])||0;y>B&&(B=y,g=R)})}const x=a.durationMs||0,_=a.totalMs/1e3,K=x>0?a.totalMs/x:0,ae=((E=he.get(a.account))==null?void 0:E.supportActiveMs)||x,se=ae>0?a.uptimeMs/ae:0;return{account:a.account,profession:g,professionList:T,total:_,perSecond:K,uptimePerSecond:se,duration:x/1e3}}).filter(a=>a.total>0||a.perSecond>0);return{id:e,name:i.name||e,icon:i.icon,rows:b}}).filter(e=>e.rows.length>0),io=Array.from(ze.values()).map(e=>{const n=Array.from(e.skills.values()).sort((b,a)=>a.damage-b.damage),i=n.reduce((b,a)=>(b[a.id]=a,b),{});return{key:e.key,account:e.account,displayName:e.displayName,profession:e.profession,professionList:e.professionList,totalFightMs:e.totalFightMs,skills:n,skillMap:i}}).sort((e,n)=>e.displayName.localeCompare(n.displayName));return{total:Y,wins:Se,losses:de,avgSquadSize:Bi,avgEnemies:Ii,squadKDR:Li,enemyKDR:Pi,totalSquadKills:m,totalSquadDeaths:Ne,totalEnemyKills:ue,totalEnemyDeaths:Me,leaderboards:_e,...xi,outgoingConditionSummary:Object.values(qe).sort((e,n)=>n.damage-e.damage),incomingConditionSummary:Object.values(Oe).sort((e,n)=>n.damage-e.damage),outgoingConditionPlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.outgoingConditions})),incomingConditionPlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.incomingConditions})),topSkills:Oi,topIncomingSkills:Ri,topSkillsByDamage:Pn,topSkillsByDownContribution:Un,playerSkillBreakdowns:io,topSkillsMetric:z,mapData:ji,timelineData:Ki,boonTables:zi,offensePlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,offenseTotals:e.offenseTotals,offenseRateWeights:e.offenseRateWeights,totalFightMs:e.totalFightMs})),defensePlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,defenseTotals:e.defenseTotals,activeMs:e.defenseActiveMs,minionDamageTakenByMinion:e.defenseMinionDamageTaken})),damageMitigationPlayers:Ui,damageMitigationMinions:qi,supportPlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,supportTotals:e.supportTotals,activeMs:e.supportActiveMs})),healingPlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,healingTotals:e.healingTotals,activeMs:e.healingActiveMs})),mvp:Gt,silver:Bn,bronze:In,squadClassData:Vi,enemyClassData:Ji,fightBreakdown:Yi,fightDiffMode:Qi,attendanceData:Xi,squadCompByFight:Zi,spikeDamage:eo,incomingStrikeDamage:to,specialTables:no,topStatsPerSecond:at,topStatsLeaderboardsPerSecond:st,avgMvpScore:Ln}})(),Xe=(()=>{const Fe=new Map,Le=new Map,z=[],Y=new Map,Se=new Map;V.forEach(pe=>{const Te=pe.details;if(!Te)return;const Ne=Te.skillMap||{},m=Te.fightName||"Log",Me=Ye(Te,pe)||Date.now(),ue={id:pe.filePath||pe.id||m,label:m,timestamp:Me,skillEntries:{},playerActiveSeconds:{},durationSeconds:Te.durationMS?Te.durationMS/1e3:0};(Te.players||[]).forEach(ke=>{if(ke.notInSquad)return;const he=ke.account||ke.name||"Unknown",We=ke.profession||"Unknown",ge=`${he}|${We}`;let we=Le.get(ge);we||(we={key:ge,account:he,displayName:he,profession:We,professionList:[We],logs:0,totalActiveSeconds:0,skillTotals:{}},Le.set(ge,we)),we.logs++;const ze=(Array.isArray(ke.activeTimes)?ke.activeTimes[0]:0)/1e3;we.totalActiveSeconds=(we.totalActiveSeconds||0)+ze,ue.playerActiveSeconds[ge]=ze,(ke.rotation||[]).forEach(qe=>{var Bt,It,Lt;if(!(qe!=null&&qe.id))return;const Oe=((Bt=qe.skills)==null?void 0:Bt.length)||0;if(Oe<=0)return;const He=`s${qe.id}`,Re=((It=Ne[He])==null?void 0:It.name)||`Skill ${qe.id}`,Ge=(Lt=Ne[He])==null?void 0:Lt.icon;we.skillTotals[He]=(we.skillTotals[He]||0)+Oe,Fe.set(He,(Fe.get(He)||0)+Oe),Y.set(He,Re),Ge&&!Se.has(He)&&Se.set(He,Ge),ue.skillEntries[He]||(ue.skillEntries[He]={name:Re,icon:Ge,players:{}}),!ue.skillEntries[He].icon&&Ge&&(ue.skillEntries[He].icon=Ge),ue.skillEntries[He].players[ge]=(ue.skillEntries[He].players[ge]||0)+Oe})}),z.push(ue)});const de=Array.from(Fe.entries()).map(([pe,Te])=>({id:pe,name:Y.get(pe)||pe,total:Te,icon:Se.get(pe)})).sort((pe,Te)=>Te.total-pe.total);return{logRecords:z,players:Array.from(Le.values()),skillOptions:de,resUtilitySkills:[]}})();return{validLogs:V,stats:Ke,skillUsageData:Xe}};let ot=null,gt=!1,gn=null,pn=0,bn=0,_t=null;const hn=r=>{if(!r||typeof r!="object")return r;const l=(H,j)=>{const V={};return j.forEach(Ce=>{H&&Object.prototype.hasOwnProperty.call(H,Ce)&&(V[Ce]=H[Ce])}),V},p=l(r,["players","targets","durationMS","uploadTime","timeStart","timeStartStd","timeEnd","timeEndStd","fightName","zone","mapName","map","location","permalink","uploadLinks","success","teamBreakdown","teamCounts","combatReplayMetaData","skillMap","buffMap","encounterDuration","player_damage_mitigation","player_minion_damage_mitigation","playerDamageMitigation","playerMinionDamageMitigation"]);return Array.isArray(p.players)&&(p.players=p.players.map(H=>l(H,["name","display_name","character_name","profession","elite_spec","group","dpsAll","statsAll","dpsTargets","statsTargets","defenses","support","rotation","extHealingStats","extBarrierStats","squadBuffVolumes","selfBuffs","groupBuffs","squadBuffs","selfBuffsActive","groupBuffsActive","squadBuffsActive","buffUptimes","totalDamageDist","targetDamageDist","damage1S","targetDamage1S","powerDamageTaken1S","targetPowerDamage1S","totalDamageTaken","totalDamageTakenDist","minions","combatReplayData","hasCommanderTag","notInSquad","account","activeTimes","teamID","teamId","team","teamColor","team_color"]))),Array.isArray(p.targets)&&(p.targets=p.targets.map(H=>l(H,["id","name","isFake","dpsAll","statsAll","defenses","totalHealth","healthPercentBurned","enemyPlayer","totalDamageDist","totalDamageTaken","totalDamageTakenDist","damageTaken","powerDamage1S","damage1S","profession","teamID","teamId","team","teamColor","team_color"]))),p},vi=r=>{if(!r||typeof r!="object")return r;const l={...r};return r.details?l.details=hn(r.details):l.details=hn(r),l},Dn=()=>{if(!gt||!ot)return;gt=!1,pn+=1;const r=_t;_t=null;const l=wi(ot);self.postMessage({type:"result",result:l,computeId:pn,logCount:ot.logs.length,token:bn,completedAt:Date.now(),flushId:r})},Wt=()=>{gn===null&&(gn=setInterval(()=>{Dn()},5e3))};self.onmessage=r=>{var p,H,j,V;const l=r.data;if((l==null?void 0:l.type)==="reset"){ot={logs:[]},typeof l.token=="number"&&(bn=l.token),gt=!0,Wt();return}if((l==null?void 0:l.type)==="settings"){ot={logs:(ot==null?void 0:ot.logs)||[],precomputedStats:(p=l.payload)==null?void 0:p.precomputedStats,mvpWeights:(H=l.payload)==null?void 0:H.mvpWeights,statsViewSettings:(j=l.payload)==null?void 0:j.statsViewSettings,disruptionMethod:(V=l.payload)==null?void 0:V.disruptionMethod},gt=!0,Wt();return}if((l==null?void 0:l.type)==="log"){ot||(ot={logs:[]}),ot.logs.push(vi(l.payload)),gt=!0,Wt();return}(l==null?void 0:l.type)==="flush"&&(typeof l.flushId=="number"&&(_t=l.flushId),gt=!0,Dn())}})();
