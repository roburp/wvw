(function(){"use strict";const Zt=["selfBuffs","groupBuffs","squadBuffs"],yt=r=>r!=null&&r.classification?r.classification==="Boon":!0,en=r=>`b${r}`,Xn=(r,l)=>{const p=Array.isArray(r==null?void 0:r.activeTimes)?r.activeTimes:[],H=typeof p[0]=="number"?p[0]:0;return H>0?H:l},tn=(r,l,p,H,j,V,Ce)=>{const ie=r==="selfBuffs"?1:Math.max(r==="groupBuffs"?V-1:Ce-1,0);return!ie||!j?{generationMs:0,wastedMs:0}:l?{generationMs:p*j*ie,wastedMs:H*j*ie}:{generationMs:p/100*j*ie,wastedMs:H/100*j*ie}},Zn=r=>{const l=new Map,p=new Map;return r.forEach(V=>{const Ce=V.details;if(!Ce)return;const ie=Ce.durationMS||0,Ae=Ce.buffMap||{};Object.entries(Ae).forEach(([z,J])=>{if(!l.has(z)){l.set(z,J);return}const ke=l.get(z)||{},de={name:ke.name||J.name,stacking:ke.stacking??J.stacking,icon:ke.icon||J.icon,classification:ke.classification||J.classification};l.set(z,de)});const Xe=(Ce.players||[]).filter(z=>!z.notInSquad),Fe=Xe.length,Ie=new Map;Xe.forEach(z=>{const J=z.group??0;Ie.set(J,(Ie.get(J)||0)+1)}),Xe.forEach(z=>{const J=z.account||z.name||z.character_name||"Unknown",ke=z.profession||"Unknown",de=z.group??0,pe=Ie.get(de)||1,Te=Xn(z,ie);p.has(J)||p.set(J,{account:J,profession:ke,professions:new Set,professionTimeMs:{},activeTimeMs:0,numFights:0,groupSupported:0,squadSupported:0,boons:{}});const Ne=p.get(J);Ne.profession=ke,ke!=="Unknown"&&(Ne.professions.add(ke),Ne.professionTimeMs[ke]=(Ne.professionTimeMs[ke]||0)+Te),Ne.activeTimeMs+=Te,Ne.numFights+=1,Ne.groupSupported+=pe,Ne.squadSupported+=Fe,Zt.forEach(m=>{(z[m]||[]).forEach(le=>{var qe,$e,He,xe;if(typeof(le==null?void 0:le.id)!="number")return;const be=en(le.id),Se=Ae[be];if(!yt(Se))return;const he=(Se==null?void 0:Se.stacking)??!1,_e=(($e=(qe=le.buffData)==null?void 0:qe[0])==null?void 0:$e.generation)??0,ge=((xe=(He=le.buffData)==null?void 0:He[0])==null?void 0:xe.wasted)??0,{generationMs:we,wastedMs:je}=tn(m,he,_e,ge,ie,pe,Fe);!we&&!je||(l.has(be)||l.set(be,Se||{}),Ne.boons[be]||(Ne.boons[be]={selfBuffs:{generationMs:0,wastedMs:0},groupBuffs:{generationMs:0,wastedMs:0},squadBuffs:{generationMs:0,wastedMs:0}}),Ne.boons[be][m].generationMs+=we,Ne.boons[be][m].wastedMs+=je)})})})}),{boonTables:Array.from(l.keys()).filter(V=>yt(l.get(V))).map(V=>{const Ce=l.get(V)||{},ie=[];return p.forEach(Ae=>{var z;const ze=Ae.boons[V];if(!ze||!Zt.some(J=>ze[J].generationMs>0||ze[J].wastedMs>0))return;const Fe=Array.from(Ae.professions||[]).filter(J=>J&&J!=="Unknown");let Ie=Ae.profession;if(Fe.length>0){Ie=Fe[0];let J=((z=Ae.professionTimeMs)==null?void 0:z[Ie])||0;Fe.forEach(ke=>{var pe;const de=((pe=Ae.professionTimeMs)==null?void 0:pe[ke])||0;de>J&&(J=de,Ie=ke)})}ie.push({account:Ae.account,profession:Ie||"Unknown",professionList:Fe,activeTimeMs:Ae.activeTimeMs||1,numFights:Ae.numFights||1,groupSupported:Ae.groupSupported||1,squadSupported:Ae.squadSupported||1,categories:{selfBuffs:{...ze.selfBuffs},groupBuffs:{...ze.groupBuffs},squadBuffs:{...ze.squadBuffs}}})}),{id:V,name:Ce.name||V,icon:Ce.icon,stacking:Ce.stacking??!1,rows:ie}}).filter(V=>V.rows.length>0)}},nn=(r,l,p,H,j,V,Ce={})=>{var z,J,ke,de;const Ae=((r==null?void 0:r[l])||[]).find(pe=>pe.id===p);if(!Ae)return{generationMs:0,wastedMs:0};const ze=Ce[en(p)],Xe=(ze==null?void 0:ze.stacking)??!1,Fe=((J=(z=Ae.buffData)==null?void 0:z[0])==null?void 0:J.generation)??0,Ie=((de=(ke=Ae.buffData)==null?void 0:ke[0])==null?void 0:de.wasted)??0;return tn(l,Xe,Fe,Ie,H,j,V)};var yn={methods:{tiered:{tiers:{shortMs:500,mediumMs:1500,weights:{short:.5,medium:1,long:2}}}}};const ei=yn,Ot="count",ti=r=>(r||0)/1e3,ni=(r,l)=>{var j;if(!r)return 0;const p=(j=ei.methods.tiered)==null?void 0:j.tiers;if(!p)return r;const H=l/Math.max(r,1);return H<=p.shortMs?r*p.weights.short:H<=p.mediumMs?r*p.weights.medium:r*p.weights.long},sn=(r,l,p)=>p==="duration"?ti(l):p==="tiered"?ni(r,l):r;function ii(r,l=Ot){var V;const p=(V=r.statsAll)==null?void 0:V[0],H=Number((p==null?void 0:p.appliedCrowdControl)??0),j=Number((p==null?void 0:p.appliedCrowdControlDuration)??0);return sn(H,j,l)}function si(r,l){const p=(l==null?void 0:l.durationMS)||0,H=(l==null?void 0:l.buffMap)||{},j=r.filter(ie=>!ie.notInSquad),V=j.length,Ce=new Map;j.forEach(ie=>{const Ae=ie.group??0;Ce.set(Ae,(Ce.get(Ae)||0)+1)}),j.forEach(ie=>{const Ae=Ce.get(ie.group??0)||1,ze=nn(ie,"selfBuffs",1122,p,Ae,V,H),Xe=nn(ie,"squadBuffs",1122,p,Ae,V,H);ie.stabGeneration=(ze.generationMs+Xe.generationMs)/1e3})}function oi(r){if(!r.statsTargets)return 0;let l=0;for(const p of r.statsTargets)p&&p.length>0&&(l+=p[0].downContribution||0);return l}function ai(r){if(!r.extBarrierStats||!r.extBarrierStats.outgoingBarrierAllies)return 0;let l=0;for(const p of r.extBarrierStats.outgoingBarrierAllies)if(p)for(const H of p)H&&(l+=H.barrier||0);return l}function ri(r){if(!r.extHealingStats||!r.extHealingStats.outgoingHealingAllies)return 0;let l=0;for(const p of r.extHealingStats.outgoingHealingAllies)if(p)for(const H of p)H&&(l+=H.healing||0);return l}const on=r=>{var l,p,H,j;return(((p=(l=r.support)==null?void 0:l[0])==null?void 0:p.condiCleanse)||0)+(((j=(H=r.support)==null?void 0:H[0])==null?void 0:j.condiCleanseSelf)||0)},an=(r,l=Ot)=>{var V;const p=(V=r.support)==null?void 0:V[0],H=Number((p==null?void 0:p.boonStrips)??0),j=Number((p==null?void 0:p.boonStripsTime)??0);return sn(H,j,l)},rn=r=>oi(r),cn=r=>ri(r),ln=r=>ai(r),un=(r,l=Ot)=>ii(r,l),ci=(r,l)=>si(r,l),li="count",ui={downContribution:1,healing:1,cleanses:1,strips:1,stability:1,cc:.7,revives:.7,distanceToTag:.7,participation:.7,dodging:.4,dps:.2,damage:.2},mi={showMvp:!0,topSkillDamageSource:"target",topSkillsMetric:"damage"},mn=new Map([["bleeding","Bleeding"],["burning","Burning"],["confusion","Confusion"],["poison","Poison"],["torment","Torment"],["vulnerability","Vulnerability"],["weakness","Weakness"],["weakened","Weakness"],["blind","Blind"],["blinded","Blind"],["blinding","Blind"],["cripple","Cripple"],["crippled","Cripple"],["chill","Chill"],["chilled","Chill"],["immob","Immobilize"],["immobile","Immobilize"],["immobilized","Immobilize"],["slow","Slow"],["slowed","Slow"],["fear","Fear"],["feared","Fear"],["taunt","Taunt"],["taunted","Taunt"]]),di={Blind:"https://render.guildwars2.com/file/09770136BB76FD0DBE1CC4267DEED54774CB20F6/102837.png",Chill:"https://render.guildwars2.com/file/28C4EC547A3516AF0242E826772DA43A5EAC3DF3/102839.png",Cripple:"https://render.guildwars2.com/file/070325E519C178D502A8160523766070D30C0C19/102838.png",Fear:"https://render.guildwars2.com/file/30307A6E766D74B6EB09EDA12A4A2DE50E4D76F4/102869.png",Immobilize:"https://render.guildwars2.com/file/397A613651BFCA2832B6469CE34735580A2C120E/102844.png",Slow:"https://render.guildwars2.com/file/F60D1EF5271D7B9319610855676D320CD25F01C6/961397.png",Taunt:"https://render.guildwars2.com/file/02EED459AD65FAF7DF32A260E479C625070841B9/1228472.png",Vulnerability:"https://render.guildwars2.com/file/3A394C1A0A3257EB27A44842DDEEF0DF000E1241/102850.png",Weakness:"https://render.guildwars2.com/file/6CB0E64AF9AA292E332A38C1770CE577E2CDE0E8/102853.png"},bt=r=>{if(!r)return null;const l=r.trim().toLowerCase(),p=mn.get(l);if(p)return p;const H=l.split(/[^a-z]+/).filter(Boolean);for(const j of H){const V=mn.get(j);if(V)return V}return null},fi=r=>bt(r),dn=r=>{const l=new Map;return r&&(Object.values(r).forEach(p=>{if(!(p!=null&&p.icon)||!(p!=null&&p.name))return;const H=bt(p.name);H&&(l.has(H)||l.set(H,p.icon))}),Object.entries(di).forEach(([p,H])=>{l.has(p)||l.set(p,H)})),l},vt=(r,l,p)=>{var H;if(l&&p){const j=(H=p[`b${l}`])==null?void 0:H.name,V=bt(j);if(V)return V}return r?bt(r):null},gi=r=>{const l=(r==null?void 0:r.account)||"Unknown";return l&&l!=="Unknown"?l:(r==null?void 0:r.name)||"Unknown"||null},pi=r=>{if(!r||r.length===0)return 0;let l=0,p=null;return r.forEach(H=>{const j=Number(H[1]??0);if(Number.isFinite(j)){if(p===null){p=j;return}j>p&&(l+=j-p),p=j}}),l},bi=r=>{if(!r||r.length===0)return 0;let l=0;return r.forEach(p=>{const H=Number(p[0]??0),j=Number(p[1]??0);Number.isFinite(j)&&H!==0&&j>0&&(l+=1)}),l},hi=r=>{const{players:l,targets:p,skillMap:H,buffMap:j}=r,V=r.getPlayerKey||gi,Ce=dn(j),ie={},Ae={};l.forEach(z=>{if(z!=null&&z.notInSquad)return;const J=V(z);J&&(ie[J]||(ie[J]={}),z!=null&&z.totalDamageDist&&z.totalDamageDist.forEach(ke=>{ke&&ke.forEach(de=>{if(!de.id)return;let pe=`Skill ${de.id}`,Te;H&&(H[`s${de.id}`]?(pe=H[`s${de.id}`].name||pe,Te=H[`s${de.id}`].icon||Te):H[`${de.id}`]&&(pe=H[`${de.id}`].name||pe,Te=H[`${de.id}`].icon||Te));const Ne=vt(pe,de.id,j);if(!Ne)return;const m=j==null?void 0:j[`b${de.id}`],Me=m==null?void 0:m.name,le=Ce.get(Ne)||(m==null?void 0:m.icon),be=pe.startsWith("Skill ")?Me||Ne:pe,Se=Te||(m==null?void 0:m.icon),he=Number(de.connectedHits??0),_e=Number(de.hits??0),ge=he>0?he:_e,we=Number(de.totalDamage??0);if(!Number.isFinite(ge)&&!Number.isFinite(we))return;const je=Ae[Ne]||{name:Ne,icon:le,applications:0,damage:0};je.applications+=Number.isFinite(ge)?ge:0,je.damage+=Number.isFinite(we)?we:0,!je.icon&&le&&(je.icon=le),Ae[Ne]=je;const qe=ie[J][Ne]||{icon:le,applications:0,damage:0,skills:{}};qe.applications+=Number.isFinite(ge)?ge:0,qe.damage+=Number.isFinite(we)?we:0;const $e=qe.skills[be]||{name:be,hits:0,damage:0,icon:Se};$e.hits+=Number.isFinite(ge)?ge:0,$e.damage+=Number.isFinite(we)?we:0,!$e.icon&&Se&&($e.icon=Se),qe.skills[be]=$e,!qe.icon&&le&&(qe.icon=le),ie[J][Ne]=qe})}))});const ze=new Map;l.forEach(z=>{if(z!=null&&z.notInSquad)return;const J=V(z);J&&z!=null&&z.name&&ze.set(z.name,J)});let Xe=0,Fe=0,Ie=0;return p.forEach(z=>{z!=null&&z.buffs&&z.buffs.forEach(J=>{const ke=Number(J==null?void 0:J.id);if(!Number.isFinite(ke))return;const de=j==null?void 0:j[`b${ke}`],pe=bt(de==null?void 0:de.name);if(!pe||de!=null&&de.classification&&de.classification!=="Condition")return;const Te=pe;if(!Te)return;const Ne=J.statesPerSource||{};Ie+=1,Object.entries(Ne).forEach(([m,Me])=>{var ge;const le=ze.get(m);if(!le)return;Fe+=1;const be=pi(Me),Se=bi(Me);Xe+=be;const he=((ge=ie[le])==null?void 0:ge[Te])||{applications:0,damage:0,skills:{}};he.applicationsFromBuffs=(he.applicationsFromBuffs||0)+be,he.applicationsFromBuffsActive=(he.applicationsFromBuffsActive||0)+Se,ie[le]=ie[le]||{},ie[le][Te]=he;const _e=Ae[Te]||{name:Te,applications:0,damage:0};_e.applicationsFromBuffs=(_e.applicationsFromBuffs||0)+be,_e.applicationsFromBuffsActive=(_e.applicationsFromBuffsActive||0)+Se,Ae[Te]=_e})})}),Object.values(ie).forEach(z=>{Object.values(z).forEach(J=>{typeof J.applicationsFromBuffs=="number"&&(J.applications=J.applicationsFromBuffs)})}),Object.values(Ae).forEach(z=>{typeof z.applicationsFromBuffs=="number"&&(z.applications=z.applicationsFromBuffs)}),{playerConditions:ie,summary:Ae,meta:{buffStateApplicationsTotal:Xe,targetBuffEntriesSeen:Ie,buffStateSourcesSeen:Fe}}},Di=new Set(["Vulnerability","Weakness","Blind","Cripple","Chill","Immobilize","Slow","Fear","Taunt"]),Si=[{id:"damage",label:"Damage",field:"damage",source:"dpsAll"},{id:"directDmg",label:"Direct Damage",field:"directDmg",source:"statsTargets"},{id:"connectedDamageCount",label:"Connected Damage Count",field:"connectedDamageCount",source:"statsTargets"},{id:"connectedDirectDamageCount",label:"Connected Direct Damage Count",field:"connectedDirectDamageCount",source:"statsTargets"},{id:"battleStandardHits",label:"Battle Standard Tracking"},{id:"criticalRate",label:"Critical Rate",field:"criticalRate",isRate:!0,isPercent:!0,denomField:"critableDirectDamageCount",source:"statsTargets"},{id:"criticalDmg",label:"Critical Damage",field:"criticalDmg",source:"statsTargets"},{id:"flankingRate",label:"Flanking Rate",field:"flankingRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"glanceRate",label:"Glance Rate",field:"glanceRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"missed",label:"Missed",field:"missed",source:"statsTargets"},{id:"evaded",label:"Evaded (enemy)",field:"evaded",source:"statsTargets"},{id:"blocked",label:"Blocked (enemy)",field:"blocked",source:"statsTargets"},{id:"interrupts",label:"Interrupts",field:"interrupts",source:"statsTargets"},{id:"invulned",label:"Invulned",field:"invulned",source:"statsTargets"},{id:"killed",label:"Killed",field:"killed",source:"statsTargets"},{id:"downed",label:"Downed",field:"downed",source:"statsTargets"},{id:"downContribution",label:"Down Contribution",field:"downContribution",source:"statsTargets"},{id:"downContributionPercent",label:"Down Contribution %",isRate:!0,isPercent:!0},{id:"againstDownedDamage",label:"Against Downed Damage",field:"againstDownedDamage",source:"statsTargets"},{id:"appliedCrowdControl",label:"Applied CC",field:"appliedCrowdControl",source:"statsTargets"},{id:"appliedCrowdControlDuration",label:"Applied CC Duration",field:"appliedCrowdControlDuration",source:"statsTargets"},{id:"appliedCrowdControlDownContribution",label:"Applied CC Down Contribution",field:"appliedCrowdControlDownContribution",source:"statsTargets"},{id:"appliedCrowdControlDurationDownContribution",label:"Applied CC Duration Down Contribution",field:"appliedCrowdControlDurationDownContribution",source:"statsTargets"},{id:"boonStrips",label:"Boon Strips",field:"boonStrips",source:"support"}],ki=[{id:"damageTaken",label:"Damage Taken",field:"damageTaken"},{id:"damageTakenCount",label:"Damage Taken Count",field:"damageTakenCount"},{id:"conditionDamageTaken",label:"Condition Damage Taken",field:"conditionDamageTaken"},{id:"conditionDamageTakenCount",label:"Condition Damage Taken Count",field:"conditionDamageTakenCount"},{id:"powerDamageTaken",label:"Power Damage Taken",field:"powerDamageTaken"},{id:"powerDamageTakenCount",label:"Power Damage Taken Count",field:"powerDamageTakenCount"},{id:"downedDamageTaken",label:"Downed Damage Taken",field:"downedDamageTaken"},{id:"downedDamageTakenCount",label:"Downed Damage Taken Count",field:"downedDamageTakenCount"},{id:"damageBarrier",label:"Damage Barrier",field:"damageBarrier"},{id:"damageBarrierCount",label:"Damage Barrier Count",field:"damageBarrierCount"},{id:"blockedCount",label:"Blocked Count",field:"blockedCount"},{id:"evadedCount",label:"Evaded Count",field:"evadedCount"},{id:"missedCount",label:"Missed Count",field:"missedCount"},{id:"dodgeCount",label:"Dodge Count",field:"dodgeCount"},{id:"invulnedCount",label:"Invulnerable Count",field:"invulnedCount"},{id:"interruptedCount",label:"Interrupted Count",field:"interruptedCount"},{id:"downCount",label:"Down Count",field:"downCount"},{id:"deadCount",label:"Death Count",field:"deadCount"},{id:"boonStrips",label:"Boon Strips (Incoming)",field:"boonStrips"},{id:"conditionCleanses",label:"Cleanses (Incoming)",field:"conditionCleanses"},{id:"receivedCrowdControl",label:"Crowd Control (Incoming)",field:"receivedCrowdControl"}],Ni=[{id:"condiCleanse",label:"Condition Cleanses",field:"condiCleanse"},{id:"condiCleanseTime",label:"Condition Cleanse Time",field:"condiCleanseTime",isTime:!0},{id:"condiCleanseSelf",label:"Condition Cleanse Self",field:"condiCleanseSelf"},{id:"condiCleanseTimeSelf",label:"Condition Cleanse Time Self",field:"condiCleanseTimeSelf",isTime:!0},{id:"boonStrips",label:"Boon Strips",field:"boonStrips"},{id:"boonStripsTime",label:"Boon Strips Time",field:"boonStripsTime",isTime:!0},{id:"boonStripDownContribution",label:"Boon Strip Down Contribution",field:"boonStripDownContribution"},{id:"boonStripDownContributionTime",label:"Boon Strip Down Contribution Time",field:"boonStripDownContributionTime",isTime:!0},{id:"stunBreak",label:"Stun Breaks",field:"stunBreak"},{id:"removedStunDuration",label:"Removed Stun Duration",field:"removedStunDuration",isTime:!0},{id:"resurrects",label:"Resurrects",field:"resurrects"},{id:"resurrectTime",label:"Resurrect Time",field:"resurrectTime",isTime:!0}],Ci=["battle standard","glyph of renewal","glyph of the stars","illusion of life","spirit of nature","nature spirit","search and rescue","signet of mercy"],Ai=new Set([10244]),Ti=(r,l)=>{var j;if(Ai.has(r))return!0;const p=(l==null?void 0:l[`s${r}`])||(l==null?void 0:l[`${r}`]),H=((j=p==null?void 0:p.name)==null?void 0:j.toLowerCase())||"";return Ci.some(V=>H.includes(V))},Ft=r=>{if(!r||!Number.isFinite(r))return"--:--";const l=Math.max(0,Math.round(r/1e3)),p=Math.floor(l/3600),H=Math.floor(l%3600/60),j=l%60;return p>0?`${p}:${String(H).padStart(2,"0")}:${String(j).padStart(2,"0")}`:`${H}:${String(j).padStart(2,"0")}`},Et={Guardian:"#72C1D9",Dragonhunter:"#72C1D9",Firebrand:"#72C1D9",Willbender:"#72C1D9",Revenant:"#D16E5A",Herald:"#D16E5A",Renegade:"#D16E5A",Vindicator:"#D16E5A",Warrior:"#FFD166",Berserker:"#FFD166",Spellbreaker:"#FFD166",Bladesworn:"#FFD166",Engineer:"#D09C59",Scrapper:"#D09C59",Holosmith:"#D09C59",Mechanist:"#D09C59",Ranger:"#8CDC82",Druid:"#8CDC82",Soulbeast:"#8CDC82",Untamed:"#8CDC82",Thief:"#C08F95",Daredevil:"#C08F95",Deadeye:"#C08F95",Specter:"#C08F95",Elementalist:"#F68A87",Tempest:"#F68A87",Weaver:"#F68A87",Catalyst:"#F68A87",Mesmer:"#B679D5",Chronomancer:"#B679D5",Mirage:"#B679D5",Virtuoso:"#B679D5",Necromancer:"#52A76F",Reaper:"#52A76F",Scourge:"#52A76F",Harbinger:"#52A76F",Ritualist:"#52A76F",Luminary:"#72C1D9",Conduit:"#D16E5A",Paragon:"#FFD166",Amalgam:"#D09C59",Galeshot:"#8CDC82",Antiquary:"#C08F95",Evoker:"#F68A87",Troubadour:"#B679D5",Unknown:"#64748B"};function fn(r){return Et[r]||Et.Unknown}const Mi=r=>{if(r==null||r==="")return 0;if(typeof r=="number")return!Number.isFinite(r)||r<=0?0:r>1e12?r:r*1e3;if(r instanceof Date){const Ce=r.getTime();return Number.isFinite(Ce)&&Ce>0?Ce:0}const l=String(r).trim();if(!l)return 0;const p=Number(l);if(Number.isFinite(p)&&p>0)return p>1e12?p:p*1e3;const H=Date.parse(l);if(Number.isFinite(H)&&H>0)return H;const j=l.replace(/([+-]\d{2})$/,"$1:00"),V=Date.parse(j);return Number.isFinite(V)&&V>0?V:0},Ye=(r,l)=>Mi((r==null?void 0:r.uploadTime)??(l==null?void 0:l.uploadTime)??(r==null?void 0:r.timeStartStd)??(r==null?void 0:r.timeStart)??(r==null?void 0:r.timeEndStd)??(r==null?void 0:r.timeEnd)??(r==null?void 0:r.timeStartText)??(r==null?void 0:r.timeEndText)),wi=({logs:r,precomputedStats:l,mvpWeights:p,statsViewSettings:H,disruptionMethod:j})=>{const V=r.filter(Ie=>Ie.details&&Ie.details.players&&Ie.details.players.length>0),Ce=H||mi,ie=p||ui,Ae=Fe=>{if(!Fe||typeof Fe!="object")return Fe;const Ie=Array.isArray(Fe.fightBreakdown)?Fe.fightBreakdown:null;if(!Ie||Ie.length===0)return Fe;const z=m=>Array.isArray(m)&&m.some(Me=>Me&&Number(Me.count)>0),J=new Map,ke=new Map;r.forEach(m=>{var be;const Me=(m==null?void 0:m.filePath)||(m==null?void 0:m.id);Me&&J.set(String(Me),m);const le=(m==null?void 0:m.permalink)||((be=m==null?void 0:m.details)==null?void 0:be.permalink);typeof le=="string"&&le.trim()&&ke.set(le.trim(),m)});const de=Ie.map(m=>{var _e;if(!m||typeof m!="object")return m;const Me=m.id?String(m.id):"",le=typeof m.permalink=="string"?m.permalink.trim():"",be=(Me?J.get(Me):void 0)||(le?ke.get(le):void 0);if(!be)return m;let Se=m;if(Number(m.timestamp)<=0){const ge=Ye(be==null?void 0:be.details,be);ge&&(Se={...Se,timestamp:ge})}const he=(_e=be==null?void 0:be.details)==null?void 0:_e.teamBreakdown;return z(he)&&(Se={...Se,teamBreakdown:he}),Se}),pe=Array.isArray(Fe.fightDiffMode)?Fe.fightDiffMode:[],Ne=pe.some(m=>Array.isArray(m==null?void 0:m.targetFocus)&&m.targetFocus.some(Me=>Number((Me==null?void 0:Me.damage)||0)>0||Number((Me==null?void 0:Me.hits)||0)>0))?pe:de.map((m,Me)=>{const le=m&&typeof m.enemyClassCounts=="object"&&m.enemyClassCounts?m.enemyClassCounts:{},be=Object.entries(le).map(([xe,Ve])=>({label:String(xe||"Unknown"),count:Number(Ve||0)})).filter(xe=>xe.count>0).sort((xe,Ve)=>Ve.count-xe.count||xe.label.localeCompare(Ve.label)),Se=be.reduce((xe,Ve)=>xe+Ve.count,0),he=be.map(xe=>({label:xe.label,damage:xe.count,hits:0,share:Se>0?xe.count/Se:0})),_e=Number((m==null?void 0:m.enemyDowns)||0),ge=Number((m==null?void 0:m.enemyDeaths)||0),we=Number((m==null?void 0:m.alliesDown)||0),je=Number((m==null?void 0:m.alliesDead)||0),qe=Number((m==null?void 0:m.totalOutgoingDamage)||0),$e=Number((m==null?void 0:m.totalIncomingDamage)||0),He=[{metricId:"winFlag",metricLabel:"Win (1) / Loss (0)",higherIsBetter:!0,value:m!=null&&m.isWin?1:0},{metricId:"squadCount",metricLabel:"Squad Size",higherIsBetter:!0,value:Number((m==null?void 0:m.squadCount)||0)},{metricId:"enemyCount",metricLabel:"Enemy Count",higherIsBetter:!1,value:Number((m==null?void 0:m.enemyCount)||0)},{metricId:"squadKdr",metricLabel:"Squad KDR",higherIsBetter:!0,value:je>0?ge/je:ge},{metricId:"enemyDeaths",metricLabel:"Enemy Deaths",higherIsBetter:!0,value:ge},{metricId:"enemyDowns",metricLabel:"Enemy Downs",higherIsBetter:!0,value:_e},{metricId:"squadDeaths",metricLabel:"Squad Deaths",higherIsBetter:!1,value:je},{metricId:"squadDowns",metricLabel:"Squad Downs",higherIsBetter:!1,value:we},{metricId:"damageDelta",metricLabel:"Damage Delta",higherIsBetter:!0,value:qe-$e},{metricId:"outgoingDamage",metricLabel:"Outgoing Damage",higherIsBetter:!0,value:qe},{metricId:"incomingDamage",metricLabel:"Incoming Damage",higherIsBetter:!1,value:$e},{metricId:"barrierIncomingAbsorb",metricLabel:"Barrier Absorption (Incoming)",higherIsBetter:!0,value:Number((m==null?void 0:m.incomingBarrierAbsorbed)||0)},{metricId:"enemyBarrierAbsorb",metricLabel:"Enemy Barrier Absorption",higherIsBetter:!1,value:Number((m==null?void 0:m.outgoingBarrierAbsorbed)||0)},{metricId:"alliesRevived",metricLabel:"Allies Revived (Players)",higherIsBetter:!0,value:Number((m==null?void 0:m.alliesRevived)||0)}];return{id:String((m==null?void 0:m.id)||`fight-${Me+1}`),shortLabel:`F${Me+1}`,fullLabel:`${String((m==null?void 0:m.mapName)||(m==null?void 0:m.label)||"Unknown Map")} • ${String((m==null?void 0:m.duration)||"--:--")}`,mapName:String((m==null?void 0:m.mapName)||""),timestamp:Number((m==null?void 0:m.timestamp)||0),duration:String((m==null?void 0:m.duration)||"--:--"),isWin:!!(m!=null&&m.isWin),targetFocus:he,squadMetrics:He}});return{...Fe,fightBreakdown:de,fightDiffMode:Ne}},ze=(()=>{if(l)return Ae(l);const Fe=j||li,Ie=Ce.topSkillDamageSource||"target",z=Ce.topSkillsMetric||"damage",J=V.length;let ke=0,de=0,pe=0,Te=0,Ne=0,m=0,Me=0,le=0;const be=e=>{const i=((e==null?void 0:e.players)||[]).filter($=>!$.notInSquad);let b=0,a=0,T=0,g=0;return i.forEach($=>{var se;const _=(se=$.defenses)==null?void 0:se[0];if(!_)return;const K=Number(_.downCount||0),oe=Number(_.deadCount||0);b+=K+oe,T+=oe}),i.forEach($=>{!$.statsTargets||$.statsTargets.length===0||$.statsTargets.forEach(_=>{const K=_==null?void 0:_[0];if(!K)return;const oe=Number(K.downed||0),se=Number(K.killed||0);a+=oe+se,g+=se})}),{squadDownsDeaths:b,enemyDownsDeaths:a,squadDeaths:T,enemyDeaths:g}},Se=e=>{const{squadDownsDeaths:n,enemyDownsDeaths:i}=be(e);return n>0||i>0?i>n:typeof(e==null?void 0:e.success)=="boolean"?e.success:!1},he=new Map,_e=new Set(["boonStripsTime","condiCleanseTime","condiCleanseTimeSelf"]),ge={},we={},je=new Map,qe={},$e={},He={},xe=new Map,Ve=new Map,Bt=new Set(Object.keys(Et)),It=Object.keys(Et).filter(e=>e&&e!=="Unknown").sort((e,n)=>n.length-e.length),Lt=["Guardian","Revenant","Warrior","Engineer","Ranger","Thief","Elementalist","Mesmer","Necromancer"],ye=e=>{if(!e)return"Unknown";const n=String(e).replace(/\s*\([^)]*\)\s*$/,"").replace(/\s*\[[^\]]*\]\s*$/,"").replace(/\s\d+$/,"").trim();if(Bt.has(n))return n;const i=n.toLowerCase();for(const a of It)if(i.includes(a.toLowerCase()))return a;return Lt.find(a=>i.includes(a.toLowerCase()))||n||"Unknown"},Fi=e=>e!=null&&e.classification?e.classification==="Boon":!0,Pt=new Map,qt=new Map,ht=()=>({totalHits:0,blocked:0,evaded:0,glanced:0,missed:0,invulned:0,interrupted:0,totalMitigation:0,minMitigation:0}),fe=e=>{const n=Number(e);return Number.isFinite(n)?n:0},Sn=e=>{const n=String(e).split("|"),i=n[0]||"Unknown",b=ye(n[1]||"Unknown"),a=n[2]||i||"Unknown";return{name:i,profession:b,account:a}},kn=(e,n,i)=>{let b=e.get(n);return b?i.profession&&!b.professionList.includes(i.profession)&&b.professionList.push(i.profession):(b={account:i.account,name:i.name,profession:i.profession,professionList:i.profession?[i.profession]:[],activeMs:0,mitigationTotals:ht()},e.set(n,b)),b},Nn=(e,n,i)=>{let b=e.get(n);return b?i.profession&&!b.professionList.includes(i.profession)&&b.professionList.push(i.profession):(b={account:i.account,name:i.name,profession:i.profession,professionList:i.profession?[i.profession]:[],activeMs:0,mitigationTotals:ht(),minion:i.minion},e.set(n,b)),b},Cn=(e,n)=>{e.totalHits+=fe((n==null?void 0:n.skill_hits)??(n==null?void 0:n.skillHits)),e.blocked+=fe(n==null?void 0:n.blocked),e.evaded+=fe(n==null?void 0:n.evaded),e.glanced+=fe(n==null?void 0:n.glanced),e.missed+=fe(n==null?void 0:n.missed),e.invulned+=fe(n==null?void 0:n.invulned),e.interrupted+=fe(n==null?void 0:n.interrupted),e.totalMitigation+=fe((n==null?void 0:n.avoided_damage)??(n==null?void 0:n.avoidedDamage)),e.minMitigation+=fe((n==null?void 0:n.min_avoided_damage)??(n==null?void 0:n.minAvoidedDamage))},Ei=e=>Object.values(e).some(n=>n>0),Ht=(e,n,i)=>{var T,g,$,_;const b=`s${e}`;if((T=n==null?void 0:n[b])!=null&&T.name)return n[b].name;if((g=n==null?void 0:n[String(e)])!=null&&g.name)return n[String(e)].name;const a=`b${e}`;return($=i==null?void 0:i[a])!=null&&$.name?i[a].name:(_=i==null?void 0:i[String(e)])!=null&&_.name?i[String(e)].name:`Unknown Skill ${e}`},Dt=new Map,rt=e=>{const n=Dt.get(e);if(!n)return{hasSkill:!1,avg:1,min:1,hits:0};const i=n.connectedHits||0,b=i>0?n.totalDamage/i:0,a=n.minCount>0?n.minTotal/n.minCount:0;return{hasSkill:!0,avg:b,min:a,hits:i}},Ut="Ashtonlightstone.9145",An="Illusionary Warden",jt=[],ct=[],zt=[],Kt=[],Tn=new Map,Mn=new Map,wn=(e,n,i)=>{const b=e.get(n)||ht();return b.totalHits+=i.totalHits,b.blocked+=i.blocked,b.evaded+=i.evaded,b.glanced+=i.glanced,b.missed+=i.missed,b.invulned+=i.invulned,b.interrupted+=i.interrupted,e.set(n,b),b};V.forEach(e=>{const n=e.details;if(!n)return;(n.targets||[]).forEach(b=>{const a=(b==null?void 0:b.totalDamageDist)||[],T=Array.isArray(a)?a[0]:null;T==null||T.forEach(g=>{if(!(g!=null&&g.id))return;const $=Number(g.id),_=Dt.get($)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};_.totalDamage+=Number(g.totalDamage||0),_.connectedHits+=Number(g.connectedHits||0);const K=Number.isFinite(Number(g.min))?Number(g.min):0;_.minTotal+=K,_.minCount+=1,Dt.set($,_)})})}),V.forEach((e,n)=>{var me,Ue;const i=e.details;if(!i)return;const b=i.players,a=i.targets||[],T=i.skillMap||{},g=i.buffMap||{},$=new Map,_=new Map;a.forEach(t=>{const o=(t==null?void 0:t.totalDamageDist)||[],h=Array.isArray(o)?o[0]:null;h==null||h.forEach(v=>{var y;if(!(v!=null&&v.id))return;const S=Number(v.id),s=((y=T==null?void 0:T[S])==null?void 0:y.name)||v.name||v.skillName||String(S),k=$.get(S)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};k.totalDamage+=Number(v.totalDamage||0),k.connectedHits+=Number(v.connectedHits||0);const f=Number.isFinite(Number(v.min))?Number(v.min):0;k.minTotal+=f,k.minCount+=1,$.set(S,k);const P=_.get(s)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};P.totalDamage+=Number(v.totalDamage||0),P.connectedHits+=Number(v.connectedHits||0);const te=Number.isFinite(Number(v.min))?Number(v.min):0;P.minTotal+=te,P.minCount+=1,_.set(s,P)})});const K=t=>{const o=$.get(t);if(!o||o.connectedHits<=0)return{avg:1,min:1};const h=o.connectedHits>0?o.totalDamage/o.connectedHits:0,v=o.minCount>0?o.minTotal/o.minCount:h;return{avg:h||1,min:v||1}},oe=t=>{const o=_.get(t);if(!o||o.connectedHits<=0)return{avg:1,min:1};const h=o.connectedHits>0?o.totalDamage/o.connectedHits:0,v=o.minCount>0?o.minTotal/o.minCount:h;return{avg:h||1,min:v||1}},se=i.combatReplayMetaData||{},ve=(se==null?void 0:se.inchToPixel)>0?se.inchToPixel:1,E=(se==null?void 0:se.pollingRate)>0?se.pollingRate:1,B=5e3,R=t=>Array.isArray(t)?t.map(o=>Array.isArray(o)?[Number(o[0]),Number(o[1])]:null).filter(o=>!!o&&Number.isFinite(o[0])):[];let Z=[],re=i.durationMS||0,u=!1;const d=b.find(t=>(t==null?void 0:t.hasCommanderTag)&&!(t!=null&&t.notInSquad));(me=d==null?void 0:d.combatReplayData)!=null&&me.positions&&(Z=d.combatReplayData.positions,R(d.combatReplayData.dead).forEach(([o])=>{o>0&&(u=!0,re=Math.min(re,o))}));const M=t=>{var P;const o=(P=t.statsAll)==null?void 0:P[0];if((o==null?void 0:o.distToCom)!==void 0&&(o==null?void 0:o.distToCom)!=="Infinity")return Math.round(Number(o.distToCom));if((o==null?void 0:o.stackDist)!==void 0)return Math.round(Number(o.stackDist))||0;if(t.hasCommanderTag)return 0;const h=t.combatReplayData;if(!(h!=null&&h.positions)||!Z.length)return 0;const v=h.positions,S=R(h.dead),s=R(h.down),k=Math.floor((h.start||0)/E);let f=0;if(S.length&&s.length)for(const[te]of S){if(te<0)continue;const y=Math.max(0,Math.floor(te/E))-k;for(const[W,X]of s){if(te!==X)continue;const ne=u&&W>re?Math.max(1,Math.floor(re/E)):y,ae=Math.max(0,Math.min(ne,v.length,Z.length));if(ae<=0)continue;let ee=0;for(let Q=0;Q<ae;Q++){const[C,U]=v[Q],[G,Y]=Z[Q];ee+=Math.hypot(C-G,U-Y)}f=Math.round(ee/ae/ve)}}return f},N=b.filter(t=>!t.notInSquad);pe+=N.length,Te+=a.filter(t=>!t.isFake).length,ci(b,{durationMS:i.durationMS,buffMap:i.buffMap});const{squadDeaths:L,enemyDeaths:c}=be(i);Ne+=L,m+=c,le+=L,Me+=c,Se(i)?ke++:de++;const q=i.skillMap?Number((Ue=Object.keys(i.skillMap).find(t=>{var o,h;return((h=(o=i.skillMap)==null?void 0:o[t])==null?void 0:h.name)==="Battle Standard"}))==null?void 0:Ue.replace(/^s/,"")):null;b.forEach((t,o)=>{var lt,ut,xt,St,kt,Un,$n,xn,Rn,On,_n,Wn,jn;if(t.notInSquad)return;const h=t.account||"Unknown",v=h!=="Unknown"?h:t.name||"Unknown",S=t.name||"Unknown";he.has(v)||he.set(v,{name:S,account:v,characterNames:new Set,downContrib:0,cleanses:0,strips:0,stab:0,healing:0,barrier:0,cc:0,logsJoined:0,totalDist:0,distCount:0,dodges:0,downs:0,deaths:0,totalFightMs:0,offenseTotals:{},offenseRateWeights:{},defenseActiveMs:0,defenseTotals:{},supportActiveMs:0,supportTotals:{},healingActiveMs:0,healingTotals:{},profession:t.profession||"Unknown",professions:new Set,professionTimeMs:{},squadActiveMs:0,firstSeenFightTs:0,lastSeenFightTs:0,lastSeenFightDurationMs:0,isCommander:!1,damage:0,dps:0,revives:0,outgoingConditions:{},incomingConditions:{}});const s=he.get(v);if(t.hasCommanderTag&&(s.isCommander=!0),S!=="Unknown"&&s.characterNames.add(String(S)),t.profession&&t.profession!=="Unknown"){s.profession=t.profession,s.professions.add(t.profession);const D=Array.isArray(t.activeTimes)&&typeof t.activeTimes[0]=="number"?t.activeTimes[0]:i.durationMS||0;s.professionTimeMs[t.profession]=(s.professionTimeMs[t.profession]||0)+D}s.logsJoined++,s.downContrib+=rn(t),s.cleanses+=on(t),s.strips+=an(t,Fe),s.healing+=cn(t),s.barrier+=ln(t),s.cc+=un(t,Fe),s.stab+=t.stabGeneration||0;const k=M(t);k<=B&&(s.totalDist+=k,s.distCount++),(lt=t.defenses)!=null&&lt[0]&&(s.dodges+=t.defenses[0].dodgeCount||0,s.downs+=t.defenses[0].downCount||0,s.deaths+=t.defenses[0].deadCount||0),i.durationMS&&(s.totalFightMs+=i.durationMS);const f=Array.isArray(t.activeTimes)&&typeof t.activeTimes[0]=="number"?t.activeTimes[0]:i.durationMS||0;s.squadActiveMs+=f;const P=Ye(i,e),te=Number((i==null?void 0:i.durationMS)||0);P>0&&((s.firstSeenFightTs<=0||P<s.firstSeenFightTs)&&(s.firstSeenFightTs=P),s.lastSeenFightTs<=0||P>s.lastSeenFightTs?(s.lastSeenFightTs=P,s.lastSeenFightDurationMs=te):P===s.lastSeenFightTs&&te>s.lastSeenFightDurationMs&&(s.lastSeenFightDurationMs=te)),s.defenseActiveMs+=f,s.supportActiveMs+=f,s.healingActiveMs+=f,Array.isArray(t.buffUptimes)&&t.buffUptimes.length>0&&t.buffUptimes.forEach(D=>{var Kn,Vn,Gn,Yn,Jn,Qn;if(typeof(D==null?void 0:D.id)!="number")return;const F=`b${D.id}`,I=((Kn=i.buffMap)==null?void 0:Kn[F])||((Vn=i.buffMap)==null?void 0:Vn[String(D.id)]);if(!I||Fi(I))return;const O=Number(((Yn=(Gn=D.buffData)==null?void 0:Gn[0])==null?void 0:Yn.uptime)??0),ue=Number(((Qn=(Jn=D.buffData)==null?void 0:Jn[0])==null?void 0:Qn.presence)??0);if((!Number.isFinite(O)||O<=0)&&(!Number.isFinite(ue)||ue<=0))return;const Oe=(I==null?void 0:I.stacking)??!1,Qe=(Oe?Number.isFinite(O)?O:0:Number.isFinite(O)?O/100:0)*f,ot=Oe?ue:O,gt=Math.min(Math.max(Number.isFinite(ot)?ot:0,0),100)/100*f,Nt=Number.isFinite(Qe)&&Qe>0,Ct=Number.isFinite(gt)&&gt>0;if(!Nt&&!Ct)return;const et=fi(I==null?void 0:I.name);if(et&&Di.has(et)&&(!(I!=null&&I.classification)||I.classification==="Condition")){const Rt=Qe/1e3,tt=I==null?void 0:I.icon,At=qe[et]||{name:et,icon:tt,applications:0,damage:0};At.applicationsFromUptime=(At.applicationsFromUptime||0)+Rt,!At.icon&&tt&&(At.icon=tt),qe[et]=At;const Tt=s.outgoingConditions[et]||{applications:0,damage:0,skills:{},icon:tt};Tt.applicationsFromUptime=(Tt.applicationsFromUptime||0)+Rt,!Tt.icon&&tt&&(Tt.icon=tt),s.outgoingConditions[et]=Tt;const Mt=$e[et]||{name:et,icon:tt,applications:0,damage:0};Mt.applicationsFromUptime=(Mt.applicationsFromUptime||0)+Rt,!Mt.icon&&tt&&(Mt.icon=tt),$e[et]=Mt;const wt=s.incomingConditions[et]||{applications:0,damage:0,skills:{},icon:tt};wt.applicationsFromUptime=(wt.applicationsFromUptime||0)+Rt,!wt.icon&&tt&&(wt.icon=tt),s.incomingConditions[et]=wt}xe.has(F)||xe.set(F,{name:I==null?void 0:I.name,stacking:Oe,icon:I==null?void 0:I.icon}),Ve.has(F)||Ve.set(F,new Map);const zn=Ve.get(F),Xt=s.account||t.account||t.name||"Unknown";let at=zn.get(Xt);at||(at={account:Xt,profession:s.profession||t.profession||"Unknown",professions:new Set,professionTimeMs:{},totalMs:0,uptimeMs:0,durationMs:0},zn.set(Xt,at));const pt=t.profession||s.profession;pt&&pt!=="Unknown"&&(at.professions.add(pt),at.professionTimeMs[pt]=(at.professionTimeMs[pt]||0)+f,at.profession=pt),at.totalMs+=Nt?Qe:0,at.uptimeMs+=Ct?gt:0,at.durationMs+=f}),(ut=t.defenses)!=null&&ut[0]&&ki.forEach(D=>{const F=Number(t.defenses[0][D.field]??0);Number.isFinite(F)&&(s.defenseTotals[D.id]=(s.defenseTotals[D.id]||0)+F)}),(xt=t.support)!=null&&xt[0]&&Ni.forEach(D=>{let F=Number(t.support[0][D.field]??0);Number.isFinite(F)&&(_e.has(D.field)&&F>999999&&(F=0),s.supportTotals[D.id]=(s.supportTotals[D.id]||0)+F)});const y=(D,F)=>{Number.isFinite(F)&&(s.healingTotals[D]=(s.healingTotals[D]||0)+F)},W=(D,F)=>Array.isArray(D)?D.reduce((I,O)=>I+Number((O==null?void 0:O[F])??0),0):0,X=(D,F,I)=>{if(!Number.isFinite(I)||I<=0)return;const O=b[F],ue=F===o,Oe=O==null?void 0:O.notInSquad,Ge=!Oe,Qe=Ge&&(O==null?void 0:O.group)!=null&&O.group===t.group;y(D,I),Ge&&y(`squad${D[0].toUpperCase()}${D.slice(1)}`,I),Qe&&y(`group${D[0].toUpperCase()}${D.slice(1)}`,I),ue&&y(`self${D[0].toUpperCase()}${D.slice(1)}`,I),Oe&&y(`offSquad${D[0].toUpperCase()}${D.slice(1)}`,I)};if(Array.isArray(t.rotation)){let D=0;t.rotation.forEach(F=>{var O;if(!(F!=null&&F.id)||!Ti(F.id,i.skillMap))return;const I=((O=F.skills)==null?void 0:O.length)||0;I>0&&(D+=I,y(`resUtility_s${F.id}`,I))}),D>0&&y("resUtility",D)}const ne=(St=t.extHealingStats)==null?void 0:St.outgoingHealingAllies;Array.isArray(ne)&&ne.forEach((D,F)=>{const I=W(D,"healing"),O=W(D,"downedHealing");X("healing",F,I),X("downedHealing",F,O)});const ae=(kt=t.extBarrierStats)==null?void 0:kt.outgoingBarrierAllies;Array.isArray(ae)&&ae.forEach((D,F)=>{const I=W(D,"barrier");X("barrier",F,I)});const ee=(Un=t.statsAll)==null?void 0:Un[0],Q=($n=t.dpsAll)==null?void 0:$n[0],C=(xn=t.support)==null?void 0:xn[0];if(Si.forEach(D=>{if(D.id==="downContributionPercent"||!D.field)return;let F=0,I=0;D.source==="dpsAll"&&Q?F=Number(Q[D.field]??0):D.source==="statsAll"&&ee?(F=Number(ee[D.field]??0),I=Number(ee[D.denomField||D.weightField||"connectedDamageCount"]??0)):D.source==="support"&&C?F=Number(C[D.field]??0):t.statsTargets&&t.statsTargets.forEach(O=>{O!=null&&O[0]&&(F+=Number(O[0][D.field]??0),I+=Number(O[0][D.denomField||D.weightField||"connectedDamageCount"]??0))}),Number.isFinite(F)&&(s.offenseTotals[D.id]=(s.offenseTotals[D.id]||0)+F,D.isRate&&I>0&&(s.offenseRateWeights[D.id]=(s.offenseRateWeights[D.id]||0)+I))}),t.targetDamageDist&&Number.isFinite(q)){const D=t.targetDamageDist.flatMap(F=>F||[]).flatMap(F=>F||[]).reduce((F,I)=>I!=null&&I.id&&I.id===q?F+((I==null?void 0:I.connectedHits)||0):F,0);s.offenseTotals.battleStandardHits=(s.offenseTotals.battleStandardHits||0)+D}s.revives+=((On=(Rn=t.support)==null?void 0:Rn[0])==null?void 0:On.resurrects)||0,Q&&(s.damage+=Q.damage||0,s.dps+=Q.dps||0);const U=D=>{var ue,Oe,Ge,Qe;let F=`Skill ${D.id}`;const I=((ue=i.skillMap)==null?void 0:ue[`s${D.id}`])||((Oe=i.skillMap)==null?void 0:Oe[`${D.id}`]);let O=I==null?void 0:I.icon;if(I!=null&&I.name&&(F=I.name),F.startsWith("Skill ")){const ot=vt(F,D.id,i.buffMap);ot&&(F=ot,O=((Qe=(Ge=i.buffMap)==null?void 0:Ge[`b${D.id}`])==null?void 0:Qe.icon)||O)}return{name:F,icon:O}},G=D=>{if(!(D!=null&&D.id))return;const{name:F,icon:I}=U(D);ge[D.id]||(ge[D.id]={name:F,icon:I,damage:0,hits:0,downContribution:0}),ge[D.id].name.startsWith("Skill ")&&!F.startsWith("Skill ")&&(ge[D.id].name=F),!ge[D.id].icon&&I&&(ge[D.id].icon=I),ge[D.id].damage+=D.totalDamage,ge[D.id].hits+=D.connectedHits,ge[D.id].downContribution+=Number(D.downContribution||0)},Y=t.account||t.name||"Unknown",De=t.profession||"Unknown",Be=`${Y}|${De}`;let Ke=je.get(Be);Ke||(Ke={key:Be,account:Y,displayName:Y,profession:De,professionList:[De],totalFightMs:0,skills:new Map},je.set(Be,Ke)),Ke.professionList.includes(De)||Ke.professionList.push(De),Ke.totalFightMs+=i.durationMS||0;const Je=D=>{if(!(D!=null&&D.id))return;const{name:F,icon:I}=U(D),O=`s${D.id}`;let ue=Ke.skills.get(O);ue||(ue={id:O,name:F,icon:I,damage:0,downContribution:0},Ke.skills.set(O,ue)),ue.name.startsWith("Skill ")&&!F.startsWith("Skill ")&&(ue.name=F),!ue.icon&&I&&(ue.icon=I),ue.damage+=Number(D.totalDamage||0),ue.downContribution+=Number(D.downContribution||0)};if(Ie==="total")(_n=t.totalDamageDist)==null||_n.forEach(D=>{D==null||D.forEach(F=>{G(F),Je(F)})});else{const D=new Map;(Wn=t.targetDamageDist)==null||Wn.forEach(I=>{I==null||I.forEach(O=>{O==null||O.forEach(ue=>{const Oe=Number(ue==null?void 0:ue.id);if(Number.isFinite(Oe)){const Ge=D.get(Oe)||{damage:0,hits:0,downContribution:0};Ge.damage+=Number((ue==null?void 0:ue.totalDamage)||0),Ge.hits+=Number((ue==null?void 0:ue.connectedHits)||0),Ge.downContribution+=Number((ue==null?void 0:ue.downContribution)||0),D.set(Oe,Ge)}G(ue),Je(ue)})})}),!(i!=null&&i.detailedWvW)&&((jn=t.totalDamageDist)==null||jn.forEach(I=>{I==null||I.forEach(O=>{const ue=Number(O==null?void 0:O.id);if(!Number.isFinite(ue))return;const Oe=D.get(ue);if(!Oe){G(O),Je(O);return}const Ge=Number((O==null?void 0:O.totalDamage)||0),Qe=Number((O==null?void 0:O.connectedHits)||0),ot=Number((O==null?void 0:O.downContribution)||0),ft=Ge-Number(Oe.damage||0),gt=Qe-Number(Oe.hits||0),Nt=ot-Number(Oe.downContribution||0);if(ft<=0&&gt<=0&&Nt<=0)return;const Ct={...O,totalDamage:Math.max(0,ft),connectedHits:Math.max(0,gt),downContribution:Math.max(0,Nt)};G(Ct),Je(Ct)})}))}t.totalDamageTaken&&t.totalDamageTaken.forEach(D=>{D==null||D.forEach(F=>{var Oe,Ge,Qe,ot;if(!(F!=null&&F.id))return;let I=`Skill ${F.id}`;const O=((Oe=i.skillMap)==null?void 0:Oe[`s${F.id}`])||((Ge=i.skillMap)==null?void 0:Ge[`${F.id}`]);let ue=O==null?void 0:O.icon;if(O!=null&&O.name&&(I=O.name),I.startsWith("Skill ")){const ft=vt(I,F.id,i.buffMap);ft&&(I=ft,ue=((ot=(Qe=i.buffMap)==null?void 0:Qe[`b${F.id}`])==null?void 0:ot.icon)||ue)}we[F.id]||(we[F.id]={name:I,icon:ue,damage:0,hits:0}),(!we[F.id].name.startsWith("Skill ")||I.startsWith("Skill "))&&(we[F.id].name=I),!we[F.id].icon&&ue&&(we[F.id].icon=ue),we[F.id].damage+=F.totalDamage,we[F.id].hits+=F.hits})})}),a.forEach(t=>{if(t!=null&&t.isFake)return;const o=ye((t==null?void 0:t.profession)||(t==null?void 0:t.name)||(t==null?void 0:t.id));o&&(He[o]=(He[o]||0)+1)});const A=hi({players:b,targets:a,skillMap:i.skillMap,buffMap:i.buffMap,getPlayerKey:t=>t.account&&t.account!=="Unknown"?t.account:t.name||null}),x=dn(i.buffMap);Object.entries(A.playerConditions).forEach(([t,o])=>{const h=he.get(t);h&&Object.entries(o).forEach(([v,S])=>{const s=h.outgoingConditions[v]||{applications:0,damage:0,skills:{},icon:S.icon};s.applications+=Number(S.applications||0),s.damage+=Number(S.damage||0),S.applicationsFromBuffs&&(s.applicationsFromBuffs=(s.applicationsFromBuffs||0)+S.applicationsFromBuffs),S.applicationsFromBuffsActive&&(s.applicationsFromBuffsActive=(s.applicationsFromBuffsActive||0)+S.applicationsFromBuffsActive),Object.entries(S.skills||{}).forEach(([k,f])=>{const P=s.skills[k]||{name:f.name,hits:0,damage:0,icon:f.icon};P.hits+=Number(f.hits||0),P.damage+=Number(f.damage||0),!P.icon&&f.icon&&(P.icon=f.icon),s.skills[k]=P}),!s.icon&&S.icon&&(s.icon=S.icon),h.outgoingConditions[v]=s})}),Object.entries(A.summary).forEach(([t,o])=>{const h=qe[t]||{name:o.name||t,icon:o.icon,applications:0,damage:0};h.applications+=Number(o.applications||0),h.damage+=Number(o.damage||0),o.applicationsFromBuffs&&(h.applicationsFromBuffs=(h.applicationsFromBuffs||0)+o.applicationsFromBuffs),o.applicationsFromBuffsActive&&(h.applicationsFromBuffsActive=(h.applicationsFromBuffsActive||0)+o.applicationsFromBuffsActive),!h.icon&&o.icon&&(h.icon=o.icon),qe[t]=h}),N.forEach(t=>{const o=t.account&&t.account!=="Unknown"?t.account:t.name||"Unknown",h=he.get(o);!h||!t.totalDamageTaken||t.totalDamageTaken.forEach(v=>v==null?void 0:v.forEach(S=>{var Q,C,U,G,Y,De;if(!(S!=null&&S.id))return;let s=`Skill ${S.id}`;const k=((Q=i.skillMap)==null?void 0:Q[`s${S.id}`])||((C=i.skillMap)==null?void 0:C[`${S.id}`]);k!=null&&k.name&&(s=k.name);const f=vt(s,S.id,i.buffMap);if(!f)return;const P=(G=(U=i.buffMap)==null?void 0:U[`b${S.id}`])==null?void 0:G.name,te=x.get(f)||((De=(Y=i.buffMap)==null?void 0:Y[`b${S.id}`])==null?void 0:De.icon),y=(k==null?void 0:k.icon)||te;s.startsWith("Skill ")&&(P||f)&&(s=P||f);const W=Number(S.hits??0),X=Number(S.totalDamage??0),ne=$e[f]||{name:f,icon:te,applications:0,damage:0};ne.applications+=Number.isFinite(W)?W:0,ne.damage+=Number.isFinite(X)?X:0,!ne.icon&&te&&(ne.icon=te),$e[f]=ne;const ae=h.incomingConditions[f]||{applications:0,damage:0,skills:{},icon:te};ae.applications+=Number.isFinite(W)?W:0,ae.damage+=Number.isFinite(X)?X:0;const ee=ae.skills[s]||{name:s,hits:0,damage:0,icon:y};ee.hits+=Number.isFinite(W)?W:0,ee.damage+=Number.isFinite(X)?X:0,!ee.icon&&y&&(ee.icon=y),ae.skills[s]=ee,!ae.icon&&te&&(ae.icon=te),h.incomingConditions[f]=ae}))});const ce=i.player_damage_mitigation||i.playerDamageMitigation,Pe=ce&&typeof ce=="object"&&Object.keys(ce).length>0;Pe&&Object.entries(ce).forEach(([t,o])=>{if(!o||typeof o!="object")return;const h=Sn(t),v=kn(Pt,h.account,h);Object.values(o).forEach(S=>{fe((S==null?void 0:S.avoided_damage)??(S==null?void 0:S.avoidedDamage))<=0||Cn(v.mitigationTotals,S)})});const Ee=i.player_minion_damage_mitigation||i.playerMinionDamageMitigation,We=Ee&&typeof Ee=="object"&&Object.keys(Ee).length>0;We&&Object.entries(Ee).forEach(([t,o])=>{if(!o||typeof o!="object")return;const h=Sn(t);Object.entries(o).forEach(([v,S])=>{if(!S||typeof S!="object")return;const s=`${h.account}::${v}`,k=Nn(qt,s,{...h,minion:String(v||"Unknown")});Object.values(S).forEach(f=>{Cn(k.mitigationTotals,f)})})}),(!Pe||!We)&&(Pe||N.forEach(t=>{const o=(t==null?void 0:t.totalDamageTaken)||[];if(!Array.isArray(o)||o.length===0)return;const h=t.account||t.name||"Unknown",v={account:h,name:t.name||h,profession:ye(t.profession||"Unknown")};kn(Pt,h,v);const S=i.skillMap||{},s=i.buffMap||{},k=Array.isArray(o)?o[0]:null;if(k==null||k.forEach(f=>{if(!(f!=null&&f.id))return;const P=fe(f.blocked),te=fe(f.evaded),y=fe(f.glance??f.glanced),W=fe(f.missed),X=fe(f.invulned),ne=fe(f.interrupted),ae=fe(f.hits??f.connectedHits),ee=Number(f.id),Q=Ht(ee,S,s);if(wn(Tn,`${h}::${ee}`,{totalHits:ae,blocked:P,evaded:te,glanced:y,missed:W,invulned:X,interrupted:ne}),h===Ut){const C=Dt.get(ee),U=rt(ee),G=U.hasSkill?U.hits>0?U.avg:0:1,Y=U.hasSkill?U.min||0:1,De=U.hits>0?y*G/2+(P+te+W+X+ne)*G:0,Be=U.hits>0?y*Y/2+(P+te+W+X+ne)*Y:0;zt.push({logId:e.filePath||e.id||n,skillId:f.id,skillName:Q,blocked:P,evaded:te,glanced:y,missed:W,invulned:X,interrupted:ne,totalAvoids:P+te+y+W+X+ne,avg:G,min:Y,enemyHits:(C==null?void 0:C.connectedHits)??0,enemyTotalDmg:(C==null?void 0:C.totalDamage)??0,avoidDmg:De,avoidMinDmg:Be})}}),h===Ut){const f=(P,te)=>{let y=0,W=0,X=0;if(!Array.isArray(P))return{total:y,minTotal:W,hits:X};for(const ne of P){if(!(ne!=null&&ne.id))continue;const ae=fe(ne.blocked),ee=fe(ne.evaded),Q=fe(ne.glance??ne.glanced),C=fe(ne.missed),U=fe(ne.invulned),G=fe(ne.interrupted),Y=Ht(Number(ne.id),T,g),De=te(Number(ne.id),Y);(De.hits??0)>0&&(y+=Q*De.avg/2+(ae+ee+C+U+G)*De.avg,W+=Q*De.min/2+(ae+ee+C+U+G)*De.min),X+=fe(ne.hits??ne.connectedHits)}return{total:y,minTotal:W,hits:X}};Kt.push({logId:e.filePath||e.id||n,variant:"current_global_name_taken0",...f(k,(P,te)=>{const y=rt(P),W=y.hasSkill?y.hits>0?y.avg:0:1,X=y.hasSkill?y.min||0:1;return{avg:W,min:X,hits:y.hits}})})}}),We||N.forEach(t=>{const o=(t==null?void 0:t.minions)||[];if(!Array.isArray(o)||o.length===0)return;const h=t.account||t.name||"Unknown",v={account:h,name:t.name||h,profession:ye(t.profession||"Unknown")},S=i.skillMap||{},s=i.buffMap||{};o.forEach(k=>{const f=(k==null?void 0:k.totalDamageTakenDist)||[];if(!Array.isArray(f)||f.length===0)return;let P=String((k==null?void 0:k.name)||"Unknown").replace(/^Juvenile\s+/i,"")||"Unknown";P.toUpperCase().includes("UNKNOWN")&&(P="Unknown");const te=`${h}::${P}`;Nn(qt,te,{...v,minion:P});const y=Array.isArray(f)?f[0]:null;if(y==null||y.forEach(W=>{if(!(W!=null&&W.id))return;const X=fe(W.blocked),ne=fe(W.evaded),ae=fe(W.glance??W.glanced),ee=fe(W.missed),Q=fe(W.invulned),C=fe(W.interrupted),U=fe(W.hits??W.connectedHits),G=Number(W.id),Y=Ht(G,S,s);if(wn(Mn,`${te}::${G}`,{totalHits:U,blocked:X,evaded:ne,glanced:ae,missed:ee,invulned:Q,interrupted:C}),h===Ut&&P===An){const De=Dt.get(G),Be=rt(G),Ke=Be.hasSkill?Be.hits>0?Be.avg:0:1,Je=Be.hasSkill?Be.min||0:1,lt=Be.hits>0?ae*Ke/2+(X+ne+ee+Q+C)*Ke:0,ut=Be.hits>0?ae*Je/2+(X+ne+ee+Q+C)*Je:0;jt.push({logId:e.filePath||e.id||n,skillId:W.id,skillName:Y,blocked:X,evaded:ne,glanced:ae,missed:ee,invulned:Q,interrupted:C,totalAvoids:X+ne+ae+ee+Q+C,avg:Ke,min:Je,enemyHits:(De==null?void 0:De.connectedHits)??0,enemyTotalDmg:(De==null?void 0:De.totalDamage)??0,avoidDmg:lt,avoidMinDmg:ut})}}),h===Ut&&P===An){const W=(ee,Q)=>{let C=0,U=0,G=0;if(!Array.isArray(ee))return{total:C,minTotal:U,hits:G};for(const Y of ee){if(!(Y!=null&&Y.id))continue;const De=fe(Y.blocked),Be=fe(Y.evaded),Ke=fe(Y.glance??Y.glanced),Je=fe(Y.missed),lt=fe(Y.invulned),ut=fe(Y.interrupted),xt=Ht(Number(Y.id),T,g),{avg:St,min:kt}=Q(Number(Y.id),xt);fe(Y.hits??Y.connectedHits)>0&&(C+=Ke*St/2+(De+Be+Je+lt+ut)*St,U+=Ke*kt/2+(De+Be+Je+lt+ut)*kt),G+=fe(Y.hits??Y.connectedHits)}return{total:C,minTotal:U,hits:G}},X=Array.isArray(f)?f[0]||[]:[],ne=Array.isArray(f)?f.flat():[],ae=Array.isArray(k==null?void 0:k.totalDamageTaken)?k.totalDamageTaken[0]||[]:[];ct.push({logId:e.filePath||e.id||n,variant:"current_global_name_dist0",...W(X,(ee,Q)=>{const C=rt(ee),U=C.hasSkill?C.hits>0?C.avg:0:1,G=C.hasSkill&&C.min||0;return{avg:U,min:G}})}),ct.push({logId:e.filePath||e.id||n,variant:"local_name_dist0",...W(X,(ee,Q)=>oe(Q))}),ct.push({logId:e.filePath||e.id||n,variant:"local_id_dist0",...W(X,ee=>K(ee))}),ct.push({logId:e.filePath||e.id||n,variant:"global_name_alllists",...W(ne,(ee,Q)=>{const C=rt(ee),U=C.hasSkill?C.hits>0?C.avg:0:1,G=C.hasSkill&&C.min||0;return{avg:U,min:G}})}),ct.push({logId:e.filePath||e.id||n,variant:"global_name_taken0",...W(ae,(ee,Q)=>{const C=rt(ee),U=C.hasSkill?C.hits>0?C.avg:0:1,G=C.hasSkill&&C.min||0;return{avg:U,min:G}})})}})}))}),jt.length>0&&(console.groupCollapsed("[Mitigation Debug] Ashtonlightstone.9145 / Illusionary Warden"),console.table(jt),ct.length>0&&console.table(ct),console.groupEnd()),zt.length>0&&(console.groupCollapsed("[Mitigation Debug] Ashtonlightstone.9145 / Player"),console.table(zt),Kt.length>0&&console.table(Kt),console.groupEnd());const vn=(e,n)=>{const i=new Map,b=a=>{let T=i.get(a);return T||(T=ht(),i.set(a,T)),T};n.forEach((a,T)=>{const g=T.lastIndexOf("::"),$=g>-1?T.slice(0,g):T,_=g>-1?Number(T.slice(g+2)):Number.NaN,K=Number.isFinite(_)?rt(_):{hasSkill:!1,avg:0,min:0,hits:0};if(!K.hasSkill||K.hits<=0)return;const oe=K.avg,se=K.min,ve=a.glanced*oe/2+(a.blocked+a.evaded+a.missed+a.invulned+a.interrupted)*oe,E=a.glanced*se/2+(a.blocked+a.evaded+a.missed+a.invulned+a.interrupted)*se;if(ve<=0)return;const B=b($);B.totalHits+=a.totalHits,B.blocked+=a.blocked,B.evaded+=a.evaded,B.glanced+=a.glanced,B.missed+=a.missed,B.invulned+=a.invulned,B.interrupted+=a.interrupted,B.totalMitigation+=ve,B.minMitigation+=E}),e.forEach((a,T)=>{const g=i.get(T)||ht();a.mitigationTotals.totalHits=g.totalHits,a.mitigationTotals.blocked=g.blocked,a.mitigationTotals.evaded=g.evaded,a.mitigationTotals.glanced=g.glanced,a.mitigationTotals.missed=g.missed,a.mitigationTotals.invulned=g.invulned,a.mitigationTotals.interrupted=g.interrupted,a.mitigationTotals.totalMitigation=g.totalMitigation,a.mitigationTotals.minMitigation=g.minMitigation})};vn(Pt,Tn),vn(qt,Mn);const Bi=J>0?Math.round(pe/J):0,Ii=J>0?Math.round(Te/J):0,Li=Ne>0?(m/Ne).toFixed(2):m>0?"∞":"0.00",Pi=Me>0?(le/Me).toFixed(2):le>0?"∞":"0.00",Fn=(e,n)=>{const b=e.filter(g=>Number.isFinite(g.value)&&(n?g.value>0:g.value>=0)).sort((g,$)=>{const _=n?$.value-g.value:g.value-$.value;return _!==0?_:g.account.localeCompare($.account)});let a=null,T=0;return b.map((g,$)=>((a===null||g.value!==a)&&(T=$+1,a=g.value),{rank:T,...g}))},Vt=Array.from(he.values()).map(e=>{const n=Array.from(e.professions).filter(i=>i!=="Unknown");if(e.professionList=n,n.length>0){let i=n[0],b=e.professionTimeMs[i]||0;n.forEach(a=>{const T=e.professionTimeMs[a]||0;T>b&&(b=T,i=a)}),e.profession=i}return{key:e.account,stat:e}}),En=e=>{const n=he.get(e.account);if(!n){const a=e.professionList.length>0?e.professionList:e.profession?[e.profession]:[];return{...e,professionList:a}}const i=n.professionList&&n.professionList.length>0?n.professionList:Array.from(n.professions||[]).filter(a=>a&&a!=="Unknown"),b=n.profession||e.profession;return{...e,profession:b,professionList:i.length>0?i:b?[b]:[],activeMs:n.defenseActiveMs||n.totalFightMs||e.activeMs}},qi=Array.from(Pt.values()).map(En).filter(e=>Ei(e.mitigationTotals)).sort((e,n)=>e.account.localeCompare(n.account)),Hi=Array.from(qt.values()).map(En).filter(e=>e.mitigationTotals.totalMitigation>0).sort((e,n)=>{const i=e.account.localeCompare(n.account);return i!==0?i:String(e.minion||"").localeCompare(String(n.minion||""))}),$t=(e,n)=>{switch(n){case"downContrib":return e.downContrib;case"barrier":return e.barrier;case"healing":return e.healing;case"dodges":return e.dodges;case"strips":return e.strips;case"cleanses":return e.cleanses;case"cc":return e.cc;case"stability":return e.stab;case"revives":return e.revives;case"dps":return e.dps;case"damage":return e.damage;case"participation":return e.logsJoined;case"closestToTag":return!e.isCommander&&e.distCount>0?e.totalDist/e.distCount:Number.POSITIVE_INFINITY;default:return 0}},Ze=(e,n)=>Fn(Vt.map(({stat:i})=>({account:i.account,profession:i.profession,professionList:i.professionList,value:$t(i,e),count:i.logsJoined})),n),Re={downContrib:Ze("downContrib",!0),barrier:Ze("barrier",!0),healing:Ze("healing",!0),dodges:Ze("dodges",!0),strips:Ze("strips",!0),cleanses:Ze("cleanses",!0),cc:Ze("cc",!0),stability:Ze("stability",!0),revives:Ze("revives",!0),participation:Ze("participation",!0),dps:Ze("dps",!0),damage:Ze("damage",!0),closestToTag:Ze("closestToTag",!1).filter(e=>Number.isFinite(e.value))},Ui={downContrib:"downContrib",barrier:"barrier",healing:"healing",dodges:"dodges",strips:"strips",cleanses:"cleanses",cc:"cc",stability:"stability",closestToTag:"closestToTag"},Le=e=>{const n=e==null?void 0:e[0];return{value:(n==null?void 0:n.value)??0,player:(n==null?void 0:n.account)??"-",count:(n==null?void 0:n.count)??0,profession:(n==null?void 0:n.profession)??"Unknown",professionList:(n==null?void 0:n.professionList)??[]}},st={maxDownContrib:Le([]),maxBarrier:Le([]),maxHealing:Le([]),maxDodges:Le([]),maxStrips:Le([]),maxCleanses:Le([]),maxCC:Le([]),maxStab:Le([]),closestToTag:Le([])},it={},$i=(e,n)=>{if(n==="closestToTag")return $t(e,n);const i=Math.max(1,(e.totalFightMs||0)/1e3);return $t(e,n)/i};Object.values(Ui).forEach(e=>{const n=e!=="closestToTag";it[e]=Fn(Vt.map(({stat:i})=>({account:i.account,profession:i.profession,professionList:i.professionList,value:$i(i,e),count:i.logsJoined})),n)}),st.maxDownContrib=Le(it.downContrib),st.maxBarrier=Le(it.barrier),st.maxHealing=Le(it.healing),st.maxDodges=Le(it.dodges),st.maxStrips=Le(it.strips),st.maxCleanses=Le(it.cleanses),st.maxCC=Le(it.cc),st.maxStab=Le(it.stability),st.closestToTag=Le(it.closestToTag);const xi={maxDownContrib:Le(Re.downContrib),maxBarrier:Le(Re.barrier),maxHealing:Le(Re.healing),maxDodges:Le(Re.dodges),maxStrips:Le(Re.strips),maxCleanses:Le(Re.cleanses),maxCC:Le(Re.cc),maxStab:Le(Re.stability),closestToTag:Le(Re.closestToTag)};let Gt={player:"None",account:"None",score:-1,profession:"Unknown",professionList:[],color:"#64748b",topStats:[]},Bn,In,Ln=0;if(Ce!=null&&Ce.showMvp){const e={"Down Contribution":"downContribution",Healing:"healing",Cleanses:"cleanses",Strips:"strips",Stability:"stability",CC:"cc",Revives:"revives","Distance to Tag":"distanceToTag",Participation:"participation",Dodging:"dodging",DPS:"dps",Damage:"damage"},n=T=>{const g=e[T];return g?Number(ie[g]||0)>0:!1},i=[],b=T=>[...T||[]].filter(g=>n(g==null?void 0:g.name)).sort((g,$)=>$.ratio-g.ratio||g.rank-$.rank||g.name.localeCompare($.name)).slice(0,3),a=T=>{var $;if(!T)return;const g=b(T.contribs);return{...T,player:T.name,reason:(($=g[0])==null?void 0:$.name)||"Top Performance",topStats:g}};Vt.forEach(({stat:T})=>{let g=0;const $=[],_=(K,oe,se,ve,E=!0)=>{var R,Z;if(se<=0)return;const B=((R=oe[0])==null?void 0:R.value)||0;if(B&&Number.isFinite(K)&&(E?K>0:K<Number.POSITIVE_INFINITY)){const re=E?K/B:B/K;g+=re*se;const u=((Z=oe.find(d=>d.account===T.account))==null?void 0:Z.rank)||0;$.push({name:ve,ratio:re,val:K.toLocaleString(),rank:u})}};_(T.downContrib,Re.downContrib,ie.downContribution,"Down Contribution"),_(T.healing,Re.healing,ie.healing,"Healing"),_(T.cleanses,Re.cleanses,ie.cleanses,"Cleanses"),_(T.strips,Re.strips,ie.strips,"Strips"),_(T.stab,Re.stability,ie.stability,"Stability"),_(T.cc,Re.cc,ie.cc,"CC"),_(T.revives,Re.revives,ie.revives,"Revives"),_($t(T,"closestToTag"),Re.closestToTag,ie.distanceToTag,"Distance to Tag",!1),_(T.logsJoined,Re.participation,ie.participation,"Participation"),_(T.dodges,Re.dodges,ie.dodging,"Dodging"),_(T.dps,Re.dps,ie.dps,"DPS"),_(T.damage,Re.damage,ie.damage,"Damage"),i.push({...T,score:g,contribs:$.filter(K=>n(K.name))})}),i.sort((T,g)=>g.score-T.score),i[0]&&i[0].score>0&&(Gt=a(i[0])||Gt),Bn=a(i[1]),In=a(i[2]),Ln=i.length>0?i.reduce((T,g)=>T+g.score,0)/i.length:0}const Pn=Object.values(ge).sort((e,n)=>n.damage-e.damage||n.hits-e.hits||String(e.name||"").localeCompare(String(n.name||""))).slice(0,25),qn=Object.values(ge).sort((e,n)=>n.downContribution-e.downContribution||n.hits-e.hits||String(e.name||"").localeCompare(String(n.name||""))).slice(0,25),Ri=z==="downContribution"?qn:Pn,Oi=Object.values(we).sort((e,n)=>n.damage-e.damage).slice(0,25),_i=e=>{const n=String(e).replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),i=n.match(/^(Red|Blue|Green)\s+(?:Alpine|Desert)?\s*Borderlands$/i);return i?`${i[1]} Borderlands`:n||"Unknown"},dt=(e,n)=>_i((e==null?void 0:e.zone)||(e==null?void 0:e.mapName)||(e==null?void 0:e.map)||(e==null?void 0:e.location)||(e==null?void 0:e.fightName)||(n==null?void 0:n.fightName)||(n==null?void 0:n.encounterName)||"Unknown"),Wi=(e,n)=>{const i=(n==null?void 0:n.permalink)||(e==null?void 0:e.permalink);if(typeof i=="string"&&i.trim().length>0)return i.trim();const b=e==null?void 0:e.uploadLinks;if(!Array.isArray(b))return"";for(const a of b){if(typeof a=="string"&&a.trim().length>0)return a.trim();if(a&&typeof a=="object"){const T=a.permalink||a.link||a.url||a.reportLink;if(typeof T=="string"&&T.trim().length>0)return T.trim()}}return""},Yt={};V.forEach(e=>{const n=dt(e==null?void 0:e.details,e);Yt[n]=(Yt[n]||0)+1});const ji=Object.entries(Yt).map(([e,n])=>{const i=String(e).trim(),b=/eternal battlegrounds|^ebg$/i.test(i);let a="#64748b";return b?a="#ffffff":/red/i.test(i)?a="#ef4444":/blue/i.test(i)?a="#3b82f6":/green/i.test(i)&&(a="#22c55e"),{name:e,value:n,color:a}}).sort((e,n)=>n.value-e.value),{boonTables:zi}=Zn(V),Ki=V.map((e,n)=>{var b,a;const i=((b=e.details)==null?void 0:b.players)||[];return{index:n+1,label:`Log ${n+1}`,timestamp:Ye(e.details,e),squadCount:i.filter(T=>!T.notInSquad).length,friendlyCount:i.length,enemies:((a=e.details)==null?void 0:a.targets).filter(T=>!T.isFake).length}}).sort((e,n)=>e.timestamp-n.timestamp),Jt={};Array.from(he.values()).forEach(e=>{e.profession&&e.profession!=="Unknown"&&(Jt[e.profession]=(Jt[e.profession]||0)+1)});const Vi=Object.entries(Jt).map(([e,n])=>({name:e,value:n,color:fn(e)})).sort((e,n)=>n.value-e.value),Qt={};Object.keys(He).length===0&&V.forEach(e=>{var n,i;(i=(n=e.details)==null?void 0:n.targets)==null||i.forEach(b=>{if(b.isFake)return;const a=b.profession&&b.profession!=="Unknown"?b.profession:b.name||b.id||"Unknown",T=ye(a);Qt[T]=(Qt[T]||0)+1})});const Gi=Object.keys(He).length>0?He:Qt,Yi=Object.entries(Gi).map(([e,n])=>({name:e,value:n,color:fn(e)})).sort((e,n)=>n.value-e.value),Hn=V.map((e,n)=>({log:e,originalIndex:n})).sort((e,n)=>Ye(e.log.details,e.log)-Ye(n.log.details,n.log)),Ji=Hn.map(({log:e},n)=>{const i=e.details;if(!i)return null;const b=i.players||[],a=b.filter(c=>!c.notInSquad),T=b.filter(c=>c.notInSquad),$=(i.targets||[]).filter(c=>!c.isFake),_=a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.dpsAll)==null?void 0:q[0])==null?void 0:A.damage)||0)},0),K=a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.defenses)==null?void 0:q[0])==null?void 0:A.damageTaken)||0)},0),{enemyDeaths:oe,enemyDownsDeaths:se}=be(i),ve=Se(i),E=Ye(i,e),B=dt(i,e),R=c=>{if(!c||typeof c!="object")return;const w=c.teamID??c.teamId??c.team??c.teamColor??c.team_color;if(w!=null)return w;const q=Object.keys(c).find(A=>/^team/i.test(A));return q?c[q]:void 0},Z=(c,w)=>{const q={};return c.forEach(A=>{const x=w(A),ce=ye(x);ce&&(q[ce]=(q[ce]||0)+1)}),q},re=Z(a,c=>(c==null?void 0:c.profession)||(c==null?void 0:c.name)),u=Z(T,c=>(c==null?void 0:c.profession)||(c==null?void 0:c.name)),d=Z($,c=>(c==null?void 0:c.profession)||(c==null?void 0:c.name)||(c==null?void 0:c.id)),M=new Set;a.forEach(c=>{const w=R(c);w!=null&&M.add(String(w))});const N=new Map;$.forEach(c=>{if((c==null?void 0:c.enemyPlayer)===!1)return;const w=R(c);if(w==null)return;const q=String(w);M.has(q)||N.set(q,(N.get(q)||0)+1)});const L=Array.from(N.entries()).sort((c,w)=>{const q=w[1]-c[1];return q!==0?q:c[0].localeCompare(w[0],void 0,{numeric:!0})}).slice(0,3).map(([c,w])=>({teamId:c,count:w}));return{id:e.filePath||`fight-${n}`,label:e.encounterName||`Fight ${n+1}`,permalink:Wi(i,e),timestamp:E,mapName:B,duration:Ft(i.durationMS),isWin:ve,squadCount:a.length,allyCount:T.length,enemyCount:$.length,teamBreakdown:L,alliesDown:a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.defenses)==null?void 0:q[0])==null?void 0:A.downCount)||0)},0),alliesDead:a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.defenses)==null?void 0:q[0])==null?void 0:A.deadCount)||0)},0),alliesRevived:a.reduce((c,w)=>{var q,A;return Number(((A=(q=w.statsAll)==null?void 0:q[0])==null?void 0:A.saved)||0)>0?c+1:c},0),rallies:0,enemyDeaths:oe,enemyDowns:Math.max(0,se-oe),totalOutgoingDamage:_,totalIncomingDamage:K,incomingBarrierAbsorbed:a.reduce((c,w)=>{var q,A;return c+(((A=(q=w.defenses)==null?void 0:q[0])==null?void 0:A.damageBarrier)||0)},0),outgoingBarrierAbsorbed:a.reduce((c,w)=>{var x;const q=(x=w.extBarrierStats)==null?void 0:x.outgoingBarrier;if(!Array.isArray(q))return c;let A=0;return q.forEach(ce=>{if(Array.isArray(ce)){ce.forEach(Pe=>{A+=Number((Pe==null?void 0:Pe.barrier)||0)});return}A+=Number((ce==null?void 0:ce.barrier)||0)}),c+A},0),squadClassCountsFight:re,allyClassCountsFight:u,enemyClassCounts:d}}).filter(Boolean),Qi=Hn.map(({log:e},n)=>{const i=e.details;if(!i)return null;const a=(Array.isArray(i.players)?i.players:[]).filter(t=>!t.notInSquad),T=Array.isArray(i.targets)?i.targets:[],g=Ye(i,e),$=dt(i,e),_=Number(i.durationMS||0),{squadDownsDeaths:K,enemyDownsDeaths:oe,squadDeaths:se,enemyDeaths:ve}=be(i),E=new Map,B=(t,o,h)=>{const v=E.get(t)||{label:t,damage:0,hits:0};v.damage+=o,v.hits+=h,E.set(t,v)};if(a.forEach(t=>{(Array.isArray(t==null?void 0:t.statsTargets)?t.statsTargets:[]).forEach((h,v)=>{const S=Array.isArray(h)?h[0]:h,s=Number((S==null?void 0:S.damage)??(S==null?void 0:S.totalDmg)??(S==null?void 0:S.connectedDmg)??0),k=Number((S==null?void 0:S.connectedHits)??(S==null?void 0:S.connectedDamageCount)??(S==null?void 0:S.hits)??0);if(s<=0&&k<=0)return;const f=T[v];if(f!=null&&f.isFake)return;const P=(f==null?void 0:f.profession)||(f==null?void 0:f.name)||(f==null?void 0:f.id)||`Target ${v+1}`,te=ye(P);B(te||String(P),s,k)})}),E.size===0){const t=new Map,o=h=>{if(!Array.isArray(h)||h.length===0)return[];const v=h[0];if(Array.isArray(v)&&Array.isArray(v[0])){if(typeof v[0][0]=="number")return v;if(Array.isArray(v[0])&&typeof v[0][0]=="number")return h.map(S=>Array.isArray(S)?S[0]||[]:[])}return[]};a.forEach(h=>{o(h==null?void 0:h.targetDamage1S).forEach((S,s)=>{if(!Array.isArray(S)||S.length===0)return;const k=S.map(P=>Number(P)).filter(P=>Number.isFinite(P)&&P>=0);if(k.length===0)return;const f=Math.max(0,k[k.length-1]||0);f<=0||t.set(s,(t.get(s)||0)+f)})}),t.forEach((h,v)=>{if(h<=0)return;const S=T[v];if(S!=null&&S.isFake)return;const s=(S==null?void 0:S.profession)||(S==null?void 0:S.name)||(S==null?void 0:S.id)||`Target ${v+1}`,k=ye(s);B(k||String(s),h,0)})}if(E.size===0&&T.forEach((t,o)=>{if(t!=null&&t.isFake)return;const h=Array.isArray(t==null?void 0:t.totalDamageTaken)?t.totalDamageTaken:Array.isArray(t==null?void 0:t.totalDamageDist)?t.totalDamageDist:[];let v=0,S=0;if(h.forEach(f=>{v+=Number((f==null?void 0:f.totalDamage)||(f==null?void 0:f.damage)||0),S+=Number((f==null?void 0:f.connectedHits)||(f==null?void 0:f.hits)||0)}),v<=0&&Number((t==null?void 0:t.damageTaken)||0)>0&&(v=Number(t.damageTaken||0)),v<=0&&S<=0)return;const s=(t==null?void 0:t.profession)||(t==null?void 0:t.name)||(t==null?void 0:t.id)||`Target ${o+1}`,k=ye(s);B(k||String(s),v,S)}),E.size===0){const t=new Map;T.forEach((o,h)=>{if(o!=null&&o.isFake)return;const v=(o==null?void 0:o.profession)||(o==null?void 0:o.name)||(o==null?void 0:o.id)||`Target ${h+1}`,S=ye(v)||String(v);t.set(S,(t.get(S)||0)+1)}),t.forEach((o,h)=>{o>0&&B(h,o,0)})}const R=Array.from(E.values()).sort((t,o)=>o.damage-t.damage||o.hits-t.hits||t.label.localeCompare(o.label)),Z=R.reduce((t,o)=>t+o.damage,0),re=R.map(t=>({label:t.label,damage:t.damage,hits:t.hits,share:Z>0?t.damage/Z:0})),u=T.filter(t=>!(t!=null&&t.isFake)).length,d=a.length,M=a.reduce((t,o)=>{var h,v;return t+Number(((v=(h=o==null?void 0:o.dpsAll)==null?void 0:h[0])==null?void 0:v.damage)||0)},0),N=a.reduce((t,o)=>{var h,v;return t+Number(((v=(h=o==null?void 0:o.defenses)==null?void 0:h[0])==null?void 0:v.damageTaken)||0)},0),L=a.reduce((t,o)=>{var h,v;return t+Number(((v=(h=o==null?void 0:o.defenses)==null?void 0:h[0])==null?void 0:v.damageBarrier)||0)},0),c=a.reduce((t,o)=>{var S;const h=(S=o==null?void 0:o.extBarrierStats)==null?void 0:S.outgoingBarrier;if(!Array.isArray(h))return t;let v=0;return h.forEach(s=>{Array.isArray(s)?s.forEach(k=>{v+=Number((k==null?void 0:k.barrier)||0)}):v+=Number((s==null?void 0:s.barrier)||0)}),t+v},0),w=a.reduce((t,o)=>{var h,v;return Number(((v=(h=o==null?void 0:o.statsAll)==null?void 0:h[0])==null?void 0:v.saved)||0)>0?t+1:t},0),q=a.reduce((t,o)=>t+Number(on(o)||0),0),A=a.reduce((t,o)=>t+Number(an(o)||0),0),x=a.reduce((t,o)=>t+Number((o==null?void 0:o.stabGeneration)||0),0),ce=a.reduce((t,o)=>t+Number(cn(o)||0),0),Pe=a.reduce((t,o)=>t+Number(ln(o)||0),0),Ee=a.reduce((t,o)=>t+Number(un(o)||0),0),We=a.reduce((t,o)=>t+Number(rn(o)||0),0),me=se>0?ve/se:ve,Ue=[{metricId:"winFlag",metricLabel:"Win (1) / Loss (0)",higherIsBetter:!0,value:Se(i)?1:0},{metricId:"squadCount",metricLabel:"Squad Size",higherIsBetter:!0,value:d},{metricId:"enemyCount",metricLabel:"Enemy Count",higherIsBetter:!1,value:u},{metricId:"squadKdr",metricLabel:"Squad KDR",higherIsBetter:!0,value:me},{metricId:"enemyDeaths",metricLabel:"Enemy Deaths",higherIsBetter:!0,value:ve},{metricId:"enemyDowns",metricLabel:"Enemy Downs",higherIsBetter:!0,value:Math.max(0,oe-ve)},{metricId:"squadDeaths",metricLabel:"Squad Deaths",higherIsBetter:!1,value:se},{metricId:"squadDowns",metricLabel:"Squad Downs",higherIsBetter:!1,value:Math.max(0,K-se)},{metricId:"damageDelta",metricLabel:"Damage Delta",higherIsBetter:!0,value:M-N},{metricId:"outgoingDamage",metricLabel:"Outgoing Damage",higherIsBetter:!0,value:M},{metricId:"incomingDamage",metricLabel:"Incoming Damage",higherIsBetter:!1,value:N},{metricId:"cleanses",metricLabel:"Squad Cleanses",higherIsBetter:!0,value:q},{metricId:"strips",metricLabel:"Squad Strips",higherIsBetter:!0,value:A},{metricId:"stability",metricLabel:"Squad Stability",higherIsBetter:!0,value:x},{metricId:"healing",metricLabel:"Squad Healing",higherIsBetter:!0,value:ce},{metricId:"barrierOut",metricLabel:"Squad Barrier Out",higherIsBetter:!0,value:Pe},{metricId:"barrierIncomingAbsorb",metricLabel:"Barrier Absorption (Incoming)",higherIsBetter:!0,value:L},{metricId:"enemyBarrierAbsorb",metricLabel:"Enemy Barrier Absorption",higherIsBetter:!1,value:c},{metricId:"cc",metricLabel:"Squad CC",higherIsBetter:!0,value:Ee},{metricId:"downContrib",metricLabel:"Squad Down Contribution",higherIsBetter:!0,value:We},{metricId:"alliesRevived",metricLabel:"Allies Revived (Players)",higherIsBetter:!0,value:w}];return{id:e.filePath||e.id||`fight-${n+1}`,shortLabel:`F${n+1}`,fullLabel:`${$||e.encounterName||"Unknown Map"} • ${Ft(_)}`,mapName:$,timestamp:g,duration:Ft(_),isWin:Se(i),targetFocus:re,squadMetrics:Ue}}).filter(Boolean),Xi=Array.from(he.values()).map(e=>{const n=Object.entries(e.professionTimeMs||{}).map(([i,b])=>({profession:i,timeMs:Number(b||0)})).filter(i=>i.profession&&i.profession!=="Unknown"&&i.timeMs>0).sort((i,b)=>{const a=b.timeMs-i.timeMs;return a!==0?a:i.profession.localeCompare(b.profession)});return{account:e.account||"Unknown",characterNames:Array.from(e.characterNames||[]).filter(Boolean).sort((i,b)=>i.localeCompare(b)),classTimes:n,combatTimeMs:Number(e.squadActiveMs||e.totalFightMs||0),squadTimeMs:(()=>{const i=Number(e.firstSeenFightTs||0),b=Number(e.lastSeenFightTs||0),a=Math.max(0,Number(e.lastSeenFightDurationMs||0));return i>0&&b>0?Math.max(0,b+a-i):Number(e.squadActiveMs||e.totalFightMs||0)})()}}).filter(e=>e.account&&e.account!=="Unknown").sort((e,n)=>{const i=n.squadTimeMs-e.squadTimeMs;return i!==0?i:String(e.account).localeCompare(String(n.account))}),Zi=V.map(e=>e).sort((e,n)=>Ye(e.details,e)-Ye(n.details,n)).map((e,n)=>{const i=e==null?void 0:e.details,b=Array.isArray(i==null?void 0:i.players)?i.players.filter(g=>!(g!=null&&g.notInSquad)):[],a=new Map;b.forEach(g=>{const $=Number(g==null?void 0:g.group),_=Number.isFinite($)&&$>0?$:0;a.has(_)||a.set(_,{party:_,players:[],classCounts:{}});const K=ye((g==null?void 0:g.profession)||(g==null?void 0:g.name)||"Unknown"),oe=String((g==null?void 0:g.account)||"Unknown"),se=String((g==null?void 0:g.name)||(g==null?void 0:g.character_name)||""),ve=!!(g!=null&&g.hasCommanderTag),E=a.get(_);E.players.push({account:oe,characterName:se,profession:K,isCommander:ve}),E.classCounts[K]=(E.classCounts[K]||0)+1});const T=Array.from(a.values()).map(g=>({...g,players:g.players.sort(($,_)=>{const K=+!!_.isCommander-+!!$.isCommander;if(K!==0)return K;const oe=String($.profession).localeCompare(String(_.profession));return oe!==0?oe:String($.account).localeCompare(String(_.account))})})).sort((g,$)=>g.party===0&&$.party!==0?1:$.party===0&&g.party!==0?-1:g.party-$.party);return{id:String((e==null?void 0:e.filePath)||(e==null?void 0:e.id)||`fight-${n+1}`),label:`F${n+1}`,timestamp:Ye(i,e),mapName:dt(i,e),duration:Ft(Number((i==null?void 0:i.durationMS)||0)),parties:T}}),yi=(e,n)=>{const i=(n==null?void 0:n.skillMap)||{},b=(n==null?void 0:n.buffMap)||{};let a=0,T="";const g=K=>{const oe=Number(K);if(!Number.isFinite(oe))return String(K||"Unknown Skill");const se=(i==null?void 0:i[`s${oe}`])||(i==null?void 0:i[`${oe}`]);if(se!=null&&se.name)return String(se.name);const ve=(b==null?void 0:b[`b${oe}`])||(b==null?void 0:b[`${oe}`]);return ve!=null&&ve.name?String(ve.name):`Skill ${oe}`},$=K=>{if(!K||typeof K!="object")return;const oe=[Number(K.max),Number(K.maxDamage),Number(K.maxHit)].filter(ve=>Number.isFinite(ve)),se=oe.length>0?Math.max(...oe):0;se>a&&(a=se,T=g(K.id))};let _=!1;return Array.isArray(e==null?void 0:e.targetDamageDist)&&e.targetDamageDist.forEach(K=>{Array.isArray(K)&&K.forEach(oe=>{Array.isArray(oe)&&oe.forEach(se=>{_=!0,$(se)})})}),(!_||a<=0)&&Array.isArray(e==null?void 0:e.totalDamageDist)&&e.totalDamageDist.forEach(K=>{Array.isArray(K)&&K.forEach(oe=>$(oe))}),{peak:a,skillName:T||"Unknown Skill"}},es=(()=>{const e=E=>String(E||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),n=E=>e(E).toLowerCase().split(/[^a-z0-9]+/i).map(B=>B.trim()).filter(Boolean).map(B=>B.length>3&&B.endsWith("s")?B.slice(0,-1):B),i=(E,B)=>{const R=e(E),Z=e(B);if(!Z)return R;if(!R)return Z;const re=n(R),u=n(Z),d=new Set(re),M=new Set(u),N=u.length>0&&u.every(c=>d.has(c)),L=re.length>0&&re.every(c=>M.has(c));return N||L?R:`${R} - ${Z}`},b=[],a=new Map,T=E=>{const B=N=>{if(!Array.isArray(N)||N.length===0)return[];const L=[];for(let c=0;c<N.length;c+=1){const w=Number(N[c]||0),q=c>0?Number(N[c-1]||0):0;L.push(Math.max(0,w-q))}return L},R=N=>{if(!Array.isArray(N))return[];const L=N.reduce((w,q)=>Math.max(w,Array.isArray(q)?q.length:0),0);if(L<=0)return[];const c=new Array(L).fill(0);return N.forEach(w=>{if(Array.isArray(w))for(let q=0;q<L;q+=1)c[q]+=Number(w[q]||0)}),c},Z=N=>Array.isArray(N)?N.map(L=>Number(L||0)):null,u=(N=>{if(!Array.isArray(N)||N.length===0)return null;const L=N[0];if(!Array.isArray(L))return null;if(Array.isArray(L[0])&&Array.isArray(L[0][0]))return R(L);if(Array.isArray(L[0])&&!Array.isArray(L[0][0])){const c=N.map(w=>Z(Array.isArray(w)?w[0]:null)).filter(w=>Array.isArray(w)&&w.length>0);if(c.length>0)return R(c)}return null})(E==null?void 0:E.targetDamage1S),d=Array.isArray(E==null?void 0:E.damage1S)&&Array.isArray(E.damage1S[0])?E.damage1S[0]:null,M=u||(Array.isArray(d)?d.map(N=>Number(N||0)):[]);return B(M)},g=(E,B)=>{if(!Array.isArray(E)||E.length===0||B<=0)return 0;let R=0,Z=0;for(let re=0;re<E.length;re+=1)R+=Number(E[re]||0),re>=B&&(R-=Number(E[re-B]||0)),re>=B-1&&R>Z&&(Z=R);return Math.max(0,Z)},$=(E,B)=>{if(!Array.isArray(E)||E.length===0||B<=0)return[];const R=[];for(let Z=0;Z<E.length;Z+=B){const re=Math.min(Z+B,E.length),u=E.slice(Z,re).reduce((d,M)=>d+Number(M||0),0);R.push(u)}return R},_=(E,B)=>{const R=Number(E);if(!Number.isFinite(R))return{name:String(E||"Unknown Skill"),icon:void 0};const Z=(B==null?void 0:B.skillMap)||{},re=(B==null?void 0:B.buffMap)||{},u=(Z==null?void 0:Z[`s${R}`])||(Z==null?void 0:Z[`${R}`]);if(u!=null&&u.name)return{name:String(u.name),icon:u==null?void 0:u.icon};const d=(re==null?void 0:re[`b${R}`])||(re==null?void 0:re[`${R}`]);return d!=null&&d.name?{name:String(d.name),icon:d==null?void 0:d.icon}:{name:`Skill ${R}`,icon:void 0}},K=E=>Array.isArray(E)?E.map(B=>Array.isArray(B)?[Number(B[0]),Number(B[1])]:B&&typeof B=="object"?[Number(B.time),Number(B.value)]:null).filter(B=>!!B&&Number.isFinite(B[0])&&B[0]>=0):[],oe=(E,B,R,Z,re)=>{if(!E.length||Z<=0)return[];const u=Math.max(Z*5e3,re||0),d=x=>x.reduce((ce,Pe)=>Pe>=0&&Pe<=u+2e3?ce+1:ce,0),M=E.map(x=>Number(x||0)).filter(x=>Number.isFinite(x)&&x>=0);if(!M.length)return[];const N=[M],L=M.reduce((x,ce)=>Math.max(x,ce),0),c=M.reduce((x,ce)=>Math.min(x,ce),Number.POSITIVE_INFINITY);L>u*20&&N.push(M.map(x=>x/1e3)),L<=u*2&&c>=0&&L>0&&L<Math.max(120,Z*5+10)&&N.push(M.map(x=>x*1e3));let w=M,q=0,A=-1;return N.forEach(x=>{const ce=x.reduce((Ee,We)=>Math.min(Ee,We),Number.POSITIVE_INFINITY),Pe=new Set([0,...B,...R]);if(Number.isFinite(ce)&&u>0&&ce>u){const Ee=Math.floor(ce/u)*u;Pe.add(Ee),Pe.add(Math.max(0,Ee-u))}Pe.forEach(Ee=>{const We=x.map(Ue=>Ue-Ee),me=d(We);me>A&&(A=me,q=Ee,w=x)})}),w.map(x=>x-q).filter(x=>Number.isFinite(x)&&x>=0)},se=(E,B,R,Z,re)=>{const u=oe(E,B,R,Z,re);return Array.from(new Set(u.map(d=>Math.floor(d/5e3)).filter(d=>Number.isFinite(d)&&d>=0&&d<Z)))};V.map(E=>({log:E,ts:Ye(E==null?void 0:E.details,E)})).sort((E,B)=>E.ts-B.ts).forEach(({log:E},B)=>{const R=E==null?void 0:E.details;if(!R)return;const Z=e(R.fightName||E.fightName||`Fight ${B+1}`),re=dt(R,E),u=i(Z,String(re||"")),d={},M=Array.isArray(R.players)?R.players:[],N=M.flatMap(A=>{const x=A==null?void 0:A.combatReplayData;return Array.isArray(x)?x.map(ce=>Number(ce==null?void 0:ce.start)):[Number(x==null?void 0:x.start)]}).filter(A=>Number.isFinite(A)&&A>=0);M.forEach(A=>{if(A!=null&&A.notInSquad)return;const x=String((A==null?void 0:A.account)||(A==null?void 0:A.name)||"Unknown"),ce=String((A==null?void 0:A.character_name)||(A==null?void 0:A.display_name)||(A==null?void 0:A.name)||""),Pe=String((A==null?void 0:A.profession)||"Unknown"),Ee=`${x}|${Pe}`,We=yi(A,R),me=Number(We.peak||0),Ue=T(A),t=Number(g(Ue,1)||0),o=Number(g(Ue,5)||0),h=Number(g(Ue,30)||0),v=Math.max(0,Math.ceil(Number((R==null?void 0:R.durationMS)||0)/5e3)),S=Math.max(0,Math.ceil(Ue.length/5)),s=Math.max(v,S),k=$(Ue,5),f=Array.from({length:s},(C,U)=>Number(k[U]||0)),P=new Map,te=C=>{if(!C||typeof C!="object"||C.indirectDamage)return;const U=Number(C.totalDamage||0);if(!Number.isFinite(U)||U<=0)return;const G=Number(C.connectedHits||C.hits||0),Y=_(C.id,R),De=Y.name,Be=P.get(De)||{skillName:De,damage:0,hits:0,icon:Y.icon};Be.damage+=U,Be.hits+=Number.isFinite(G)?G:0,!Be.icon&&Y.icon&&(Be.icon=Y.icon),P.set(De,Be)},y=new Map;Array.isArray(A==null?void 0:A.targetDamageDist)&&A.targetDamageDist.forEach(C=>{Array.isArray(C)&&C.forEach(U=>{Array.isArray(U)&&U.forEach(G=>{const Y=Number(G==null?void 0:G.id),De=Number((G==null?void 0:G.totalDamage)||0);if(Number.isFinite(Y)){const Be=y.get(Y)||{damage:0,hits:0};Be.damage+=Number.isFinite(De)?De:0,Be.hits+=Number((G==null?void 0:G.connectedHits)||(G==null?void 0:G.hits)||0),y.set(Y,Be)}te(G)})})}),!(R!=null&&R.detailedWvW)&&Array.isArray(A==null?void 0:A.totalDamageDist)&&A.totalDamageDist.forEach(C=>{Array.isArray(C)&&C.forEach(U=>{const G=Number(U==null?void 0:U.id);if(!Number.isFinite(G)){te(U);return}const Y=y.get(G);if(!Y){te(U);return}const De=Number((U==null?void 0:U.totalDamage)||0),Be=Number((U==null?void 0:U.connectedHits)||(U==null?void 0:U.hits)||0),Ke=De-Number(Y.damage||0),Je=Be-Number(Y.hits||0);Ke<=0&&Je<=0||te({...U,totalDamage:Math.max(0,Ke),connectedHits:Math.max(0,Je),hits:Math.max(0,Je)})})});const X=(()=>{const C=A==null?void 0:A.combatReplayData;return Array.isArray(C)?C.filter(U=>U&&typeof U=="object"):C&&typeof C=="object"?[C]:[]})(),ne=X.map(C=>Number(C==null?void 0:C.start)).filter(C=>Number.isFinite(C)&&C>=0),ae=X.flatMap(C=>K(C==null?void 0:C.down).map(([U])=>Number(U||0))),ee=X.flatMap(C=>K(C==null?void 0:C.dead).map(([U])=>Number(U||0)));d[Ee]={hit:me,burst1s:t,burst5s:o,burst30s:h,skillName:We.skillName,buckets5s:f,downIndices5s:se(ae,ne,N,s,Number((R==null?void 0:R.durationMS)||0)),deathIndices5s:se(ee,ne,N,s,Number((R==null?void 0:R.durationMS)||0)),skillRows:Array.from(P.values()).sort((C,U)=>U.damage-C.damage).slice(0,50)};const Q=a.get(Ee)||{key:Ee,account:x,displayName:x,characterName:ce,profession:Pe,professionList:[Pe],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakFightLabel:"",peakSkillName:""};Q.logs+=1,Q.professionList.includes(Pe)||Q.professionList.push(Pe),!Q.characterName&&ce&&(Q.characterName=ce),me>Q.peakHit&&(Q.peakHit=me,Q.peakFightLabel=u,Q.peakSkillName=We.skillName),t>Q.peak1s&&(Q.peak1s=t),o>Q.peak5s&&(Q.peak5s=o),h>Q.peak30s&&(Q.peak30s=h),a.set(Ee,Q)});const L=Object.values(d).reduce((A,x)=>Math.max(A,Number((x==null?void 0:x.hit)||0)),0),c=Object.values(d).reduce((A,x)=>Math.max(A,Number((x==null?void 0:x.burst1s)||0)),0),w=Object.values(d).reduce((A,x)=>Math.max(A,Number((x==null?void 0:x.burst5s)||0)),0),q=Object.values(d).reduce((A,x)=>Math.max(A,Number((x==null?void 0:x.burst30s)||0)),0);b.push({id:E.filePath||E.id||`fight-${B+1}`,shortLabel:`F${B+1}`,fullLabel:u,timestamp:Ye(R,E),values:d,maxHit:L,max1s:c,max5s:w,max30s:q})});const ve=Array.from(a.values()).sort((E,B)=>B.peakHit!==E.peakHit?B.peakHit-E.peakHit:E.displayName.localeCompare(B.displayName));return{fights:b,players:ve}})(),ts=(()=>{const e=u=>String(u||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),n=u=>e(u).toLowerCase().split(/[^a-z0-9]+/i).map(d=>d.trim()).filter(Boolean).map(d=>d.length>3&&d.endsWith("s")?d.slice(0,-1):d),i=(u,d)=>{const M=e(u),N=e(d);if(!N)return M;if(!M)return N;const L=n(M),c=n(N),w=new Set(L),q=new Set(c),A=c.length>0&&c.every(ce=>w.has(ce)),x=L.length>0&&L.every(ce=>q.has(ce));return A||x?M:`${M} - ${N}`},b=[],a=new Map,T=(u,d)=>{const M=Number(u);if(!Number.isFinite(M))return{name:String(u||"Unknown Skill"),icon:void 0};const N=(d==null?void 0:d.skillMap)||{},L=(d==null?void 0:d.buffMap)||{},c=(N==null?void 0:N[`s${M}`])||(N==null?void 0:N[`${M}`]);if(c!=null&&c.name)return{name:String(c.name),icon:c==null?void 0:c.icon};const w=(L==null?void 0:L[`b${M}`])||(L==null?void 0:L[`${M}`]);return w!=null&&w.name?{name:String(w.name),icon:w==null?void 0:w.icon}:{name:`Skill ${M}`,icon:void 0}},g=(u,d)=>{let M=0,N="";const L=c=>{if(!c||typeof c!="object"||c.indirectDamage)return;const w=[Number(c.max),Number(c.maxDamage),Number(c.maxHit)].filter(A=>Number.isFinite(A)),q=w.length>0?Math.max(...w):0;q>M&&(M=q,N=T(c.id,d).name)};return Array.isArray(u==null?void 0:u.totalDamageDist)&&u.totalDamageDist.forEach(c=>{Array.isArray(c)&&c.forEach(w=>L(w))}),Array.isArray(u==null?void 0:u.targetDamageDist)&&u.targetDamageDist.forEach(c=>{Array.isArray(c)&&c.forEach(w=>{Array.isArray(w)&&w.forEach(q=>L(q))})}),{peak:M,skillName:N||"Unknown Skill"}},$=u=>{if(!Array.isArray(u)||u.length===0)return[];const d=[];for(let M=0;M<u.length;M+=1){const N=Number(u[M]||0),L=M>0?Number(u[M-1]||0):0;d.push(Math.max(0,N-L))}return d},_=u=>{if(!Array.isArray(u)||u.length===0)return[];const d=u.reduce((N,L)=>Math.max(N,Array.isArray(L)?L.length:0),0);if(d<=0)return[];const M=new Array(d).fill(0);return u.forEach(N=>{if(Array.isArray(N))for(let L=0;L<d;L+=1)M[L]+=Number(N[L]||0)}),M},K=u=>{if(!Array.isArray(u)||u.length===0)return[];const d=u[0];if(typeof d=="number")return u.map(M=>Number(M||0));if(Array.isArray(d)&&d.length>0){if(typeof d[0]=="number")return d.map(M=>Number(M||0));if(Array.isArray(d[0])){const M=d.map(N=>Array.isArray(N)?N.map(L=>Number(L||0)):null).filter(N=>Array.isArray(N)&&N.length>0);if(M.length>0)return _(M)}}return[]},oe=u=>{const d=K(u==null?void 0:u.powerDamage1S),M=K(u==null?void 0:u.damage1S),N=d.length>0?d:M;return $(N)},se=(u,d)=>{const M=u==null?void 0:u.targetPowerDamage1S;if(!Array.isArray(M)||!Array.isArray(M[d]))return[];const N=M[d];if(!Array.isArray(N)||N.length===0)return[];if(typeof N[0]=="number")return N.map(L=>Number(L||0));if(Array.isArray(N[0])&&!Array.isArray(N[0][0]))return N[0].map(L=>Number(L||0));if(Array.isArray(N[0])&&Array.isArray(N[0][0])){const c=N[0].map(w=>Array.isArray(w)?w.map(q=>Number(q||0)):null).filter(w=>Array.isArray(w)&&w.length>0);return _(c)}return[]},ve=(u,d)=>{if(!Array.isArray(u)||u.length===0||d<=0)return 0;let M=0,N=0;for(let L=0;L<u.length;L+=1)M+=Number(u[L]||0),L>=d&&(M-=Number(u[L-d]||0)),L>=d-1&&M>N&&(N=M);return Math.max(0,N)},E=(u,d)=>{if(!Array.isArray(u)||u.length===0||d<=0)return[];const M=[];for(let N=0;N<u.length;N+=d){const L=Math.min(N+d,u.length),c=u.slice(N,L).reduce((w,q)=>w+Number(q||0),0);M.push(c)}return M},B=u=>Array.isArray(u)?u.map(d=>Array.isArray(d)?[Number(d[0]),Number(d[1])]:d&&typeof d=="object"?[Number(d.time),Number(d.value)]:null).filter(d=>!!d&&Number.isFinite(d[0])&&d[0]>=0):[],R=(u,d,M,N,L)=>{if(!u.length||N<=0)return[];const c=Math.max(N*5e3,L||0),w=me=>me.reduce((Ue,t)=>t>=0&&t<=c+2e3?Ue+1:Ue,0),q=u.map(me=>Number(me||0)).filter(me=>Number.isFinite(me)&&me>=0);if(!q.length)return[];const A=[q],x=q.reduce((me,Ue)=>Math.max(me,Ue),0),ce=q.reduce((me,Ue)=>Math.min(me,Ue),Number.POSITIVE_INFINITY);x>c*20&&A.push(q.map(me=>me/1e3)),x<=c*2&&ce>=0&&x>0&&x<Math.max(120,N*5+10)&&A.push(q.map(me=>me*1e3));let Pe=q,Ee=0,We=-1;return A.forEach(me=>{const Ue=me.reduce((o,h)=>Math.min(o,h),Number.POSITIVE_INFINITY),t=new Set([0,...d,...M]);if(Number.isFinite(Ue)&&c>0&&Ue>c){const o=Math.floor(Ue/c)*c;t.add(o),t.add(Math.max(0,o-c))}t.forEach(o=>{const h=me.map(S=>S-o),v=w(h);v>We&&(We=v,Ee=o,Pe=me)})}),Pe.map(me=>me-Ee).filter(me=>Number.isFinite(me)&&me>=0)},Z=(u,d,M,N,L)=>{const c=R(u,d,M,N,L);return Array.from(new Set(c.map(w=>Math.floor(w/5e3)).filter(w=>Number.isFinite(w)&&w>=0&&w<N)))};V.map(u=>({log:u,ts:Ye(u==null?void 0:u.details,u)})).sort((u,d)=>u.ts-d.ts).forEach(({log:u},d)=>{const M=u==null?void 0:u.details;if(!M)return;const N=e(M.fightName||u.fightName||`Fight ${d+1}`),L=dt(M,u),c=i(N,String(L||"")),w={},A=(Array.isArray(M.players)?M.players:[]).filter(s=>!(s!=null&&s.notInSquad)),x=A.flatMap(s=>{const k=s==null?void 0:s.combatReplayData;return Array.isArray(k)?k.map(f=>Number(f==null?void 0:f.start)):[Number(k==null?void 0:k.start)]}).filter(s=>Number.isFinite(s)&&s>=0),ce=A.flatMap(s=>{const k=s==null?void 0:s.combatReplayData;return(Array.isArray(k)?k:k?[k]:[]).flatMap(P=>B(P==null?void 0:P.down).map(([te])=>Number(te||0)))}),Pe=A.flatMap(s=>{const k=s==null?void 0:s.combatReplayData;return(Array.isArray(k)?k:k?[k]:[]).flatMap(P=>B(P==null?void 0:P.dead).map(([te])=>Number(te||0)))}),Ee=new Map,We=new Map,me=new Map;(Array.isArray(M.targets)?M.targets:[]).forEach((s,k)=>{if(!s||s.isFake||!s.enemyPlayer)return;const f=ye((s==null?void 0:s.profession)||(s==null?void 0:s.name)||(s==null?void 0:s.id))||"Unknown";me.set(f,(me.get(f)||0)+1);const P=We.get(f)||new Map;Array.isArray(s==null?void 0:s.totalDamageDist)&&s.totalDamageDist.forEach(ae=>{Array.isArray(ae)&&ae.forEach(ee=>{if(!ee||typeof ee!="object"||ee.indirectDamage)return;const Q=Number(ee.totalDamage||0);if(!Number.isFinite(Q)||Q<=0)return;const C=Number(ee.connectedHits||ee.hits||0),U=T(ee.id,M),G=U.name,Y=P.get(G)||{skillName:G,damage:0,hits:0,icon:U.icon};Y.damage+=Q,Y.hits+=Number.isFinite(C)?C:0,!Y.icon&&U.icon&&(Y.icon=U.icon),P.set(G,Y)})}),We.set(f,P);const te=_(A.map(ae=>se(ae,k))),y=te.length>0?$(te):oe(s),W=g(s,M);let X=Ee.get(f);X||(X={perSecond:[],hit:0,skillName:""},Ee.set(f,X)),y.length>X.perSecond.length&&(X.perSecond.length=y.length);for(let ae=0;ae<y.length;ae+=1)X.perSecond[ae]=Number(X.perSecond[ae]||0)+Number(y[ae]||0);const ne=Number(W.peak||0);ne>X.hit&&(X.hit=ne,X.skillName=W.skillName||"Unknown Skill")});const t=Array.from(Ee.values()).some(s=>Array.isArray(s.perSecond)&&s.perSecond.some(k=>Number(k||0)>0));if(Ee.size===0||!t){const s=_(A.map(f=>{const P=K(f==null?void 0:f.powerDamageTaken1S);return $(P)})),k=Array.from(me.values()).reduce((f,P)=>f+Number(P||0),0);s.length>0&&k>0&&me.forEach((f,P)=>{const te=Number(f||0)/k,y=s.map(X=>Number(X||0)*te),W=Ee.get(P);Ee.set(P,{perSecond:y,hit:Number((W==null?void 0:W.hit)||0),skillName:String((W==null?void 0:W.skillName)||"")})})}Ee.forEach((s,k)=>{var U;const f=k,P=Number(s.hit||0),te=Number(ve(s.perSecond,1)||0),y=Number(ve(s.perSecond,5)||0),W=Number(ve(s.perSecond,30)||0),X=Math.max(0,Math.ceil(Number((M==null?void 0:M.durationMS)||0)/5e3)),ne=Math.max(0,Math.ceil(s.perSecond.length/5)),ae=Math.max(X,ne),ee=E(s.perSecond,5),Q=Array.from({length:ae},(G,Y)=>Number(ee[Y]||0));w[f]={hit:P,burst1s:te,burst5s:y,burst30s:W,skillName:s.skillName||"Unknown Skill",buckets5s:Q,downIndices5s:Z(ce,[],x,ae,Number((M==null?void 0:M.durationMS)||0)),deathIndices5s:Z(Pe,[],x,ae,Number((M==null?void 0:M.durationMS)||0)),skillRows:Array.from(((U=We.get(k))==null?void 0:U.values())||[]).sort((G,Y)=>Y.damage-G.damage).slice(0,50)};const C=a.get(f)||{key:f,account:k,displayName:k,characterName:"",profession:k,professionList:[k],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakFightLabel:"",peakSkillName:""};C.logs+=1,P>C.peakHit&&(C.peakHit=P,C.peakFightLabel=c,C.peakSkillName=s.skillName||"Unknown Skill"),te>C.peak1s&&(C.peak1s=te),y>C.peak5s&&(C.peak5s=y),W>C.peak30s&&(C.peak30s=W),a.set(f,C)});const o=Object.values(w).reduce((s,k)=>Math.max(s,Number((k==null?void 0:k.hit)||0)),0),h=Object.values(w).reduce((s,k)=>Math.max(s,Number((k==null?void 0:k.burst1s)||0)),0),v=Object.values(w).reduce((s,k)=>Math.max(s,Number((k==null?void 0:k.burst5s)||0)),0),S=Object.values(w).reduce((s,k)=>Math.max(s,Number((k==null?void 0:k.burst30s)||0)),0);b.push({id:u.filePath||u.id||`fight-${d+1}`,shortLabel:`F${d+1}`,fullLabel:c,timestamp:Ye(M,u),values:w,maxHit:o,max1s:h,max5s:v,max30s:S})});const re=Array.from(a.values()).sort((u,d)=>d.peakHit!==u.peakHit?d.peakHit-u.peakHit:u.displayName.localeCompare(d.displayName));return{fights:b,players:re}})(),ns=Array.from(Ve.entries()).map(([e,n])=>{const i=xe.get(e)||{},b=Array.from(n.values()).map(a=>{var ve,E;const T=Array.from(a.professions||[]).filter(B=>B&&B!=="Unknown");let g=a.profession||"Unknown";if(T.length>0){g=T[0];let B=((ve=a.professionTimeMs)==null?void 0:ve[g])||0;T.forEach(R=>{var re;const Z=((re=a.professionTimeMs)==null?void 0:re[R])||0;Z>B&&(B=Z,g=R)})}const $=a.durationMs||0,_=a.totalMs/1e3,K=$>0?a.totalMs/$:0,oe=((E=he.get(a.account))==null?void 0:E.supportActiveMs)||$,se=oe>0?a.uptimeMs/oe:0;return{account:a.account,profession:g,professionList:T,total:_,perSecond:K,uptimePerSecond:se,duration:$/1e3}}).filter(a=>a.total>0||a.perSecond>0);return{id:e,name:i.name||e,icon:i.icon,rows:b}}).filter(e=>e.rows.length>0),is=Array.from(je.values()).map(e=>{const n=Array.from(e.skills.values()).sort((b,a)=>a.damage-b.damage),i=n.reduce((b,a)=>(b[a.id]=a,b),{});return{key:e.key,account:e.account,displayName:e.displayName,profession:e.profession,professionList:e.professionList,totalFightMs:e.totalFightMs,skills:n,skillMap:i}}).sort((e,n)=>e.displayName.localeCompare(n.displayName));return{total:J,wins:ke,losses:de,avgSquadSize:Bi,avgEnemies:Ii,squadKDR:Li,enemyKDR:Pi,totalSquadKills:m,totalSquadDeaths:Ne,totalEnemyKills:le,totalEnemyDeaths:Me,leaderboards:Re,...xi,outgoingConditionSummary:Object.values(qe).sort((e,n)=>n.damage-e.damage),incomingConditionSummary:Object.values($e).sort((e,n)=>n.damage-e.damage),outgoingConditionPlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.outgoingConditions})),incomingConditionPlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.incomingConditions})),topSkills:Ri,topIncomingSkills:Oi,topSkillsByDamage:Pn,topSkillsByDownContribution:qn,playerSkillBreakdowns:is,topSkillsMetric:z,mapData:ji,timelineData:Ki,boonTables:zi,offensePlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,offenseTotals:e.offenseTotals,offenseRateWeights:e.offenseRateWeights,totalFightMs:e.totalFightMs})),defensePlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,defenseTotals:e.defenseTotals,activeMs:e.defenseActiveMs})),damageMitigationPlayers:qi,damageMitigationMinions:Hi,supportPlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,supportTotals:e.supportTotals,activeMs:e.supportActiveMs})),healingPlayers:Array.from(he.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,healingTotals:e.healingTotals,activeMs:e.healingActiveMs})),mvp:Gt,silver:Bn,bronze:In,squadClassData:Vi,enemyClassData:Yi,fightBreakdown:Ji,fightDiffMode:Qi,attendanceData:Xi,squadCompByFight:Zi,spikeDamage:es,incomingStrikeDamage:ts,specialTables:ns,topStatsPerSecond:st,topStatsLeaderboardsPerSecond:it,avgMvpScore:Ln}})(),Xe=(()=>{const Fe=new Map,Ie=new Map,z=[],J=new Map,ke=new Map;V.forEach(pe=>{const Te=pe.details;if(!Te)return;const Ne=Te.skillMap||{},m=Te.fightName||"Log",Me=Ye(Te,pe)||Date.now(),le={id:pe.filePath||pe.id||m,label:m,timestamp:Me,skillEntries:{},playerActiveSeconds:{},durationSeconds:Te.durationMS?Te.durationMS/1e3:0};(Te.players||[]).forEach(Se=>{if(Se.notInSquad)return;const he=Se.account||Se.name||"Unknown",_e=Se.profession||"Unknown",ge=`${he}|${_e}`;let we=Ie.get(ge);we||(we={key:ge,account:he,displayName:he,profession:_e,professionList:[_e],logs:0,totalActiveSeconds:0,skillTotals:{}},Ie.set(ge,we)),we.logs++;const je=(Array.isArray(Se.activeTimes)?Se.activeTimes[0]:0)/1e3;we.totalActiveSeconds=(we.totalActiveSeconds||0)+je,le.playerActiveSeconds[ge]=je,(Se.rotation||[]).forEach(qe=>{var Bt,It,Lt;if(!(qe!=null&&qe.id))return;const $e=((Bt=qe.skills)==null?void 0:Bt.length)||0;if($e<=0)return;const He=`s${qe.id}`,xe=((It=Ne[He])==null?void 0:It.name)||`Skill ${qe.id}`,Ve=(Lt=Ne[He])==null?void 0:Lt.icon;we.skillTotals[He]=(we.skillTotals[He]||0)+$e,Fe.set(He,(Fe.get(He)||0)+$e),J.set(He,xe),Ve&&!ke.has(He)&&ke.set(He,Ve),le.skillEntries[He]||(le.skillEntries[He]={name:xe,icon:Ve,players:{}}),!le.skillEntries[He].icon&&Ve&&(le.skillEntries[He].icon=Ve),le.skillEntries[He].players[ge]=(le.skillEntries[He].players[ge]||0)+$e})}),z.push(le)});const de=Array.from(Fe.entries()).map(([pe,Te])=>({id:pe,name:J.get(pe)||pe,total:Te,icon:ke.get(pe)})).sort((pe,Te)=>Te.total-pe.total);return{logRecords:z,players:Array.from(Ie.values()),skillOptions:de,resUtilitySkills:[]}})();return{validLogs:V,stats:ze,skillUsageData:Xe}};let nt=null,mt=!1,gn=null,pn=0,bn=0,_t=null;const hn=r=>{if(!r||typeof r!="object")return r;const l=(H,j)=>{const V={};return j.forEach(Ce=>{H&&Object.prototype.hasOwnProperty.call(H,Ce)&&(V[Ce]=H[Ce])}),V},p=l(r,["players","targets","durationMS","uploadTime","timeStart","timeStartStd","timeEnd","timeEndStd","fightName","zone","mapName","map","location","permalink","uploadLinks","success","teamBreakdown","teamCounts","combatReplayMetaData","skillMap","buffMap","encounterDuration","player_damage_mitigation","player_minion_damage_mitigation","playerDamageMitigation","playerMinionDamageMitigation"]);return Array.isArray(p.players)&&(p.players=p.players.map(H=>l(H,["name","display_name","character_name","profession","elite_spec","group","dpsAll","statsAll","dpsTargets","statsTargets","defenses","support","rotation","extHealingStats","extBarrierStats","squadBuffVolumes","selfBuffs","groupBuffs","squadBuffs","selfBuffsActive","groupBuffsActive","squadBuffsActive","buffUptimes","totalDamageDist","targetDamageDist","damage1S","targetDamage1S","powerDamageTaken1S","targetPowerDamage1S","totalDamageTaken","totalDamageTakenDist","minions","combatReplayData","hasCommanderTag","notInSquad","account","activeTimes","teamID","teamId","team","teamColor","team_color"]))),Array.isArray(p.targets)&&(p.targets=p.targets.map(H=>l(H,["id","name","isFake","dpsAll","statsAll","defenses","totalHealth","healthPercentBurned","enemyPlayer","totalDamageDist","totalDamageTaken","totalDamageTakenDist","damageTaken","powerDamage1S","damage1S","profession","teamID","teamId","team","teamColor","team_color"]))),p},vi=r=>{if(!r||typeof r!="object")return r;const l={...r};return r.details?l.details=hn(r.details):l.details=hn(r),l},Dn=()=>{if(!mt||!nt)return;mt=!1,pn+=1;const r=_t;_t=null;const l=wi(nt);self.postMessage({type:"result",result:l,computeId:pn,logCount:nt.logs.length,token:bn,completedAt:Date.now(),flushId:r})},Wt=()=>{gn===null&&(gn=setInterval(()=>{Dn()},5e3))};self.onmessage=r=>{var p,H,j,V;const l=r.data;if((l==null?void 0:l.type)==="reset"){nt={logs:[]},typeof l.token=="number"&&(bn=l.token),mt=!0,Wt();return}if((l==null?void 0:l.type)==="settings"){nt={logs:(nt==null?void 0:nt.logs)||[],precomputedStats:(p=l.payload)==null?void 0:p.precomputedStats,mvpWeights:(H=l.payload)==null?void 0:H.mvpWeights,statsViewSettings:(j=l.payload)==null?void 0:j.statsViewSettings,disruptionMethod:(V=l.payload)==null?void 0:V.disruptionMethod},mt=!0,Wt();return}if((l==null?void 0:l.type)==="log"){nt||(nt={logs:[]}),nt.logs.push(vi(l.payload)),mt=!0,Wt();return}(l==null?void 0:l.type)==="flush"&&(typeof l.flushId=="number"&&(_t=l.flushId),mt=!0,Dn())}})();
